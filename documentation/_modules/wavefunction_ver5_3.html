<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>wavefunction_ver5_3 &mdash; Atom calculator 1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Atom calculator 1.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for wavefunction_ver5_3</h1><div class="highlight"><pre>
<span></span><span class="c1"># varsion 5.3 adds support for </span>
<span class="c1"># version 5.2 adds saving of the full wavefunctions and calls efficiant C++ coded Numerov implementation for wavefunction generation</span>
<span class="c1"># version 5.1 adds support for Li, Na, K too</span>
<span class="c1"># version 4.4 adds options for saving pair-state interaction matrices to disk, and retrieve for level calculation later...</span>
<span class="c1"># ver 4.3 correctly accounts for pair-state interactions up to quadrupole interactions</span>
<span class="c1"># ver 4.2 adds quadrupole couplings to calculation of c3 and c6 coefficients, but in incomplete way (only coupling to original state; no coupling between other states)</span>
<span class="c1"># ver 4.1 tries finally to calculate c3 and c6 correctly</span>
<span class="c1"># var 3 has angular parts ok</span>
<span class="c1"># ver 2 tries to obtain the correct lifetimes of the Rydberg states, in accordance to C.Theodosieu</span>
<span class="c1"># PRA 30:2881 (1984)</span>


<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">ode</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylab</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">MultipleLocator</span><span class="p">,</span> <span class="n">FormatStrFormatter</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">algebra_nikola</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">wigner</span> <span class="kn">import</span> <span class="n">Wigner6j</span><span class="p">,</span><span class="n">Wigner3j</span>
<span class="kn">from</span> <span class="nn">scipy.constants</span> <span class="kn">import</span> <span class="n">physical_constants</span><span class="p">,</span><span class="n">pi</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">epsilon_0</span><span class="p">,</span><span class="n">hbar</span>
<span class="kn">from</span> <span class="nn">scipy.constants</span> <span class="kn">import</span> <span class="n">e</span> <span class="k">as</span> <span class="n">elemCharge</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>

<span class="c1"># for matrices</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">zeros</span><span class="p">,</span><span class="n">savetxt</span>
<span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">eigvalsh</span><span class="p">,</span><span class="n">eig</span>
<span class="kn">from</span> <span class="nn">numpy.ma</span> <span class="kn">import</span> <span class="n">conjugate</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">complex64</span><span class="p">,</span><span class="n">complex128</span>

<span class="kn">from</span> <span class="nn">wigner_rotation</span> <span class="kn">import</span> <span class="n">wignerD</span>

<span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">lil_matrix</span>
<span class="kn">from</span> <span class="nn">scipy.sparse.linalg</span> <span class="kn">import</span> <span class="n">eigsh</span>
<span class="kn">from</span> <span class="nn">scipy.special.specfun</span> <span class="kn">import</span> <span class="n">fcoef</span>

<span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">csr_matrix</span><span class="c1">#lil_matrix</span>

<span class="c1">#from scipy.sparse.linalg import eigsh</span>

<span class="c1"># for calling C++ Numerov </span>
<span class="kn">import</span> <span class="nn">shlex</span>
<span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">Popen</span><span class="p">,</span> <span class="n">PIPE</span>
<span class="kn">from</span> <span class="nn">idlelib</span> <span class="kn">import</span> <span class="n">OutputWindow</span>

<span class="c1"># START of modules for online (server) execution</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">nbconvert.exporters.exporter</span> <span class="kn">import</span> <span class="n">FilenameExtension</span>
<span class="c1"># END of modules for online (server) execution </span>

<div class="viewcode-block" id="AlkaliAtom"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.AlkaliAtom">[docs]</a><span class="k">class</span> <span class="nc">AlkaliAtom</span><span class="p">:</span>
    <span class="c1"># ALL PARAMETERS ARE IN ATOMIC UNITS (Hatree)</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="mf">137.0</span>   <span class="c1"># Hyperfine constant</span>
    
    <span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">a3</span><span class="p">,</span><span class="n">a4</span><span class="p">,</span><span class="n">rc</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">]</span>   <span class="c1"># Model potential parameters fitted from experimental observations for different l (electron angular momentum)</span>
    <span class="n">alphaC</span> <span class="o">=</span> <span class="mf">0.0</span>    <span class="c1"># Core polarizability</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="mf">0.0</span>       <span class="c1"># Core charge</span>
    
    <span class="n">sEnergy</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">NISTdataLevels</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">scaledRydbergConstant</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="n">quantumDefect</span> <span class="o">=</span> <span class="p">[[[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]],</span>
                     <span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]]]</span>
    
    <span class="n">levelDataFromNIST</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">dipoleMatrixElementFile</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="c1"># location of hard-disk stored dipole matrix elements</span>
    <span class="n">dipoleMatrixElement</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="n">quadrupoleMatrixElementFile</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="c1"># location of hard-disk stored dipole matrix elements</span>
    <span class="n">quadrupoleMatrixElement</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    
    <span class="c1"># levels that are for smaller n than ground level, but are above in energy due to angular part</span>
    <span class="n">extraLevels</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># swich - should the wavefunction be calculated with Numerov algorithm implemented in cpp - they are also saved then</span>
    <span class="n">cpp_numerov</span> <span class="o">=</span> <span class="bp">False</span>
    
    <span class="n">mass</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">abundance</span> <span class="o">=</span> <span class="mf">1.0</span>
    
    <span class="n">elementName</span> <span class="o">=</span> <span class="s2">&quot;elementName&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">prefereQuantumDefects</span><span class="p">,</span><span class="n">cpp_numerov</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="c1"># should the wavefunction be calculated with Numerov algorithm implemented in cpp </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpp_numerov</span> <span class="o">=</span> <span class="n">cpp_numerov</span><span class="p">;</span>
        <span class="c1"># load dipole matrix elements previously calculated</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">prefereQuantumDefects</span> <span class="o">==</span> <span class="bp">False</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dipoleMatrixElementFile</span>  <span class="o">=</span> <span class="s2">&quot;NIST_&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dipoleMatrixElementFile</span>
        <span class="c1"># Loading already calculated dipole matrix elements</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dipoleMatrixElementFile</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dipoleMatrixElement</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dipoleMatrixElementFile</span><span class="p">)</span>
                
            <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">print</span> <span class="s2">&quot;Error reading dipoleMatrixElement File &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dipoleMatrixElementFile</span>
                <span class="k">print</span> <span class="n">e</span>
                
        <span class="c1"># load quadrupole matrix elements previously calculated        </span>
        <span class="k">if</span> <span class="p">(</span><span class="n">prefereQuantumDefects</span> <span class="o">==</span> <span class="bp">False</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dipoleMatrixElementFile</span>  <span class="o">=</span> <span class="s2">&quot;NIST_&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">quadrupoleMatrixElementFile</span>
        <span class="c1"># Loading already calculated dipole matrix elements</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dipoleMatrixElementFile</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">quadrupoleMatrixElement</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quadrupoleMatrixElementFile</span><span class="p">)</span>
                
            <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">print</span> <span class="s2">&quot;Error reading dipoleMatrixElement File &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">quadrupoleMatrixElementFile</span>
                <span class="k">print</span> <span class="n">e</span>
        
        
        <span class="c1"># Load level data       </span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levelDataFromNIST</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="k">print</span> <span class="s2">&quot;NIST level data file not specified. Only quantum defects will be used.&quot;</span>
            <span class="k">return</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ParseLevelsFromNIST</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levelDataFromNIST</span><span class="p">)</span>
        <span class="n">br</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sEnergy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.0</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">NISTdataLevels</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">NISTdataLevels</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">prefereQuantumDefects</span><span class="p">):</span>
            <span class="c1"># if user doesn&#39;t want to use at all NIST level data</span>
            <span class="k">return</span> 
        <span class="k">while</span> <span class="n">br</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">levels</span><span class="p">):</span>
            <span class="c1">#if (levels[br][1]==0):  # TEMPORARY TEST FOR D LEVELS WITH QUANTUM DEFECTS</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addEnergy</span><span class="p">(</span><span class="n">levels</span><span class="p">[</span><span class="n">br</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">levels</span><span class="p">[</span><span class="n">br</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">levels</span><span class="p">[</span><span class="n">br</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">levels</span><span class="p">[</span><span class="n">br</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">br</span> <span class="o">=</span> <span class="n">br</span><span class="o">+</span><span class="mi">1</span>
    
<div class="viewcode-block" id="AlkaliAtom.getPressure"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.AlkaliAtom.getPressure">[docs]</a>    <span class="k">def</span> <span class="nf">getPressure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">temperature</span><span class="p">):</span>
        <span class="k">print</span> <span class="s2">&quot;Error: getPressure to-be implement in child class (otherwise this call is invalid for the specified atom&quot;</span>
        <span class="nb">exit</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="AlkaliAtom.getConcetration"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.AlkaliAtom.getConcetration">[docs]</a>    <span class="k">def</span> <span class="nf">getConcetration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">temperature</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPressure</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">temperature</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="AlkaliAtom.CorePotential"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.AlkaliAtom.CorePotential">[docs]</a>    <span class="k">def</span> <span class="nf">CorePotential</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
        <span class="c1"># l dependent core potential (angular momentum of e) at radius r</span>
        <span class="c1"># returns Core potential</span>
        <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">EffectiveCharge</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="n">r</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">alphaC</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">r</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">rc</span><span class="p">[</span><span class="n">l</span><span class="p">])</span><span class="o">**</span><span class="mi">6</span><span class="p">))</span> </div>
    
<div class="viewcode-block" id="AlkaliAtom.EffectiveCharge"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.AlkaliAtom.EffectiveCharge">[docs]</a>    <span class="k">def</span> <span class="nf">EffectiveCharge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
        <span class="c1"># returns effective charge of the core</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">+</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">a1</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">*</span><span class="n">r</span><span class="p">)</span><span class="o">-</span><span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a3</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">a4</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">*</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">a2</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">*</span><span class="n">r</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AlkaliAtom.Potential"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.AlkaliAtom.Potential">[docs]</a>    <span class="k">def</span> <span class="nf">Potential</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
        <span class="c1"># Returns total potential that electron feels = core potential + Spin-Orbit interaction</span>
        <span class="k">if</span> <span class="n">l</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">CorePotential</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">-</span><span class="n">l</span><span class="o">*</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">-</span><span class="n">s</span><span class="o">*</span><span class="p">(</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mf">2.0</span>   
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># act as ig it is a Hydrogen atom</span>
            <span class="k">return</span> <span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="n">r</span></div>
    
<div class="viewcode-block" id="AlkaliAtom.RadialWavefunction"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.AlkaliAtom.RadialWavefunction">[docs]</a>    <span class="k">def</span> <span class="nf">RadialWavefunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">stateEnergy</span><span class="p">,</span><span class="n">start</span><span class="p">,</span><span class="n">stop</span><span class="p">,</span><span class="n">step</span><span class="p">):</span>
        <span class="c1"># returns set of radial coordinates</span>
        <span class="c1"># and radialwavefunction*radial coordinate values</span>
        <span class="c1"># NOTE: radial wavefunction is not scalled to unity!</span>
        <span class="c1"># state energy should be given in atomic units (Hatree)        </span>
        <span class="c1">##potential = lambda r: 2*(stateEnergy-self.Potential(l, s, j, r))-l*(l+1)/(r**2)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpp_numerov</span><span class="p">:</span>
            <span class="c1"># efficiant implementation in c++; wavefunctions are also memorized</span>
            <span class="c1">#filename=&quot;temp_rydberg_wave_function&quot;</span>
            <span class="n">today</span> <span class="o">=</span>  <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

            <span class="n">timestamp</span> <span class="o">=</span> <span class="s1">&#39;{:</span><span class="si">%d</span><span class="s1">%S</span><span class="si">%f</span><span class="s1">}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">today</span><span class="p">)</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_rwf_</span><span class="si">%.0f</span><span class="s2">_</span><span class="si">%.1f</span><span class="s2">_</span><span class="si">%.1f</span><span class="s2">_r&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elementName</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="n">timestamp</span>
           
            <span class="c1"># integration parameters</span>
            <span class="n">cmd1</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%.15e</span><span class="s2"> </span><span class="si">%.15e</span><span class="s2"> </span><span class="si">%.15e</span><span class="s2"> </span><span class="si">%.15e</span><span class="s2"> </span><span class="si">%.15e</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">stop</span><span class="p">,</span><span class="n">step</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="n">filename</span><span class="p">))</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">l</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">):</span>
                <span class="n">cmd2</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%.1f</span><span class="s2"> </span><span class="si">%.1f</span><span class="s2"> </span><span class="si">%.15e</span><span class="s2"> </span><span class="si">%.15e</span><span class="s2"> </span><span class="si">%.15e</span><span class="s2"> </span><span class="si">%d</span><span class="s2"> </span><span class="si">%.15e</span><span class="s2"> </span><span class="si">%.15e</span><span class="s2"> </span><span class="si">%.15e</span><span class="s2"> </span><span class="si">%.15e</span><span class="s2"> </span><span class="si">%.15e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">stateEnergy</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">alphaC</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">a1</span><span class="p">[</span><span class="n">l</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">a2</span><span class="p">[</span><span class="n">l</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">a3</span><span class="p">[</span><span class="n">l</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">a4</span><span class="p">[</span><span class="n">l</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">rc</span><span class="p">[</span><span class="n">l</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd2</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%.1f</span><span class="s2"> </span><span class="si">%.1f</span><span class="s2"> </span><span class="si">%.15e</span><span class="s2"> </span><span class="si">%.15e</span><span class="s2"> </span><span class="si">%.15e</span><span class="s2"> </span><span class="si">%d</span><span class="s2"> </span><span class="si">%.15e</span><span class="s2"> </span><span class="si">%.15e</span><span class="s2"> </span><span class="si">%.15e</span><span class="s2"> </span><span class="si">%.15e</span><span class="s2"> </span><span class="si">%.15e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">stateEnergy</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">alphaC</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">)</span>
            
            <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;/Users/nikola/Documents/workspace/Rydberg_wavefunctions_Numerov_integration/Release/Rydberg_wavefunctions_Numerov_integration &quot;</span><span class="o">+</span><span class="n">cmd1</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="n">cmd2</span>
            <span class="c1">#print cmd</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
            <span class="n">proc</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">PIPE</span><span class="p">)</span>
            <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
            <span class="n">exitcode</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">returncode</span>
            
            <span class="c1">#print &quot;\tOUT:&quot;</span>
            <span class="c1">#print out</span>
            <span class="c1">#print &quot;\tERR:&quot;</span>
            <span class="c1">#print err</span>
            <span class="c1">#exit()</span>
            
            <span class="n">fileRoot</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">fileRoot</span><span class="o">+</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;_rad.dat&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;f8&#39;</span><span class="p">),</span> <span class="n">count</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">fileRoot</span><span class="o">+</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;_sol.dat&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;f8&#39;</span><span class="p">),</span> <span class="n">count</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">divergence</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">fileRoot</span><span class="o">+</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;_divergnece.dat&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;i4&#39;</span><span class="p">),</span> <span class="n">count</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fileRoot</span><span class="o">+</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;_rad.dat&quot;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fileRoot</span><span class="o">+</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;_sol.dat&quot;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fileRoot</span><span class="o">+</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;_divergnece.dat&quot;</span><span class="p">)</span>

            <span class="n">btemp</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">divergence</span><span class="p">:]</span>
            <span class="n">suma</span> <span class="o">=</span> <span class="n">step</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">btemp</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">/</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">suma</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># full implementation in Python</span>
            <span class="k">def</span> <span class="nf">potential</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
                <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">stateEnergy</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Potential</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">r</span><span class="p">))</span><span class="o">-</span><span class="n">l</span><span class="o">*</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            
            <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">divergence</span> <span class="o">=</span> <span class="n">NumerovBack</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">stop</span><span class="p">,</span><span class="n">potential</span><span class="p">,</span><span class="n">step</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.01</span><span class="p">)</span>
            
            <span class="n">btemp</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">divergence</span><span class="p">:]</span>
            <span class="n">suma</span> <span class="o">=</span> <span class="n">step</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">btemp</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">/</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">suma</span><span class="p">))</span>
            <span class="c1"># IMPORTANT NOTE:</span>
            <span class="c1"># This normalization condition implies that I am using spherical harmonics which are normalized such that</span>
            <span class="c1"># Integral over space[ Y(l,ml)* x Y(l&#39;,ml&#39;) ] = 1 delta(l,l&#39;) delta (ml, ml&#39;) </span>
        
        <span class="c1"># START of debug output</span>

        <span class="c1">#print a[0],&quot; &quot;,a[1],&quot; &quot;,a[2]</span>
        <span class="c1">#print b[0],&quot; &quot;,b[1],&quot; &quot;,b[2]</span>
        <span class="c1">#print divergence</span>
        <span class="c1">#print &quot;Suma = &quot;,suma</span>
        
        <span class="c1">#plot(a,b,&quot;r-&quot;)</span>
        <span class="c1">#show()</span>
        <span class="c1"># END OF debug output</span>
        <span class="c1">#exit()</span>
        <span class="k">return</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">divergence</span></div>
    
<div class="viewcode-block" id="AlkaliAtom.ParseLevelsFromNIST"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.AlkaliAtom.ParseLevelsFromNIST">[docs]</a>    <span class="k">def</span> <span class="nf">ParseLevelsFromNIST</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fileData</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileData</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <span class="n">l</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="c1">#print line</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;[\[\]]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="s2">&quot;\.\d*[spdfgh]&quot;</span>
            <span class="n">pattern2</span> <span class="o">=</span> <span class="s2">&quot;\| \d*/&quot;</span>
            <span class="n">pattern3</span> <span class="o">=</span> <span class="s2">&quot;/\d* \|&quot;</span>
            <span class="n">pattern4</span> <span class="o">=</span> <span class="s2">&quot;\| *\d*\.\d* *\|&quot;</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
            <span class="c1">#print match.start()</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">match</span><span class="o">!=</span> <span class="bp">None</span><span class="p">):</span>
                <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">match</span><span class="o">!=</span> <span class="bp">None</span><span class="p">):</span>
                <span class="n">ch</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">()]</span>
                <span class="k">if</span> <span class="n">ch</span> <span class="o">==</span> <span class="s2">&quot;s&quot;</span><span class="p">:</span>
                    <span class="n">l</span><span class="o">=</span><span class="mi">0</span>
                <span class="k">elif</span> <span class="n">ch</span> <span class="o">==</span><span class="s2">&quot;p&quot;</span><span class="p">:</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">ch</span> <span class="o">==</span> <span class="s2">&quot;d&quot;</span><span class="p">:</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="k">elif</span> <span class="n">ch</span> <span class="o">==</span> <span class="s2">&quot;f&quot;</span><span class="p">:</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="mi">3</span>
                <span class="k">elif</span> <span class="n">ch</span> <span class="o">==</span> <span class="s2">&quot;g&quot;</span><span class="p">:</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="mi">4</span>
                <span class="k">elif</span> <span class="n">ch</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="mi">5</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s2">&quot;Unidentified character in line:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">line</span>
                    <span class="nb">exit</span><span class="p">()</span> 
                
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern2</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">match</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">):</span>
                <span class="n">br1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">()</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern3</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
                <span class="n">br2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">()</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern4</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
                <span class="n">energyValue</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="c1">#print n,&quot;,&quot;,l,&quot;,&quot;,br1/br2,&quot;,&quot;,energyValue</span>
                <span class="n">levels</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">br1</span><span class="o">/</span><span class="n">br2</span><span class="p">,</span><span class="n">energyValue</span><span class="p">])</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">levels</span></div>

<div class="viewcode-block" id="AlkaliAtom.addEnergy"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.AlkaliAtom.addEnergy">[docs]</a>    <span class="k">def</span> <span class="nf">addEnergy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">energyNIST</span><span class="p">):</span>
        <span class="c1"># adding energies normalized with respect to nonexcited level (= 0 eV)</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="p">(</span><span class="n">l</span><span class="o">-</span><span class="mf">0.5</span><span class="p">))</span><span class="o">&lt;</span><span class="mf">0.001</span><span class="p">:</span>
            <span class="c1"># j =l-1/2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sEnergy</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">energyNIST</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ionisationEnergy</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># j = l+1/2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sEnergy</span><span class="p">[</span><span class="n">l</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">energyNIST</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ionisationEnergy</span></div>
    
<div class="viewcode-block" id="AlkaliAtom.getTransitionWavelength"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.AlkaliAtom.getTransitionWavelength">[docs]</a>    <span class="k">def</span> <span class="nf">getTransitionWavelength</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">):</span>
        <span class="c1"># returns calculated transition wavelength (in vacuum) between the levels in m</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">h</span><span class="o">*</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">j2</span><span class="p">)</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">j1</span><span class="p">))</span><span class="o">*</span><span class="n">elemCharge</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="AlkaliAtom.getTransitionFrequency"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.AlkaliAtom.getTransitionFrequency">[docs]</a>    <span class="k">def</span> <span class="nf">getTransitionFrequency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">):</span>
        <span class="c1"># returns calculated transition frequency in Hz</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">j2</span><span class="p">)</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">j1</span><span class="p">))</span><span class="o">*</span><span class="n">elemCharge</span><span class="o">/</span><span class="n">h</span></div>
        
        
<div class="viewcode-block" id="AlkaliAtom.getEnergy"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.AlkaliAtom.getEnergy">[docs]</a>    <span class="k">def</span> <span class="nf">getEnergy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">):</span>
        <span class="c1"># retrieving energies normalized with respect to the ionisation level</span>
        <span class="c1"># energy returned in eV</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NISTdataLevels</span><span class="p">):</span>
            <span class="c1"># use NIST data</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="p">(</span><span class="n">l</span><span class="o">-</span><span class="mf">0.5</span><span class="p">))</span><span class="o">&lt;</span><span class="mf">0.001</span><span class="p">:</span>
                <span class="c1"># j = l-1/2</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sEnergy</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">])</span><span class="o">&gt;</span><span class="mf">1e-8</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sEnergy</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">]</span>
                <span class="c1">#else:</span>
                    <span class="c1">#print &quot;NOTE: programme doesn&#39;t now the energy of the (n,l,j) = (&quot;,n,&quot;,&quot;,l,&quot;,&quot;,j,&quot;) level&quot;</span>
                    <span class="c1">#print &quot;Quantum defect calculations will be used&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># j = l+1/2</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sEnergy</span><span class="p">[</span><span class="n">l</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">&gt;</span><span class="mf">1e-8</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sEnergy</span><span class="p">[</span><span class="n">l</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="c1">#else:</span>
                    <span class="c1">#print &quot;NOTE: programme doesn&#39;t now the energy of the (n,l,j) = (&quot;,n,&quot;,&quot;,l,&quot;,&quot;,j,&quot;) level&quot;</span>
                    <span class="c1">#print &quot;Quantum defect calculations will be used&quot;</span>
        <span class="c1"># use quantum defects</span>
        <span class="n">defect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getQuantumDefect</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">scaledRydbergConstant</span><span class="o">/</span><span class="p">((</span><span class="n">n</span><span class="o">-</span><span class="n">defect</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="AlkaliAtom.getQuantumDefect"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.AlkaliAtom.getQuantumDefect">[docs]</a>    <span class="k">def</span> <span class="nf">getQuantumDefect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">):</span>
        <span class="n">defect</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">l</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="p">(</span><span class="n">l</span><span class="o">-</span><span class="mf">0.5</span><span class="p">))</span><span class="o">&lt;</span><span class="mf">0.001</span><span class="p">:</span>
                <span class="c1"># j = l-1/2</span>
                <span class="n">defect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantumDefect</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">quantumDefect</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">l</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">((</span><span class="n">n</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">quantumDefect</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">quantumDefect</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">l</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="p">((</span><span class="n">n</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">quantumDefect</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">quantumDefect</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">l</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">/</span><span class="p">((</span><span class="n">n</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">quantumDefect</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span>
                <span class="n">defect</span> <span class="o">=</span> <span class="n">defect</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">quantumDefect</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">l</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span><span class="o">/</span><span class="p">((</span><span class="n">n</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">quantumDefect</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">8</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># j = l + 1/2</span>
                <span class="n">defect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantumDefect</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">quantumDefect</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">l</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">((</span><span class="n">n</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">quantumDefect</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">quantumDefect</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">l</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="p">((</span><span class="n">n</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">quantumDefect</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">quantumDefect</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">l</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">/</span><span class="p">((</span><span class="n">n</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">quantumDefect</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span>
                <span class="n">defect</span> <span class="o">=</span> <span class="n">defect</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantumDefect</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">l</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span><span class="o">/</span><span class="p">((</span><span class="n">n</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">quantumDefect</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">8</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">defect</span> </div>
          
<div class="viewcode-block" id="AlkaliAtom.getDipoleMatrixElement"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.AlkaliAtom.getDipoleMatrixElement">[docs]</a>    <span class="k">def</span> <span class="nf">getDipoleMatrixElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">j1</span><span class="p">)</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">j2</span><span class="p">)):</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">n1</span>
            <span class="n">n1</span> <span class="o">=</span> <span class="n">n2</span>
            <span class="n">n2</span> <span class="o">=</span> <span class="n">temp</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">l1</span>
            <span class="n">l1</span> <span class="o">=</span> <span class="n">l2</span>
            <span class="n">l2</span> <span class="o">=</span> <span class="n">temp</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">j1</span>
            <span class="n">j1</span> <span class="o">=</span> <span class="n">j2</span>
            <span class="n">j2</span> <span class="o">=</span> <span class="n">temp</span>
        
        <span class="c1"># was this calculated before? If it was, retrieve from memory</span>
        <span class="n">br</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">br</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dipoleMatrixElement</span><span class="p">):</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dipoleMatrixElement</span><span class="p">[</span><span class="n">br</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">n1</span><span class="p">)</span><span class="ow">and</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">l1</span><span class="p">)</span><span class="ow">and</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="n">j1</span><span class="p">)</span><span class="ow">and</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="n">n2</span><span class="p">)</span><span class="ow">and</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">==</span><span class="n">l2</span><span class="p">)</span><span class="ow">and</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">==</span><span class="n">j2</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
            <span class="n">br</span> <span class="o">=</span> <span class="n">br</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">step</span> <span class="o">=</span> <span class="mf">0.01</span>    
        <span class="n">a1</span><span class="p">,</span><span class="n">b1</span><span class="p">,</span><span class="n">start1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RadialWavefunction</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">j1</span><span class="p">)</span><span class="o">/</span><span class="mf">27.211</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">alphaC</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mf">3.0</span><span class="p">),</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">n1</span><span class="o">*</span><span class="p">(</span><span class="n">n1</span><span class="o">+</span><span class="mf">15.0</span><span class="p">),</span> <span class="n">step</span><span class="p">)</span>
        <span class="n">a2</span><span class="p">,</span><span class="n">b2</span><span class="p">,</span><span class="n">start2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RadialWavefunction</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">j2</span><span class="p">)</span><span class="o">/</span><span class="mf">27.211</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">alphaC</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mf">3.0</span><span class="p">),</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">n2</span><span class="o">*</span><span class="p">(</span><span class="n">n2</span><span class="o">+</span><span class="mf">15.0</span><span class="p">),</span> <span class="n">step</span><span class="p">)</span>
        
        <span class="n">dipoleElement</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="c1">#print start1</span>
        <span class="c1">#print start2</span>
        <span class="c1">#plot(a1,b1,&quot;r.-&quot;)</span>
        <span class="c1">#plot(a2,b2,&quot;b.-&quot;)</span>
        <span class="c1">#print a2[0:20]</span>
        <span class="c1">#print b2[0:20]</span>
        <span class="c1">#show()</span>
        
        <span class="n">br</span> <span class="o">=</span> <span class="n">start1</span>
        <span class="k">if</span> <span class="n">br</span><span class="o">&lt;</span><span class="n">start2</span><span class="p">:</span>
            <span class="n">br</span> <span class="o">=</span> <span class="n">start2</span>
        <span class="n">upTo</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a1</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">a2</span><span class="p">))</span>
        
        <span class="n">b1</span> <span class="o">=</span> <span class="n">b1</span><span class="p">[</span><span class="n">br</span><span class="p">:</span><span class="n">upTo</span><span class="p">]</span>
        <span class="n">b2</span> <span class="o">=</span> <span class="n">b2</span><span class="p">[</span><span class="n">br</span><span class="p">:</span><span class="n">upTo</span><span class="p">]</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="n">a1</span><span class="p">[</span><span class="n">br</span><span class="p">:</span><span class="n">upTo</span><span class="p">]</span>
        
        <span class="n">dipoleElement</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span><span class="n">b2</span><span class="p">),</span><span class="n">a1</span><span class="o">*</span><span class="n">step</span><span class="p">))</span>
        
        <span class="c1"># dipoleElement = dipoleElement+b1[br]*b2[br]*a1[br]*step</span>
        
        <span class="c1"># with dipoleMatrixElement as numpy array</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dipoleMatrixElement</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dipoleMatrixElement</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dipoleMatrixElement</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">dipoleElement</span><span class="p">]])),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dipoleMatrixElement</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">dipoleElement</span><span class="p">]])</span>
        
        <span class="k">return</span> <span class="n">dipoleElement</span></div>


    
<div class="viewcode-block" id="AlkaliAtom.getQuadrupoleMatrixElement"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.AlkaliAtom.getQuadrupoleMatrixElement">[docs]</a>    <span class="k">def</span> <span class="nf">getQuadrupoleMatrixElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">j1</span><span class="p">)</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">j2</span><span class="p">)):</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">n1</span>
            <span class="n">n1</span> <span class="o">=</span> <span class="n">n2</span>
            <span class="n">n2</span> <span class="o">=</span> <span class="n">temp</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">l1</span>
            <span class="n">l1</span> <span class="o">=</span> <span class="n">l2</span>
            <span class="n">l2</span> <span class="o">=</span> <span class="n">temp</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">j1</span>
            <span class="n">j1</span> <span class="o">=</span> <span class="n">j2</span>
            <span class="n">j2</span> <span class="o">=</span> <span class="n">temp</span>
        
        <span class="c1">## TO-DO: MAKE MEMORY FOR QUADRUPOLE ELEMENTS</span>
        <span class="c1"># was this calculated before? If it was, retrieve from memory</span>
        <span class="n">br</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">br</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quadrupoleMatrixElement</span><span class="p">):</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quadrupoleMatrixElement</span><span class="p">[</span><span class="n">br</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">n1</span><span class="p">)</span><span class="ow">and</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">l1</span><span class="p">)</span><span class="ow">and</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="n">j1</span><span class="p">)</span><span class="ow">and</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="n">n2</span><span class="p">)</span><span class="ow">and</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">==</span><span class="n">l2</span><span class="p">)</span><span class="ow">and</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">==</span><span class="n">j2</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
            <span class="n">br</span> <span class="o">=</span> <span class="n">br</span> <span class="o">+</span> <span class="mi">1</span>
        
        <span class="n">step</span> <span class="o">=</span> <span class="mf">0.01</span>    
        <span class="n">a1</span><span class="p">,</span><span class="n">b1</span><span class="p">,</span><span class="n">start1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RadialWavefunction</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">j1</span><span class="p">)</span><span class="o">/</span><span class="mf">27.211</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">alphaC</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mf">3.0</span><span class="p">),</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">n1</span><span class="o">*</span><span class="p">(</span><span class="n">n1</span><span class="o">+</span><span class="mf">15.0</span><span class="p">),</span> <span class="n">step</span><span class="p">)</span>
        <span class="n">a2</span><span class="p">,</span><span class="n">b2</span><span class="p">,</span><span class="n">start2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RadialWavefunction</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">j2</span><span class="p">)</span><span class="o">/</span><span class="mf">27.211</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">alphaC</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mf">3.0</span><span class="p">),</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">n2</span><span class="o">*</span><span class="p">(</span><span class="n">n2</span><span class="o">+</span><span class="mf">15.0</span><span class="p">),</span> <span class="n">step</span><span class="p">)</span>
        
        <span class="n">quadrupoleElement</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">br</span> <span class="o">=</span> <span class="n">start1</span>
        <span class="k">if</span> <span class="n">br</span><span class="o">&lt;</span><span class="n">start2</span><span class="p">:</span>
            <span class="n">br</span> <span class="o">=</span> <span class="n">start2</span>
        
        <span class="c1"># START of the new way of summing</span>
        <span class="n">upTo</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a1</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">a2</span><span class="p">))</span>
        
        <span class="k">print</span> <span class="n">upTo</span>
        <span class="k">print</span> <span class="n">br</span>
        
        <span class="n">b1</span> <span class="o">=</span> <span class="n">b1</span><span class="p">[</span><span class="n">br</span><span class="p">:</span><span class="n">upTo</span><span class="p">]</span>
        <span class="n">b2</span> <span class="o">=</span> <span class="n">b2</span><span class="p">[</span><span class="n">br</span><span class="p">:</span><span class="n">upTo</span><span class="p">]</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="n">a1</span><span class="p">[</span><span class="n">br</span><span class="p">:</span><span class="n">upTo</span><span class="p">]</span>
        
        <span class="n">quadrupoleElement</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span><span class="n">b2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span><span class="n">a1</span><span class="p">)</span><span class="o">*</span><span class="n">step</span><span class="p">))</span>    
        <span class="c1"># END of the new way of summing</span>
        
        <span class="c1"># START of the old way of summing</span>
        <span class="c1">#while br&lt;len(a1) and br&lt;len(a2):</span>
        <span class="c1">#    quadrupoleElement = quadrupoleElement+b1[br]*b2[br]*a1[br]*a1[br]*step</span>
        <span class="c1">#    br += 1</span>
        <span class="c1"># END of the old way of summing</span>
        
        <span class="c1">## TO-DO: make memort for quadrupole elements</span>
        <span class="c1">## with dipoleMatrixElement as numpy array</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quadrupoleMatrixElement</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">quadrupoleMatrixElement</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quadrupoleMatrixElement</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">quadrupoleElement</span><span class="p">]])),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">quadrupoleMatrixElement</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">quadrupoleElement</span><span class="p">]])</span>
        
        <span class="k">return</span> <span class="n">quadrupoleElement</span>  </div>
        
    
<div class="viewcode-block" id="AlkaliAtom.getReducedMatrixElement_JBasis_Steck"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.AlkaliAtom.getReducedMatrixElement_JBasis_Steck">[docs]</a>    <span class="k">def</span> <span class="nf">getReducedMatrixElement_JBasis_Steck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">):</span>
        <span class="c1"># returns reduced matrix element as it is defined and used in Steck</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTransitionFrequency</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">j2</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">n2</span>
            <span class="n">n2</span> <span class="o">=</span> <span class="n">n1</span>
            <span class="n">n1</span> <span class="o">=</span> <span class="n">temp</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">l1</span>
            <span class="n">l1</span> <span class="o">=</span> <span class="n">l2</span>
            <span class="n">l2</span> <span class="o">=</span> <span class="n">temp</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">j1</span>
            <span class="n">j1</span> <span class="o">=</span> <span class="n">j2</span>
            <span class="n">j2</span> <span class="o">=</span> <span class="n">temp</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">((</span><span class="n">l1</span><span class="o">-</span><span class="n">l2</span><span class="o">+</span><span class="mf">1.0</span><span class="p">))</span><span class="o">/</span><span class="mf">2.0</span><span class="o">+</span><span class="n">j2</span><span class="o">+</span><span class="n">l1</span><span class="o">+</span><span class="mf">1.0</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="c1">#print s</span>
        <span class="c1">#print (-1)**s</span>
        <span class="c1">#print j2,&quot; &quot;,l1</span>
        <span class="c1">#print sqrt((2.0*j2+1.0)*(2.0*l1+1.0))</span>
        <span class="c1">#print Wigner6j(l1,l2,1,j2,j1,0.5)</span>
        <span class="c1">#print sqrt(float(max(l1,l2))/(2.0*l1+1.0))</span>
        <span class="c1">#print float(max(l1,l2))</span>
        <span class="c1">#print l1,&quot;,&quot;,l2</span>
        <span class="c1">#print &quot;dm = &quot;,self.getDipoleMatrixElement(n1, l1, j1, n2, l2, j2)</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="n">l2</span><span class="o">+</span><span class="n">l1</span><span class="o">+</span><span class="mf">3.</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="o">+</span><span class="mf">0.5</span><span class="o">+</span><span class="n">j2</span><span class="p">))</span><span class="o">*</span><span class="n">sqrt</span><span class="p">((</span><span class="mf">2.0</span><span class="o">*</span><span class="n">j2</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">l1</span><span class="o">+</span><span class="mf">1.0</span><span class="p">))</span><span class="o">*</span><span class="n">Wigner6j</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span><span class="n">l2</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">l1</span><span class="o">+</span><span class="mf">1.0</span><span class="p">))</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">getDipoleMatrixElement</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">j2</span><span class="p">)</span></div>


<div class="viewcode-block" id="AlkaliAtom.getReducedMatrixElement_JBasis_U"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.AlkaliAtom.getReducedMatrixElement_JBasis_U">[docs]</a>    <span class="k">def</span> <span class="nf">getReducedMatrixElement_JBasis_U</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">):</span>
        <span class="c1"># atoms go from n1 state to n2 state</span>
        <span class="c1"># returns reduced matrix element as it is naturally obtained from multiplication of three spherical harmonics</span>
        <span class="c1"># in calculation of dipole matrix elements. In convention used in Steck, this is labelled as (j || e r || j&#39;)</span>
        <span class="c1"># and can be related to the values in steck by dividing with sqrt(2*j+1)</span>

        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">l1</span><span class="o">+</span><span class="mf">0.5</span><span class="o">+</span><span class="n">j2</span><span class="o">+</span><span class="mf">1.</span><span class="p">))</span><span class="o">*</span><span class="n">sqrt</span><span class="p">((</span><span class="mf">2.</span><span class="o">*</span><span class="n">j1</span><span class="o">+</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">j2</span><span class="o">+</span><span class="mf">1.</span><span class="p">))</span><span class="o">*</span><span class="n">Wigner6j</span><span class="p">(</span><span class="n">j1</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">l1</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">getReducedMatrixElement_LBasis_U</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">)</span></div>

<div class="viewcode-block" id="AlkaliAtom.getReducedMatrixElement_LBasis_U"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.AlkaliAtom.getReducedMatrixElement_LBasis_U">[docs]</a>    <span class="k">def</span> <span class="nf">getReducedMatrixElement_LBasis_U</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">):</span>
        <span class="c1"># atoms go from n1 state to n2 state</span>
        <span class="c1"># returns reduced matrix element as it is naturally obtained from multiplication of three spherical harmonics</span>

        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="n">l1</span><span class="o">*</span><span class="n">sqrt</span><span class="p">((</span><span class="mf">2.0</span><span class="o">*</span><span class="n">l1</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">l2</span><span class="o">+</span><span class="mf">1.0</span><span class="p">))</span><span class="o">*</span><span class="n">Wigner3j</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">getDipoleMatrixElement</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">j2</span><span class="p">)</span></div>

<div class="viewcode-block" id="AlkaliAtom.c6term"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.AlkaliAtom.c6term">[docs]</a>    <span class="k">def</span> <span class="nf">c6term</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">):</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDipoleMatrixElement</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">)</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDipoleMatrixElement</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">)</span>
        <span class="n">d1d2</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">epsilon_0</span><span class="p">)</span><span class="o">*</span><span class="n">d1</span><span class="o">*</span><span class="n">d2</span><span class="o">*</span><span class="n">elemCharge</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">physical_constants</span><span class="p">[</span><span class="s2">&quot;Bohr radius&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">d1d2</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">elemCharge</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">)))</span></div>

<div class="viewcode-block" id="AlkaliAtom.energyDefect"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.AlkaliAtom.energyDefect">[docs]</a>    <span class="k">def</span> <span class="nf">energyDefect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">):</span>
        <span class="c1"># returns energy defect in SI units (for 2x n,l,j &lt;-&gt; n1,l1,j1 n2,l2,j2)</span>
        <span class="k">return</span> <span class="n">elemCharge</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="AlkaliAtom.energyDefect2"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.AlkaliAtom.energyDefect2">[docs]</a>    <span class="k">def</span> <span class="nf">energyDefect2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">nn</span><span class="p">,</span><span class="n">ll</span><span class="p">,</span><span class="n">jj</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">):</span>
        <span class="c1"># returns energy defect in SI units (for  n,l,j nn,ll,jj &lt;-&gt; n1,l1,j1 n2,l2,j2)</span>
        <span class="k">return</span> <span class="n">elemCharge</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">)</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">nn</span><span class="p">,</span><span class="n">ll</span><span class="p">,</span><span class="n">jj</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="AlkaliAtom.updateDipoleMatrixElementsFile"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.AlkaliAtom.updateDipoleMatrixElementsFile">[docs]</a>    <span class="k">def</span> <span class="nf">updateDipoleMatrixElementsFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># save dipole elements</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dipoleMatrixElementFile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dipoleMatrixElement</span><span class="p">)</span> 
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Error while updating dipoleMatrixElements File &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dipoleMatrixElementFile</span>
            <span class="k">print</span> <span class="n">e</span>
        <span class="c1"># save quadrupole elements</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quadrupoleMatrixElementFile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quadrupoleMatrixElement</span><span class="p">)</span> 
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Error while updating quadrupoleMatrixElements File &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">quadrupoleMatrixElementFile</span>
            <span class="k">print</span> <span class="n">e</span></div>

<div class="viewcode-block" id="AlkaliAtom.transitionRate"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.AlkaliAtom.transitionRate">[docs]</a>    <span class="k">def</span> <span class="nf">transitionRate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">temperature</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">):</span>
        <span class="c1"># calculates transition rate in s^-1 at given temperature due to interaction with the vacuum field</span>
        <span class="c1"># temperature is in K</span>
        <span class="c1"># for temperature = 0, returns Einstein A coefficient</span>
        <span class="c1"># state1 = [n1,l1,j1]   state2 = [n2,l2,j2]</span>
        
        <span class="c1"># debug</span>
        <span class="c1">#dipoleRadialPart = 3.*elemCharge*(physical_constants[&quot;Bohr radius&quot;][0])</span>
        <span class="c1"># old</span>
        <span class="n">dipoleRadialPart</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTransitionFrequency</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">j2</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">dipoleRadialPart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getReducedMatrixElement_JBasis_Steck</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">j2</span><span class="p">)</span><span class="o">*</span><span class="n">elemCharge</span><span class="o">*</span><span class="p">(</span><span class="n">physical_constants</span><span class="p">[</span><span class="s2">&quot;Bohr radius&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">dipoleRadialPart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getReducedMatrixElement_JBasis_Steck</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">j1</span><span class="p">)</span><span class="o">*</span><span class="n">elemCharge</span><span class="o">*</span><span class="p">(</span><span class="n">physical_constants</span><span class="p">[</span><span class="s2">&quot;Bohr radius&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">omega</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">getTransitionFrequency</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">j2</span><span class="p">))</span>

        <span class="n">modeOccupationTerm</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTransitionFrequency</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">j2</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">modeOccupationTerm</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">+</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">exp</span><span class="p">(</span><span class="n">hbar</span><span class="o">*</span><span class="n">omega</span><span class="o">/</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">temperature</span><span class="p">))</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># transition going up in energy - only possible by absorbing thermal photons</span>
            <span class="n">modeOccupationTerm</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">exp</span><span class="p">(</span><span class="n">hbar</span><span class="o">*</span><span class="n">omega</span><span class="o">/</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">temperature</span><span class="p">))</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>

        <span class="c1">#check this!</span>
        <span class="n">jUp</span> <span class="o">=</span> <span class="n">j1</span>
        <span class="n">jDown</span> <span class="o">=</span> <span class="n">j2</span>
        
        
        <span class="k">return</span> <span class="n">omega</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">jDown</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="n">dipoleRadialPart</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">epsilon_0</span><span class="o">*</span><span class="n">hbar</span><span class="o">*</span><span class="n">c</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">jUp</span><span class="o">+</span><span class="mf">1.</span><span class="p">))</span><span class="o">*</span><span class="n">modeOccupationTerm</span></div>
        
<div class="viewcode-block" id="AlkaliAtom.getRadialCoupling"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.AlkaliAtom.getRadialCoupling">[docs]</a>    <span class="k">def</span> <span class="nf">getRadialCoupling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">):</span>
        <span class="n">dl</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">l</span><span class="o">-</span><span class="n">l1</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dl</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">j1</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">1.1</span><span class="p">):</span>
            <span class="c1">#print n,&quot; &quot;,l,&quot; &quot;,j,&quot; &quot;,n1,&quot; &quot;,l1,&quot; &quot;,j1</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDipoleMatrixElement</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">dl</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">dl</span><span class="o">==</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">dl</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span> <span class="ow">and</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">j1</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">2.1</span><span class="p">):</span>
            <span class="c1"># quadrupole coupling</span>
            <span class="c1">#return 0.</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getQuadrupoleMatrixElement</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># neglect octopole coupling and higher</span>
            <span class="k">print</span> <span class="s2">&quot;NOTE: Neglecting couplings higher then quadrupole&quot;</span>
            <span class="k">return</span> <span class="mi">0</span></div>
        
<div class="viewcode-block" id="AlkaliAtom.getAverageSpeed"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.AlkaliAtom.getAverageSpeed">[docs]</a>    <span class="k">def</span> <span class="nf">getAverageSpeed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">temperature</span><span class="p">):</span>
        <span class="c1"># returns average speed along one axis \sqrt{2 k_b T / m} for temperature in K</span>
        <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">temperature</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">mass</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="Caesium"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.Caesium">[docs]</a><span class="k">class</span> <span class="nc">Caesium</span><span class="p">(</span><span class="n">AlkaliAtom</span><span class="p">):</span>
    <span class="c1"># ALL PARAMETERES ARE IN ATOMIC UNITS (HATREE)</span>
    <span class="n">alphaC</span>  <span class="o">=</span> <span class="mf">15.6440</span>

    <span class="n">a1</span> <span class="o">=</span> <span class="p">[</span><span class="mf">3.49546309</span><span class="p">,</span> <span class="mf">4.69366096</span><span class="p">,</span> <span class="mf">4.32466196</span><span class="p">,</span> <span class="mf">3.01048361</span><span class="p">]</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.47533800</span><span class="p">,</span> <span class="mf">1.71398344</span><span class="p">,</span> <span class="mf">1.61365288</span><span class="p">,</span> <span class="mf">1.40000001</span><span class="p">]</span>
    <span class="n">a3</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">9.72143084</span><span class="p">,</span> <span class="o">-</span><span class="mf">24.65624280</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.70128850</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.20036138</span><span class="p">]</span>
    <span class="n">a4</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.02629242</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.09543125</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.74095193</span><span class="p">,</span> <span class="mf">0.00034538</span><span class="p">]</span>
    <span class="n">rc</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.92046930</span><span class="p">,</span> <span class="mf">2.13383095</span><span class="p">,</span> <span class="mf">0.93007296</span><span class="p">,</span> <span class="mf">1.99969677</span><span class="p">]</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="mi">55</span>
    
    <span class="n">ionisationEnergy</span> <span class="o">=</span> <span class="mf">3.893905548</span>  <span class="c1"># eV</span>
    
    <span class="c1"># State energies sEnergy [a,b] = state energy for n=a+1, l = b; j = l-1/2</span>
    <span class="c1"># sEnergy [l,n] = state energy for j = l+1/2</span>
    <span class="n">sEnergy</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">NISTdataLevels</span> <span class="o">=</span> <span class="mi">25</span>
    
    <span class="c1"># quantum defects from PRA 26, 2733 (1982)</span>
    <span class="c1"># first index [0]:  j-1/2    [1]: j+1/2</span>
    <span class="c1"># second index [0..4] : s,p,d,f</span>
    <span class="c1"># third index [delta0,delta2...]</span>
    <span class="c1"># NOTE: f_7/2 quantum defects are PUT TO BE EXACTLY the same as f_5/2 (~10MHz difference?!)</span>
    <span class="n">quantumDefect</span> <span class="o">=</span> <span class="p">[[[</span><span class="mf">4.0493527</span><span class="p">,</span><span class="mf">0.238100</span><span class="p">,</span><span class="mf">0.24688</span><span class="p">,</span><span class="mf">0.06785</span><span class="p">,</span><span class="mf">0.1135</span><span class="p">],[</span><span class="mf">3.5914856</span><span class="p">,</span><span class="mf">0.380223</span><span class="p">,</span><span class="o">-</span><span class="mf">0.64771</span><span class="p">,</span><span class="mf">20.9538</span><span class="p">,</span><span class="o">-</span><span class="mf">84.108</span><span class="p">],[</span><span class="mf">2.4754562</span><span class="p">,</span><span class="mf">0.009320</span><span class="p">,</span><span class="o">-</span><span class="mf">0.43498</span><span class="p">,</span><span class="o">-</span><span class="mf">0.76358</span><span class="p">,</span><span class="o">-</span><span class="mf">18.0061</span><span class="p">],[</span><span class="mf">0.03341424</span><span class="p">,</span><span class="o">-</span><span class="mf">0.198674</span><span class="p">,</span><span class="mf">0.28953</span><span class="p">,</span><span class="o">-</span><span class="mf">0.2601</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]],</span>
                     <span class="p">[[</span><span class="mf">4.0493527</span><span class="p">,</span><span class="mf">0.238100</span><span class="p">,</span><span class="mf">0.24688</span><span class="p">,</span><span class="mf">0.06785</span><span class="p">,</span><span class="mf">0.1135</span><span class="p">],[</span><span class="mf">3.5589599</span><span class="p">,</span><span class="mf">0.392469</span><span class="p">,</span><span class="o">-</span><span class="mf">0.67431</span><span class="p">,</span><span class="mf">22.3531</span><span class="p">,</span><span class="o">-</span><span class="mf">92.289</span><span class="p">],[</span><span class="mf">2.4663091</span><span class="p">,</span><span class="mf">0.014964</span><span class="p">,</span><span class="o">-</span><span class="mf">0.45828</span><span class="p">,</span><span class="o">-</span><span class="mf">0.25489</span><span class="p">,</span><span class="o">-</span><span class="mf">19.6900</span><span class="p">],[</span><span class="mf">0.03341424</span><span class="p">,</span><span class="o">-</span><span class="mf">0.198674</span><span class="p">,</span><span class="mf">0.28953</span><span class="p">,</span><span class="o">-</span><span class="mf">0.2601</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]]]</span>
    <span class="n">scaledRydbergConstant</span> <span class="o">=</span> <span class="mf">3.289828299</span><span class="o">*</span><span class="mf">4.135668</span>  <span class="c1"># in eV</span>

    <span class="n">levelDataFromNIST</span> <span class="o">=</span> <span class="s2">&quot;cs_NIST_level_data.ascii&quot;</span>
    
    <span class="n">dipoleMatrixElementFile</span> <span class="o">=</span> <span class="s2">&quot;cs_dipole_matrix_elements.npy&quot;</span>
    <span class="n">quadrupoleMatrixElementFile</span> <span class="o">=</span> <span class="s2">&quot;cs_quadrupole_matrix_elements.npy&quot;</span>

    <span class="c1"># levels that are for smaller n than ground level, but are above in energy due to angular part</span>
    <span class="n">extraLevels</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="o">+</span><span class="mf">0.5</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="o">-</span><span class="mf">0.5</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="o">+</span><span class="mf">0.5</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="o">-</span><span class="mf">0.5</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="o">+</span><span class="mf">0.5</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="o">-</span><span class="mf">0.5</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="o">+</span><span class="mf">0.5</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="o">-</span><span class="mf">0.5</span><span class="p">]]</span>
    
    <span class="n">mass</span> <span class="o">=</span> <span class="mf">132.905429</span><span class="o">*</span><span class="n">physical_constants</span><span class="p">[</span><span class="s2">&quot;atomic mass constant&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">abundance</span> <span class="o">=</span> <span class="mf">1.000</span>
    
    <span class="n">elementName</span> <span class="o">=</span> <span class="s2">&quot;Cs133&quot;</span>
       
<div class="viewcode-block" id="Caesium.getPressure"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.Caesium.getPressure">[docs]</a>    <span class="k">def</span> <span class="nf">getPressure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">temperature</span><span class="p">):</span>
        <span class="c1"># returns pressure in Pa for temperature in K</span>
    
        <span class="k">if</span> <span class="n">temperature</span><span class="o">&lt;</span><span class="mf">28.5</span><span class="o">+</span><span class="mf">273.15</span><span class="p">:</span>
            <span class="c1"># Cs is in solid phase (from table 2. for recommended equations / +-5%) </span>
            <span class="k">return</span> <span class="mf">10.0</span><span class="o">**</span><span class="p">(</span><span class="mf">2.881</span><span class="o">+</span><span class="mf">4.711</span><span class="o">-</span><span class="mf">3999.</span><span class="o">/</span><span class="n">temperature</span><span class="p">)</span><span class="o">*</span><span class="mf">133.322368</span>
        
        <span class="k">elif</span> <span class="n">temperature</span><span class="o">&lt;</span><span class="mf">550.</span><span class="o">+</span><span class="mf">273.15</span><span class="p">:</span>
            <span class="c1"># Cs is in liquid phase (from table 3. of the cited reference &quot;precisely fitted equations / +- 1%)</span>
            <span class="k">return</span> <span class="mf">10.0</span><span class="o">**</span><span class="p">(</span><span class="mf">2.881</span><span class="o">+</span><span class="mf">8.232</span><span class="o">-</span><span class="mf">4062.</span><span class="o">/</span><span class="n">temperature</span><span class="o">-</span><span class="mf">1.3359</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="o">/</span><span class="n">log</span><span class="p">(</span><span class="mf">10.</span><span class="p">))</span><span class="o">*</span><span class="mf">133.322368</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;ERROR: Cs vapour pressure above 550 C is unknown (limits of experimental interpolation)&quot;</span>
            <span class="k">return</span> <span class="mi">0</span></div>
        
<div class="viewcode-block" id="Caesium.getPressureOld"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.Caesium.getPressureOld">[docs]</a>    <span class="k">def</span> <span class="nf">getPressureOld</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">temperature</span><span class="p">):</span>
        <span class="c1"># returns pressure in Pa for temperature in K</span>

        <span class="c1"># from A.N.Nesmeyanov, Vapor Pressure of the Chemical Elements (Elsevier, Amsterdam, 1963). English edition</span>
        <span class="c1"># edited by Robert Gary</span>
        <span class="c1"># as was found in Steck Alkali metal data, revision 1.6, 14 October 2003</span>
        
        <span class="k">print</span> <span class="s2">&quot;WARNING: getPressureOld is provided just for reference for the old versions of the programme&quot;</span>
        <span class="k">print</span> <span class="s2">&quot;New programmes should use getPressure function instead !&quot;</span>
        
        <span class="k">if</span> <span class="n">temperature</span><span class="o">&lt;</span><span class="mf">28.44</span><span class="o">+</span><span class="mf">273.15</span><span class="p">:</span>
            <span class="c1"># Cs is in solid phase</span>
            <span class="k">return</span> <span class="mf">10.0</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">219.482</span><span class="o">+</span><span class="mf">1088.676</span><span class="o">/</span><span class="n">temperature</span><span class="o">-</span><span class="mf">0.08336185</span><span class="o">*</span><span class="n">temperature</span><span class="o">+</span><span class="mf">94.88752</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="o">/</span><span class="n">log</span><span class="p">(</span><span class="mf">10.0</span><span class="p">))</span><span class="o">*</span><span class="mf">133.322368</span>
        
        <span class="k">elif</span> <span class="n">temperature</span><span class="o">&lt;</span><span class="mi">671</span><span class="o">+</span><span class="mf">273.15</span><span class="p">:</span>
            <span class="c1"># Cs is in liquid phase</span>
            <span class="k">return</span> <span class="mf">10.0</span><span class="o">**</span><span class="p">(</span><span class="mf">8.22127</span><span class="o">-</span><span class="mf">4006.048</span><span class="o">/</span><span class="n">temperature</span><span class="o">-</span><span class="mf">0.00060194</span><span class="o">*</span><span class="n">temperature</span><span class="o">-</span><span class="mf">0.19623</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="o">/</span><span class="n">log</span><span class="p">(</span><span class="mf">10.0</span><span class="p">))</span><span class="o">*</span><span class="mf">133.322368</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;ERROR: Cs vapour pressure above 671 C is unknown (limits of experimental interpolation)&quot;</span>
            <span class="k">return</span> <span class="mi">0</span></div></div>

<div class="viewcode-block" id="Rubidium"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.Rubidium">[docs]</a><span class="k">class</span> <span class="nc">Rubidium</span><span class="p">(</span><span class="n">AlkaliAtom</span><span class="p">):</span>
    <span class="c1"># ALL PARAMETERES ARE IN ATOMIC UNITS (HATREE)</span>
    <span class="n">alphaC</span>  <span class="o">=</span> <span class="mf">9.0760</span>

    <span class="n">a1</span> <span class="o">=</span> <span class="p">[</span><span class="mf">3.69628474</span><span class="p">,</span> <span class="mf">4.44088978</span><span class="p">,</span> <span class="mf">3.78717363</span><span class="p">,</span> <span class="mf">2.39848933</span><span class="p">]</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.64915255</span><span class="p">,</span> <span class="mf">1.92828831</span><span class="p">,</span> <span class="mf">1.57027864</span><span class="p">,</span> <span class="mf">1.76810544</span><span class="p">]</span>
    <span class="n">a3</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">9.86069196</span><span class="p">,</span> <span class="o">-</span><span class="mf">16.79597770</span><span class="p">,</span> <span class="o">-</span><span class="mf">11.65588970</span><span class="p">,</span> <span class="o">-</span><span class="mf">12.07106780</span><span class="p">]</span>
    <span class="n">a4</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.19579987</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.8163314</span><span class="p">,</span> <span class="mf">0.52942835</span><span class="p">,</span> <span class="mf">0.77256589</span><span class="p">]</span>
    <span class="n">rc</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.66242117</span><span class="p">,</span> <span class="mf">1.50195124</span><span class="p">,</span> <span class="mf">4.86851938</span><span class="p">,</span> <span class="mf">4.79831327</span><span class="p">]</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="mi">37</span>
    
    <span class="n">NISTdataLevels</span> <span class="o">=</span> <span class="mi">77</span>
    <span class="n">ionisationEnergy</span> <span class="o">=</span> <span class="mf">4.177128</span>
    
    <span class="c1"># quantum defects from Physical Review A, 67:052502, 2003 and Physical Review A, 74:054502, 2006</span>
    <span class="n">quantumDefect</span> <span class="o">=</span> <span class="p">[[[</span><span class="mf">3.1311804</span><span class="p">,</span><span class="mf">0.1784</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">2.6548849</span><span class="p">,</span><span class="mf">0.2900</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">1.34809171</span><span class="p">,</span><span class="o">-</span><span class="mf">0.60286</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.0165192</span><span class="p">,</span><span class="o">-</span><span class="mf">0.085</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]],</span>
                     <span class="p">[[</span><span class="mf">3.1311804</span><span class="p">,</span><span class="mf">0.1784</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">2.6416737</span><span class="p">,</span><span class="mf">0.2950</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">1.34646572</span><span class="p">,</span><span class="o">-</span><span class="mf">0.59600</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.0165437</span><span class="p">,</span><span class="o">-</span><span class="mf">0.086</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]]]</span>
    <span class="n">scaledRydbergConstant</span> <span class="o">=</span> <span class="mf">13.6059124</span>  <span class="c1"># 13.61</span>
    
    <span class="n">levelDataFromNIST</span> <span class="o">=</span> <span class="s2">&quot;rb_NIST_level_data.ascii&quot;</span>
    <span class="n">dipoleMatrixElementFile</span> <span class="o">=</span> <span class="s2">&quot;rb_dipole_matrix_elements.npy&quot;</span>
    <span class="n">quadrupoleMatrixElementFile</span> <span class="o">=</span> <span class="s2">&quot;rb_quadrupole_matrix_elements.npy&quot;</span>
    
    <span class="c1"># levels that are for smaller n than ground level, but are above in energy due to angular part</span>
    <span class="n">extraLevels</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="o">+</span><span class="mf">0.5</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="o">-</span><span class="mf">0.5</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="o">+</span><span class="mf">0.5</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="o">-</span><span class="mf">0.5</span><span class="p">]]</span>

    <span class="n">mass</span> <span class="o">=</span> <span class="mf">85.4678</span><span class="o">*</span><span class="n">physical_constants</span><span class="p">[</span><span class="s2">&quot;atomic mass constant&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">elementName</span> <span class="o">=</span> <span class="s2">&quot;Rb&quot;</span>

<div class="viewcode-block" id="Rubidium.getPressure"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.Rubidium.getPressure">[docs]</a>    <span class="k">def</span> <span class="nf">getPressure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">temperature</span><span class="p">):</span>
        <span class="c1"># returns pressure in Pa for temperature in K</span>
         
        <span class="k">if</span> <span class="n">temperature</span><span class="o">&lt;</span><span class="mf">39.3</span><span class="o">+</span><span class="mf">273.15</span><span class="p">:</span>
            <span class="c1"># Rb is in solid phase (from table 2. for recommended equations / +-5%) </span>
            <span class="k">return</span> <span class="mf">10.0</span><span class="o">**</span><span class="p">(</span><span class="mf">2.881</span><span class="o">+</span><span class="mf">4.857</span><span class="o">-</span><span class="mf">4215.</span><span class="o">/</span><span class="n">temperature</span><span class="p">)</span><span class="o">*</span><span class="mf">133.322368</span>
        
        <span class="k">elif</span> <span class="n">temperature</span><span class="o">&lt;</span><span class="mf">550.</span><span class="o">+</span><span class="mf">273.15</span><span class="p">:</span>
            <span class="c1"># Rb is in liquid phase (from table 3. of the cited reference &quot;precisely fitted equations / +- 1%)</span>
            <span class="k">return</span> <span class="mf">10.0</span><span class="o">**</span><span class="p">(</span><span class="mf">2.881</span><span class="o">+</span><span class="mf">8.316</span><span class="o">-</span><span class="mf">4275.</span><span class="o">/</span><span class="n">temperature</span><span class="o">-</span><span class="mf">1.3102</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="o">/</span><span class="n">log</span><span class="p">(</span><span class="mf">10.</span><span class="p">))</span><span class="o">*</span><span class="mf">133.322368</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;ERROR: Rb vapour pressure above 550 C is unknown (limits of experimental interpolation)&quot;</span>
            <span class="k">return</span> <span class="mi">0</span></div></div>

<div class="viewcode-block" id="Lithium6"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.Lithium6">[docs]</a><span class="k">class</span> <span class="nc">Lithium6</span><span class="p">(</span><span class="n">AlkaliAtom</span><span class="p">):</span> <span class="c1"># Li</span>
    <span class="c1"># ALL PARAMETERES ARE IN ATOMIC UNITS (HATREE)</span>
    <span class="n">alphaC</span>  <span class="o">=</span> <span class="mf">0.1923</span>
    <span class="c1"># model potential parameters from Marinescu et.al, PRA 49:982 (1994)</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.47718079</span><span class="p">,</span> <span class="mf">3.45414648</span><span class="p">,</span> <span class="mf">2.51909839</span><span class="p">,</span> <span class="mf">2.51909839</span><span class="p">]</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.84150932</span><span class="p">,</span> <span class="mf">2.55151080</span><span class="p">,</span> <span class="mf">2.43712450</span><span class="p">,</span> <span class="mf">2.43712450</span><span class="p">]</span>
    <span class="n">a3</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.02169712</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.21646561</span><span class="p">,</span> <span class="mf">0.32505524</span><span class="p">,</span> <span class="mf">0.32505524</span><span class="p">]</span>
    <span class="n">a4</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.11988362</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.06990078</span><span class="p">,</span> <span class="mf">0.10602430</span><span class="p">,</span> <span class="mf">0.10602430</span><span class="p">]</span>
    <span class="n">rc</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.61340824</span><span class="p">,</span> <span class="mf">0.61566441</span><span class="p">,</span> <span class="mf">2.34126273</span><span class="p">,</span> <span class="mf">2.34126273</span><span class="p">]</span>
    
    <span class="n">Z</span> <span class="o">=</span> <span class="mi">3</span>
    
    <span class="n">NISTdataLevels</span> <span class="o">=</span> <span class="mi">42</span>
    <span class="n">ionisationEnergy</span> <span class="o">=</span> <span class="mf">5.391714951</span>  <span class="c1"># NIST ASD L12261</span>
    
    
    <span class="c1"># quantum defects from PRA 34, 2889 (1986); and (for D_J and F_J) from Physica Scripta 27:300-305 (1983) </span>
    <span class="n">quantumDefect</span> <span class="o">=</span> <span class="p">[[[</span><span class="mf">0.3995101</span><span class="p">,</span><span class="mf">0.0290</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.0471835</span><span class="p">,</span><span class="o">-</span><span class="mf">0.024</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.002129</span><span class="p">,</span><span class="o">-</span><span class="mf">0.01491</span><span class="p">,</span><span class="mf">0.1759</span><span class="p">,</span><span class="o">-</span><span class="mf">0.8507</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="o">-</span><span class="mf">0.000077</span><span class="p">,</span><span class="mf">0.021856</span><span class="p">,</span><span class="o">-</span><span class="mf">0.4211</span><span class="p">,</span><span class="mf">2.3891</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]],</span>
                     <span class="p">[[</span><span class="mf">0.3995101</span><span class="p">,</span><span class="mf">0.0290</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.0471720</span><span class="p">,</span><span class="o">-</span><span class="mf">0.024</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.002129</span><span class="p">,</span><span class="o">-</span><span class="mf">0.01491</span><span class="p">,</span><span class="mf">0.1759</span><span class="p">,</span><span class="o">-</span><span class="mf">0.8507</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="o">-</span><span class="mf">0.000077</span><span class="p">,</span><span class="mf">0.021856</span><span class="p">,</span><span class="o">-</span><span class="mf">0.4211</span><span class="p">,</span><span class="mf">2.3891</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]]]</span>
    <span class="n">scaledRydbergConstant</span> <span class="o">=</span> <span class="mf">13.60445823</span>
    
    <span class="n">levelDataFromNIST</span> <span class="o">=</span> <span class="s2">&quot;li_NIST_level_data.ascii&quot;</span>
    <span class="n">dipoleMatrixElementFile</span> <span class="o">=</span> <span class="s2">&quot;li6_dipole_matrix_elements.npy&quot;</span>
    <span class="n">quadrupoleMatrixElementFile</span> <span class="o">=</span> <span class="s2">&quot;li6_quadrupole_matrix_elements.npy&quot;</span>

    <span class="c1"># levels that are for smaller n than ground level, but are above in energy due to angular part</span>
    <span class="n">extraLevels</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="n">mass</span> <span class="o">=</span> <span class="mf">6.015121</span><span class="o">*</span><span class="n">physical_constants</span><span class="p">[</span><span class="s2">&quot;atomic mass constant&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">abundance</span> <span class="o">=</span> <span class="mf">0.075</span>
    
    <span class="n">elementName</span> <span class="o">=</span> <span class="s2">&quot;Li6&quot;</span>

    
<div class="viewcode-block" id="Lithium6.getPressure"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.Lithium6.getPressure">[docs]</a>    <span class="k">def</span> <span class="nf">getPressure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">temperature</span><span class="p">):</span>
        <span class="c1"># returns pressure in Pa for temperature in K</span>
         
        <span class="k">if</span> <span class="n">temperature</span><span class="o">&lt;</span><span class="mf">180.5</span><span class="o">+</span><span class="mf">273.15</span><span class="p">:</span>
            <span class="c1"># Li is in liquid phase (from table 3. of the cited reference &quot;precisely fitted equations / +- 1%) </span>
            <span class="k">return</span> <span class="mf">10.0</span><span class="o">**</span><span class="p">(</span><span class="mf">2.881</span><span class="o">+</span><span class="mf">7.790</span><span class="o">-</span><span class="mf">8423.</span><span class="o">/</span><span class="n">temperature</span><span class="o">-</span><span class="mf">0.7074</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="o">/</span><span class="n">log</span><span class="p">(</span><span class="mf">10.</span><span class="p">))</span><span class="o">*</span><span class="mf">133.322368</span>
        
        <span class="k">elif</span> <span class="n">temperature</span><span class="o">&lt;</span><span class="mf">1000.</span><span class="o">+</span><span class="mf">273.15</span><span class="p">:</span>
            <span class="c1"># Li is in liquid phase (from table 3. of the cited reference &quot;precisely fitted equations / +- 1%)</span>
            <span class="k">return</span> <span class="mf">10.0</span><span class="o">**</span><span class="p">(</span><span class="mf">2.881</span><span class="o">+</span><span class="mf">8.409</span><span class="o">-</span><span class="mf">8320.</span><span class="o">/</span><span class="n">temperature</span><span class="o">-</span><span class="mf">1.0255</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="o">/</span><span class="n">log</span><span class="p">(</span><span class="mf">10.</span><span class="p">))</span><span class="o">*</span><span class="mf">133.322368</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;ERROR: Li vapour pressure above 1000 C is unknown (limits of experimental interpolation)&quot;</span>
            <span class="k">return</span> <span class="mi">0</span></div></div>

<div class="viewcode-block" id="Lithium7"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.Lithium7">[docs]</a><span class="k">class</span> <span class="nc">Lithium7</span><span class="p">(</span><span class="n">AlkaliAtom</span><span class="p">):</span> <span class="c1"># Li</span>
    <span class="c1"># ALL PARAMETERES ARE IN ATOMIC UNITS (HATREE)</span>
    <span class="n">alphaC</span>  <span class="o">=</span> <span class="mf">0.1923</span>
    <span class="c1"># model potential parameters from Marinescu et.al, PRA 49:982 (1994)</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.47718079</span><span class="p">,</span> <span class="mf">3.45414648</span><span class="p">,</span> <span class="mf">2.51909839</span><span class="p">,</span> <span class="mf">2.51909839</span><span class="p">]</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.84150932</span><span class="p">,</span> <span class="mf">2.55151080</span><span class="p">,</span> <span class="mf">2.43712450</span><span class="p">,</span> <span class="mf">2.43712450</span><span class="p">]</span>
    <span class="n">a3</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.02169712</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.21646561</span><span class="p">,</span> <span class="mf">0.32505524</span><span class="p">,</span> <span class="mf">0.32505524</span><span class="p">]</span>
    <span class="n">a4</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.11988362</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.06990078</span><span class="p">,</span> <span class="mf">0.10602430</span><span class="p">,</span> <span class="mf">0.10602430</span><span class="p">]</span>
    <span class="n">rc</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.61340824</span><span class="p">,</span> <span class="mf">0.61566441</span><span class="p">,</span> <span class="mf">2.34126273</span><span class="p">,</span> <span class="mf">2.34126273</span><span class="p">]</span>
    
    <span class="n">Z</span> <span class="o">=</span> <span class="mi">3</span>
    
    <span class="n">NISTdataLevels</span> <span class="o">=</span> <span class="mi">42</span>
    <span class="n">ionisationEnergy</span> <span class="o">=</span> <span class="mf">5.391714951</span>  <span class="c1"># NIST ASD L12261</span>
    
    
    <span class="c1"># quantum defects from PRA 34, 2889 (1986); and (for D_J and F_J) from Physica Scripta 27:300-305 (1983) </span>
    <span class="n">quantumDefect</span> <span class="o">=</span> <span class="p">[[[</span><span class="mf">0.3995101</span><span class="p">,</span><span class="mf">0.0290</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.0471780</span><span class="p">,</span><span class="o">-</span><span class="mf">0.024</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.002129</span><span class="p">,</span><span class="o">-</span><span class="mf">0.01491</span><span class="p">,</span><span class="mf">0.1759</span><span class="p">,</span><span class="o">-</span><span class="mf">0.8507</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="o">-</span><span class="mf">0.000077</span><span class="p">,</span><span class="mf">0.021856</span><span class="p">,</span><span class="o">-</span><span class="mf">0.4211</span><span class="p">,</span><span class="mf">2.3891</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]],</span>
                     <span class="p">[[</span><span class="mf">0.3995101</span><span class="p">,</span><span class="mf">0.0290</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.0471665</span><span class="p">,</span><span class="o">-</span><span class="mf">0.024</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.002129</span><span class="p">,</span><span class="o">-</span><span class="mf">0.01491</span><span class="p">,</span><span class="mf">0.1759</span><span class="p">,</span><span class="o">-</span><span class="mf">0.8507</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="o">-</span><span class="mf">0.000077</span><span class="p">,</span><span class="mf">0.021856</span><span class="p">,</span><span class="o">-</span><span class="mf">0.4211</span><span class="p">,</span><span class="mf">2.3891</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]]]</span>
    <span class="n">scaledRydbergConstant</span> <span class="o">=</span> <span class="mf">13.6046345</span>
    
    <span class="n">levelDataFromNIST</span> <span class="o">=</span> <span class="s2">&quot;li_NIST_level_data.ascii&quot;</span>
    <span class="n">dipoleMatrixElementFile</span> <span class="o">=</span> <span class="s2">&quot;li7_dipole_matrix_elements.npy&quot;</span>
    <span class="n">quadrupoleMatrixElementFile</span> <span class="o">=</span> <span class="s2">&quot;li7_quadrupole_matrix_elements.npy&quot;</span>

    <span class="c1"># levels that are for smaller n than ground level, but are above in energy due to angular part</span>
    <span class="n">extraLevels</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">mass</span> <span class="o">=</span> <span class="mf">7.016003</span><span class="o">*</span><span class="n">physical_constants</span><span class="p">[</span><span class="s2">&quot;atomic mass constant&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">abundance</span> <span class="o">=</span> <span class="mf">0.925</span>

    <span class="n">elementName</span> <span class="o">=</span> <span class="s2">&quot;Li7&quot;</span>


<div class="viewcode-block" id="Lithium7.getPressure"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.Lithium7.getPressure">[docs]</a>    <span class="k">def</span> <span class="nf">getPressure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">temperature</span><span class="p">):</span>
        <span class="c1"># returns pressure in Pa for temperature in K</span>
        
        <span class="k">if</span> <span class="n">temperature</span><span class="o">&lt;</span><span class="mf">180.5</span><span class="o">+</span><span class="mf">273.15</span><span class="p">:</span>
            <span class="c1"># Li is in liquid phase (from table 3. of the cited reference &quot;precisely fitted equations / +- 1%) </span>
            <span class="k">return</span> <span class="mf">10.0</span><span class="o">**</span><span class="p">(</span><span class="mf">2.881</span><span class="o">+</span><span class="mf">7.790</span><span class="o">-</span><span class="mf">8423.</span><span class="o">/</span><span class="n">temperature</span><span class="o">-</span><span class="mf">0.7074</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="o">/</span><span class="n">log</span><span class="p">(</span><span class="mf">10.</span><span class="p">))</span><span class="o">*</span><span class="mf">133.322368</span>
        
        <span class="k">elif</span> <span class="n">temperature</span><span class="o">&lt;</span><span class="mf">1000.</span><span class="o">+</span><span class="mf">273.15</span><span class="p">:</span>
            <span class="c1"># Li is in liquid phase (from table 3. of the cited reference &quot;precisely fitted equations / +- 1%)</span>
            <span class="k">return</span> <span class="mf">10.0</span><span class="o">**</span><span class="p">(</span><span class="mf">2.881</span><span class="o">+</span><span class="mf">8.409</span><span class="o">-</span><span class="mf">8320.</span><span class="o">/</span><span class="n">temperature</span><span class="o">-</span><span class="mf">1.0255</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="o">/</span><span class="n">log</span><span class="p">(</span><span class="mf">10.</span><span class="p">))</span><span class="o">*</span><span class="mf">133.322368</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;ERROR: Li vapour pressure above 1000 C is unknown (limits of experimental interpolation)&quot;</span>
            <span class="k">return</span> <span class="mi">0</span></div></div>

<div class="viewcode-block" id="Sodium"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.Sodium">[docs]</a><span class="k">class</span> <span class="nc">Sodium</span><span class="p">(</span><span class="n">AlkaliAtom</span><span class="p">):</span> <span class="c1">#Na23</span>
    <span class="c1"># ALL PARAMETERES ARE IN ATOMIC UNITS (HATREE)</span>
    <span class="n">alphaC</span>  <span class="o">=</span> <span class="mf">0.9448</span>
    <span class="c1"># model potential parameters from Marinescu et.al, PRA 49:982 (1994)</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="p">[</span><span class="mf">4.82223117</span><span class="p">,</span> <span class="mf">5.08382502</span><span class="p">,</span> <span class="mf">3.53324124</span><span class="p">,</span> <span class="mf">1.11056646</span><span class="p">]</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.45449865</span><span class="p">,</span> <span class="mf">2.18226881</span><span class="p">,</span> <span class="mf">2.48697936</span><span class="p">,</span> <span class="mf">1.05458759</span><span class="p">]</span>
    <span class="n">a3</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.12255048</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.19534623</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.75688448</span><span class="p">,</span> <span class="mf">1.73203428</span><span class="p">]</span>
    <span class="n">a4</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.42631393</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.03142861</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.27852357</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.09265696</span><span class="p">]</span>
    <span class="n">rc</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.45489422</span><span class="p">,</span> <span class="mf">0.45798739</span><span class="p">,</span> <span class="mf">0.71875312</span><span class="p">,</span> <span class="mf">28.6735059</span><span class="p">]</span>
    
    
    <span class="n">Z</span> <span class="o">=</span> <span class="mi">11</span>
    
    <span class="n">NISTdataLevels</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">ionisationEnergy</span> <span class="o">=</span>  <span class="mf">5.1390769</span>  <span class="c1"># NIST ASD L10921,L9648</span>
    
    <span class="c1"># quantum defects from Physica Scripta 27:300-305 (1983) </span>
    <span class="n">quantumDefect</span> <span class="o">=</span> <span class="p">[[[</span><span class="mf">1.347964</span><span class="p">,</span><span class="mf">0.060673</span><span class="p">,</span><span class="mf">0.0233</span><span class="p">,</span><span class="o">-</span><span class="mf">0.0085</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.855380</span><span class="p">,</span><span class="mf">0.11363</span><span class="p">,</span><span class="mf">0.0384</span><span class="p">,</span><span class="mf">0.1412</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.015543</span><span class="p">,</span><span class="o">-</span><span class="mf">0.08535</span><span class="p">,</span><span class="mf">0.7958</span><span class="p">,</span><span class="o">-</span><span class="mf">4.0513</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.001453</span><span class="p">,</span><span class="mf">0.017312</span><span class="p">,</span><span class="o">-</span><span class="mf">0.7809</span><span class="p">,</span><span class="mf">7.021</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]],</span>
                     <span class="p">[[</span><span class="mf">1.347964</span><span class="p">,</span><span class="mf">0.060673</span><span class="p">,</span><span class="mf">0.0233</span><span class="p">,</span><span class="o">-</span><span class="mf">0.0085</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.854565</span><span class="p">,</span><span class="mf">0.114195</span><span class="p">,</span><span class="mf">0.0352</span><span class="p">,</span><span class="mf">0.1533</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.015543</span><span class="p">,</span><span class="o">-</span><span class="mf">0.08535</span><span class="p">,</span><span class="mf">0.7958</span><span class="p">,</span><span class="o">-</span><span class="mf">4.0513</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.001453</span><span class="p">,</span><span class="mf">0.017312</span><span class="p">,</span><span class="o">-</span><span class="mf">0.7809</span><span class="p">,</span><span class="mf">7.021</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]]]</span>
    <span class="n">scaledRydbergConstant</span> <span class="o">=</span> <span class="mf">13.6053705</span>
    
    <span class="n">levelDataFromNIST</span> <span class="o">=</span> <span class="s2">&quot;na_NIST_level_data.ascii&quot;</span>
    <span class="n">dipoleMatrixElementFile</span> <span class="o">=</span> <span class="s2">&quot;na23_dipole_matrix_elements.npy&quot;</span>
    <span class="n">quadrupoleMatrixElementFile</span> <span class="o">=</span> <span class="s2">&quot;na23_quadrupole_matrix_elements.npy&quot;</span>

    <span class="c1"># levels that are for smaller n than ground level, but are above in energy due to angular part</span>
    <span class="n">extraLevels</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">mass</span> <span class="o">=</span> <span class="mf">22.989767</span><span class="o">*</span><span class="n">physical_constants</span><span class="p">[</span><span class="s2">&quot;atomic mass constant&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">abundance</span> <span class="o">=</span> <span class="mf">1.00</span>

    <span class="n">elementName</span> <span class="o">=</span> <span class="s2">&quot;Na23&quot;</span>


<div class="viewcode-block" id="Sodium.getPressure"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.Sodium.getPressure">[docs]</a>    <span class="k">def</span> <span class="nf">getPressure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">temperature</span><span class="p">):</span>
        <span class="c1"># returns pressure in Pa for temperature in K</span>
         
        <span class="k">if</span> <span class="n">temperature</span><span class="o">&lt;</span><span class="mf">97.794</span><span class="o">+</span><span class="mf">273.15</span><span class="p">:</span>
            <span class="c1"># Li is in liquid phase (from table 3. of the cited reference &quot;precisely fitted equations / +- 1%) </span>
            <span class="k">return</span> <span class="mf">10.0</span><span class="o">**</span><span class="p">(</span><span class="mf">2.881</span><span class="o">+</span><span class="mf">5.298</span><span class="o">-</span><span class="mf">5603.</span><span class="o">/</span><span class="n">temperature</span><span class="p">)</span><span class="o">*</span><span class="mf">133.322368</span>
        
        <span class="k">elif</span> <span class="n">temperature</span><span class="o">&lt;</span><span class="mf">700.</span><span class="o">+</span><span class="mf">273.15</span><span class="p">:</span>
            <span class="c1"># Li is in liquid phase (from table 3. of the cited reference &quot;precisely fitted equations / +- 1%)</span>
            <span class="k">return</span> <span class="mf">10.0</span><span class="o">**</span><span class="p">(</span><span class="mf">2.881</span><span class="o">+</span><span class="mf">8.400</span><span class="o">-</span><span class="mf">5634.</span><span class="o">/</span><span class="n">temperature</span><span class="o">-</span><span class="mf">1.1748</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="o">/</span><span class="n">log</span><span class="p">(</span><span class="mf">10.</span><span class="p">))</span><span class="o">*</span><span class="mf">133.322368</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;ERROR: Na vapour pressure above 700 C is unknown (limits of experimental interpolation)&quot;</span>
            <span class="k">return</span> <span class="mi">0</span></div></div>

<div class="viewcode-block" id="Potassium"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.Potassium">[docs]</a><span class="k">class</span> <span class="nc">Potassium</span><span class="p">(</span><span class="n">AlkaliAtom</span><span class="p">):</span> <span class="c1"># K39</span>
    <span class="c1"># ALL PARAMETERES ARE IN ATOMIC UNITS (HATREE)</span>
    <span class="n">alphaC</span>  <span class="o">=</span> <span class="mf">5.3310</span>
    <span class="c1"># model potential parameters from Marinescu et.al, PRA 49:982 (1994)</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="p">[</span><span class="mf">3.56079437</span><span class="p">,</span> <span class="mf">3.65670429</span><span class="p">,</span> <span class="mf">4.12713694</span><span class="p">,</span> <span class="mf">1.42310446</span><span class="p">]</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.83909642</span><span class="p">,</span> <span class="mf">1.67520788</span><span class="p">,</span> <span class="mf">1.79837462</span><span class="p">,</span> <span class="mf">1.27861156</span><span class="p">]</span>
    <span class="n">a3</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.74701102</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.07416615</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.69935174</span><span class="p">,</span> <span class="mf">4.77441476</span><span class="p">]</span>
    <span class="n">a4</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.03237313</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.89030421</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.98913582</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.94829262</span><span class="p">]</span>
    <span class="n">rc</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.83167545</span><span class="p">,</span> <span class="mf">0.85235381</span><span class="p">,</span> <span class="mf">0.83216907</span><span class="p">,</span> <span class="mf">6.50294371</span><span class="p">]</span>
    
    
    <span class="n">Z</span> <span class="o">=</span> <span class="mi">19</span>
    
    <span class="n">NISTdataLevels</span> <span class="o">=</span> <span class="mi">46</span>
    <span class="n">ionisationEnergy</span> <span class="o">=</span> <span class="mf">4.34066369</span> <span class="c1"># NIST ASD L5451,L5783,L7185</span>
    <span class="c1">#  CHANGE BELOW</span>
    
    <span class="c1"># quantum defects from Physica Scripta 27:300 (1983)</span>
    <span class="n">quantumDefect</span> <span class="o">=</span> <span class="p">[[[</span><span class="mf">2.1801985</span><span class="p">,</span><span class="mf">0.13558</span><span class="p">,</span><span class="mf">0.0759</span><span class="p">,</span><span class="mf">0.117</span><span class="p">,</span><span class="o">-</span><span class="mf">0.206</span><span class="p">],[</span><span class="mf">1.713892</span><span class="p">,</span><span class="mf">0.233294</span><span class="p">,</span><span class="mf">0.16137</span><span class="p">,</span><span class="mf">0.5345</span><span class="p">,</span><span class="o">-</span><span class="mf">0.234</span><span class="p">],[</span><span class="mf">0.27697</span><span class="p">,</span><span class="o">-</span><span class="mf">1.024911</span><span class="p">,</span><span class="o">-</span><span class="mf">0.709174</span><span class="p">,</span><span class="mf">11.839</span><span class="p">,</span><span class="o">-</span><span class="mf">26.689</span><span class="p">],[</span><span class="mf">0.010098</span><span class="p">,</span><span class="o">-</span><span class="mf">0.100224</span><span class="p">,</span><span class="mf">1.56334</span><span class="p">,</span><span class="o">-</span><span class="mf">12.6851</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]],</span>
                     <span class="p">[[</span><span class="mf">2.1801985</span><span class="p">,</span><span class="mf">0.13558</span><span class="p">,</span><span class="mf">0.0759</span><span class="p">,</span><span class="mf">0.117</span><span class="p">,</span><span class="o">-</span><span class="mf">0.206</span><span class="p">],[</span><span class="mf">1.710848</span><span class="p">,</span><span class="mf">0.235437</span><span class="p">,</span><span class="mf">0.11551</span><span class="p">,</span><span class="mf">1.1015</span><span class="p">,</span><span class="o">-</span><span class="mf">2.0356</span><span class="p">],[</span><span class="mf">0.2771580</span><span class="p">,</span><span class="o">-</span><span class="mf">1.025635</span><span class="p">,</span><span class="o">-</span><span class="mf">0.59201</span><span class="p">,</span><span class="mf">10.0053</span><span class="p">,</span><span class="o">-</span><span class="mf">19.0244</span><span class="p">],[</span><span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]]]</span>
    <span class="n">scaledRydbergConstant</span> <span class="o">=</span> <span class="mf">13.60550262</span>
    
    <span class="n">levelDataFromNIST</span> <span class="o">=</span> <span class="s2">&quot;k_NIST_level_data.ascii&quot;</span>
    <span class="n">dipoleMatrixElementFile</span> <span class="o">=</span> <span class="s2">&quot;k_dipole_matrix_elements.npy&quot;</span>
    <span class="n">quadrupoleMatrixElementFile</span> <span class="o">=</span> <span class="s2">&quot;k_quadrupole_matrix_elements.npy&quot;</span>
    
    <span class="c1"># levels that are for smaller n than ground level, but are above in energy due to angular part</span>
    <span class="n">extraLevels</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="o">+</span><span class="mf">0.5</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="o">-</span><span class="mf">0.5</span><span class="p">]]</span>
    
    <span class="n">mass</span> <span class="o">=</span> <span class="mf">38.963707</span><span class="o">*</span><span class="n">physical_constants</span><span class="p">[</span><span class="s2">&quot;atomic mass constant&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">abundance</span> <span class="o">=</span> <span class="mf">0.932581</span>
    
    <span class="n">elementName</span> <span class="o">=</span> <span class="s2">&quot;K39&quot;</span>
    
<div class="viewcode-block" id="Potassium.getPressure"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.Potassium.getPressure">[docs]</a>    <span class="k">def</span> <span class="nf">getPressure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">temperature</span><span class="p">):</span>
        <span class="c1"># returns pressure in Pa for temperature in K</span>
         
        <span class="k">if</span> <span class="n">temperature</span><span class="o">&lt;</span><span class="mf">63.5</span><span class="o">+</span><span class="mf">273.15</span><span class="p">:</span>
            <span class="c1"># K is in liquid phase (from table 3. of the cited reference &quot;precisely fitted equations / +- 1%) </span>
            <span class="k">return</span> <span class="mf">10.0</span><span class="o">**</span><span class="p">(</span><span class="mf">2.881</span><span class="o">+</span><span class="mf">4.961</span><span class="o">-</span><span class="mf">4646.</span><span class="o">/</span><span class="n">temperature</span><span class="p">)</span><span class="o">*</span><span class="mf">133.322368</span>
        
        <span class="k">elif</span> <span class="n">temperature</span><span class="o">&lt;</span><span class="mf">600.</span><span class="o">+</span><span class="mf">273.15</span><span class="p">:</span>
            <span class="c1"># K is in liquid phase (from table 3. of the cited reference &quot;precisely fitted equations / +- 1%)</span>
            <span class="k">return</span> <span class="mf">10.0</span><span class="o">**</span><span class="p">(</span><span class="mf">2.881</span><span class="o">+</span><span class="mf">8.233</span><span class="o">-</span><span class="mf">4693.</span><span class="o">/</span><span class="n">temperature</span><span class="o">-</span><span class="mf">1.2403</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="o">/</span><span class="n">log</span><span class="p">(</span><span class="mf">10.</span><span class="p">))</span><span class="o">*</span><span class="mf">133.322368</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;ERROR: K vapour pressure above 600 C is unknown (limits of experimental interpolation)&quot;</span>
            <span class="k">return</span> <span class="mi">0</span></div></div>

<div class="viewcode-block" id="LevelPlot"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelPlot">[docs]</a><span class="k">class</span> <span class="nc">LevelPlot</span><span class="p">:</span>
    <span class="n">atom</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">listX</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># list of l</span>
    <span class="n">listY</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># list of energies </span>
    <span class="n">levelLabel</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">width</span> <span class="o">=</span><span class="mf">0.2</span>
    <span class="n">state1</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">state2</span> <span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">transitionMatrix</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">nFrom</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">nTo</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">lFrom</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">lTo</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">populations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">transitionMatrixWavelength3</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># characterization of the graph</span>
    <span class="n">spectraX</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">spectraY</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">spectraLine</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># evolution parameters</span>
    <span class="n">cooperativity</span> <span class="o">=</span> <span class="mf">0.0</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">atomType</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="n">atomType</span>
    
    
<div class="viewcode-block" id="LevelPlot.makeLevels"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelPlot.makeLevels">[docs]</a>    <span class="k">def</span> <span class="nf">makeLevels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">nFrom</span><span class="p">,</span><span class="n">nTo</span><span class="p">,</span><span class="n">lFrom</span><span class="p">,</span><span class="n">lTo</span><span class="p">):</span>
        <span class="c1">#save local copy of the space restrictions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nFrom</span> <span class="o">=</span> <span class="n">nFrom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nTo</span> <span class="o">=</span> <span class="n">nTo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lFrom</span> <span class="o">=</span> <span class="n">lFrom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lTo</span> <span class="o">=</span> <span class="n">lTo</span>
        
        <span class="c1"># find all the levels within this space restrictions</span>
        <span class="k">while</span> <span class="n">nFrom</span><span class="o">&lt;=</span><span class="n">nTo</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">lFrom</span>
            <span class="k">while</span> <span class="n">l</span><span class="o">&lt;=</span><span class="nb">min</span><span class="p">(</span><span class="n">lTo</span><span class="p">,</span><span class="mi">4</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">l</span><span class="o">&gt;</span><span class="mf">0.5</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">listX</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">listY</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">nFrom</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">l</span><span class="o">-</span><span class="mf">0.5</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">nFrom</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="o">-</span><span class="mf">0.5</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">listX</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">listY</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">nFrom</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">l</span><span class="o">+</span><span class="mf">0.5</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">nFrom</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="o">+</span><span class="mf">0.5</span><span class="p">])</span>
                <span class="n">l</span> <span class="o">=</span> <span class="n">l</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">nFrom</span> <span class="o">=</span> <span class="n">nFrom</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">extraLevels</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">lTo</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">listX</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">listY</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">state</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">)</span></div>
            
            
    
<div class="viewcode-block" id="LevelPlot.makeTransitionMatrix"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelPlot.makeTransitionMatrix">[docs]</a>    <span class="k">def</span> <span class="nf">makeTransitionMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">environmentTemperature</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span><span class="n">printDecays</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">superradiance</span>  <span class="o">=</span> <span class="mf">0.0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transitionMatrix</span> <span class="o">=</span><span class="p">[]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">):</span>
            <span class="n">state1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">transitionVector</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">transitionVectorWavelength3</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># decay of the stay</span>
            <span class="n">decay</span> <span class="o">=</span> <span class="mf">0.0</span>
        
            <span class="k">for</span> <span class="n">state2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">:</span>
                <span class="n">dipoleAllowed</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">state1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">state2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="ow">and</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">state1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">state2</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">&lt;=</span><span class="mf">1.01</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">dipoleAllowed</span><span class="p">):</span>
                    <span class="c1">#print state1,&quot; &quot;,state2</span>
                    <span class="c1"># decay to thius state</span>
                    <span class="n">rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">transitionRate</span><span class="p">(</span><span class="n">state2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">state2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">state2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">state1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">state1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">state1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">temperature</span><span class="o">=</span><span class="n">environmentTemperature</span><span class="p">)</span>
                    
                    <span class="n">transitionVectorWavelength3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getTransitionWavelength</span><span class="p">(</span><span class="n">state2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">state2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">state2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">state1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">state1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">state1</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
                    <span class="n">rate</span> <span class="o">=</span> <span class="n">rate</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">superradiance</span><span class="o">*</span><span class="n">transitionVectorWavelength3</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">transitionVector</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span>
                    
                    <span class="c1"># decay from this state</span>
                    <span class="n">rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">transitionRate</span><span class="p">(</span><span class="n">state1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">state1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">state1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">state2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">state2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">state2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">temperature</span><span class="o">=</span><span class="n">environmentTemperature</span><span class="p">)</span>
                    
                    <span class="n">rate</span> <span class="o">=</span> <span class="n">rate</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">superradiance</span><span class="o">*</span><span class="n">transitionVectorWavelength3</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    
                    <span class="n">decay</span> <span class="o">=</span> <span class="n">decay</span><span class="o">-</span><span class="n">rate</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">transitionVector</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                    <span class="n">transitionVectorWavelength3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                    
            <span class="n">transitionVector</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">decay</span>
            <span class="k">if</span> <span class="n">printDecays</span><span class="p">:</span>
                <span class="k">print</span> <span class="s2">&quot;Decay time of &quot;</span>
                <span class="n">printState</span><span class="p">(</span><span class="n">state1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">state1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">state1</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">print</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> is</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span><span class="o">-</span><span class="mf">1.e9</span><span class="o">/</span><span class="n">decay</span><span class="p">,</span><span class="s2">&quot; ns&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transitionMatrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transitionVector</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transitionMatrixWavelength3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transitionVectorWavelength3</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
        
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transitionMatrix</span><span class="p">)</span>
        <span class="c1"># integrator needs matrix to be transposed</span>
        <span class="c1"># since the colum-state vector will be multiplied from the left</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transitionMatrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transitionMatrix</span><span class="p">)</span></div>
    
                
    <span class="c1">#def findPopulations(self,state,populations):</span>
    
<div class="viewcode-block" id="LevelPlot.addDriving"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelPlot.addDriving">[docs]</a>    <span class="k">def</span> <span class="nf">addDriving</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">level1</span><span class="p">,</span><span class="n">level2</span><span class="p">,</span><span class="n">rate</span><span class="p">):</span>
        <span class="c1"># adds driving from level1 to level2</span>
        <span class="n">index1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">index1</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">)</span> <span class="ow">and</span> <span class="p">((</span><span class="n">level1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">index1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="ow">or</span><span class="p">(</span><span class="n">level1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">index1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="ow">or</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">level1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">index1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span><span class="o">&gt;</span><span class="mf">0.1</span><span class="p">))):</span>
            <span class="n">index1</span> <span class="o">=</span> <span class="n">index1</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">index1</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">):</span>
            <span class="k">print</span> <span class="s2">&quot;Error while searching for level1 in addDriving function&quot;</span>
            <span class="k">print</span> <span class="n">level1</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">printState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">index1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">index1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">index1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
        
        <span class="n">index2</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">index2</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">)</span> <span class="ow">and</span> <span class="p">((</span><span class="n">level2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">index2</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="ow">or</span><span class="p">(</span><span class="n">level2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">index2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="ow">or</span><span class="p">(</span><span class="n">level2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">index2</span><span class="p">][</span><span class="mi">2</span><span class="p">]))):</span>
            <span class="n">index2</span> <span class="o">=</span> <span class="n">index2</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">index2</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">):</span>
            <span class="k">print</span> <span class="s2">&quot;Error while searching for level1 in addDriving function&quot;</span>
            <span class="k">print</span> <span class="n">level2</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">printState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">index2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">index2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">index2</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="n">index1</span> <span class="o">==</span> <span class="n">index2</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Error: level1 and level2 cannot be the same in addDriving function!&quot;</span>
            <span class="k">return</span>
        
        <span class="c1"># adding driving</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transitionMatrix</span><span class="p">[</span><span class="n">index1</span><span class="p">][</span><span class="n">index2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transitionMatrix</span><span class="p">[</span><span class="n">index1</span><span class="p">][</span><span class="n">index2</span><span class="p">]</span> <span class="o">+</span> <span class="n">rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transitionMatrix</span><span class="p">[</span><span class="n">index2</span><span class="p">][</span><span class="n">index1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transitionMatrix</span><span class="p">[</span><span class="n">index2</span><span class="p">][</span><span class="n">index1</span><span class="p">]</span> <span class="o">+</span> <span class="n">rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transitionMatrix</span><span class="p">[</span><span class="n">index1</span><span class="p">][</span><span class="n">index1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transitionMatrix</span><span class="p">[</span><span class="n">index1</span><span class="p">][</span><span class="n">index1</span><span class="p">]</span> <span class="o">-</span> <span class="n">rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transitionMatrix</span><span class="p">[</span><span class="n">index2</span><span class="p">][</span><span class="n">index2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transitionMatrix</span><span class="p">[</span><span class="n">index2</span><span class="p">][</span><span class="n">index2</span><span class="p">]</span> <span class="o">-</span> <span class="n">rate</span></div>
                    
<div class="viewcode-block" id="LevelPlot.evolveStates"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelPlot.evolveStates">[docs]</a>    <span class="k">def</span> <span class="nf">evolveStates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">initStates</span><span class="p">,</span><span class="n">time</span><span class="p">,</span><span class="n">step</span><span class="p">):</span>
        
        <span class="c1"># initialization</span>
        <span class="c1">#print &quot;Initilizing &quot;,len(self.levelLabel),&quot; states.&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">):</span>
            <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">population</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">while</span> <span class="n">j</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">initStates</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">initStates</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="ow">and</span> <span class="p">(</span><span class="n">initStates</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span><span class="p">(</span><span class="n">initStates</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]):</span>
                    <span class="c1">#print &quot;Found state (no. &quot;,i,&quot;): &quot;</span>
                    <span class="c1">#printState(self.levelLabel[i][0], self.levelLabel[i][1], self.levelLabel[i][2])</span>
                    
                    <span class="n">population</span> <span class="o">=</span> <span class="n">initStates</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
                    <span class="n">j</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">initStates</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span>
                
            <span class="n">start</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">population</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
        
        <span class="c1">#print start</span>
        <span class="c1"># integration</span>
        
        <span class="c1">#print type(self.evolutionStep(0,start))</span>
        
        <span class="n">c</span> <span class="o">=</span> <span class="n">ode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evolutionStep2</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">set_initial_value</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">set_integrator</span><span class="p">(</span><span class="s2">&quot;dopri5&quot;</span><span class="p">,</span><span class="n">atol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">,</span><span class="n">rtol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">)</span>
        <span class="c1">#c.set_integrator(&quot;dopri5&quot;,atol=1e-4,rtol=1e-4)</span>
        
        <span class="n">xVal</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">yVal</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span>  <span class="n">c</span><span class="o">.</span><span class="n">successful</span><span class="p">()</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">t</span><span class="o">&lt;</span><span class="n">time</span><span class="p">:</span>
            <span class="n">temp</span>  <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">t</span><span class="o">+</span><span class="n">step</span><span class="p">)</span>
            <span class="c1">#print c.t,&quot; &quot;,temp</span>
            <span class="n">xVal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
            <span class="n">yVal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">populations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span></div>
        <span class="c1">#print xVal</span>
        <span class="c1">#print yVal</span>
        <span class="c1">#close()</span>
        <span class="c1">#plot(xVal,yVal,&quot;b-&quot;)</span>
        <span class="c1">#show()</span>
    
<div class="viewcode-block" id="LevelPlot.evolutionStep"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelPlot.evolutionStep">[docs]</a>    <span class="k">def</span> <span class="nf">evolutionStep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">populations</span><span class="p">):</span>
        <span class="c1">#print &quot;evolution &quot;</span>
        <span class="c1">#print self.transitionMatrix</span>
        <span class="c1">#print populations</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">populations</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">transitionMatrix</span><span class="p">)</span></div>
    
        
<div class="viewcode-block" id="LevelPlot.evolutionStep2"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelPlot.evolutionStep2">[docs]</a>    <span class="k">def</span> <span class="nf">evolutionStep2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">populations</span><span class="p">):</span>
        <span class="c1">#print &quot;evolution &quot;</span>
        <span class="c1">#print self.transitionMatrix</span>
        <span class="c1">#print populations</span>
        <span class="n">br</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">populations</span><span class="p">)</span>
        <span class="n">change</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">br</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">br</span><span class="p">):</span>
            <span class="n">changeI</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">br</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">):</span>
                    <span class="n">drate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transitionMatrix</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">populations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">transitionMatrixWavelength3</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cooperativity</span><span class="p">)</span><span class="o">*</span><span class="n">populations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">change</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">change</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">drate</span>
                    <span class="n">changeI</span> <span class="o">=</span> <span class="n">changeI</span> <span class="o">-</span> <span class="n">drate</span>
            <span class="n">change</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">change</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">changeI</span>             
        <span class="k">print</span> <span class="n">t</span>
        <span class="c1">#print &quot;sum &quot;,np.sum(np.array(change))</span>
        <span class="c1">#print &quot;abs &quot;,np.sum(abs(np.array(change)))</span>
        <span class="k">return</span> <span class="n">change</span>            </div>
        <span class="c1">#return np.dot(populations,self.transitionMatrix)</span>
    
<div class="viewcode-block" id="LevelPlot.drawSpectra"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelPlot.drawSpectra">[docs]</a>    <span class="k">def</span> <span class="nf">drawSpectra</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        
        <span class="n">lineWavelength</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lineStrength</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lineName</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">):</span>
            <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">j</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">!=</span><span class="n">j</span><span class="p">):</span>
                    <span class="n">wavelength</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getTransitionWavelength</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
                                                                   <span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                    
                    <span class="n">intensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">populations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">transitionMatrix</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">intensity</span><span class="o">&gt;</span><span class="mf">1.</span><span class="p">):</span>
                        <span class="n">lineWavelength</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)</span><span class="o">*</span><span class="mf">1.e9</span><span class="p">)</span>
                        <span class="n">lineStrength</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">intensity</span><span class="p">))</span>
                        <span class="n">lineName</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">printStateString</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot; -&gt; &quot;</span><span class="o">+</span>
                                        <span class="n">printStateString</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>
                    
                <span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>   
        
        <span class="bp">self</span><span class="o">.</span><span class="n">spectraX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">lineWavelength</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectraY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">lineStrength</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectraLine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">lineName</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="LevelPlot.drawSpectraConvoluted"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelPlot.drawSpectraConvoluted">[docs]</a>    <span class="k">def</span> <span class="nf">drawSpectraConvoluted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lowerWavelength</span><span class="p">,</span> <span class="n">higherWavelength</span><span class="p">,</span><span class="n">points</span><span class="p">,</span><span class="n">gamma</span><span class="p">):</span>
        <span class="n">wavelengths</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">lowerWavelength</span><span class="p">,</span><span class="n">higherWavelength</span><span class="p">,</span><span class="n">points</span><span class="p">)</span>
        <span class="n">spectra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">j</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectraX</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectraY</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">gamma</span><span class="o">/</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">spectraX</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="n">wavelengths</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">gamma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">spectra</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span><span class="n">spectra</span><span class="p">,</span><span class="s2">&quot;g-&quot;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="LevelPlot.showSpectra"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelPlot.showSpectra">[docs]</a>    <span class="k">def</span> <span class="nf">showSpectra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">saveInFile</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">showTransitionPoints</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">showTransitionPoints</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectraX</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">spectraY</span><span class="p">,</span><span class="s2">&quot;ro&quot;</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Wavelength (nm)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity (arb.un)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span><span class="n">left</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="c1">#self.ax.set_xlim(300,600)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;pick_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onpick3</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">saveInFile</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">saveInFile</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>
        
    
<div class="viewcode-block" id="LevelPlot.drawLevels"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelPlot.drawLevels">[docs]</a>    <span class="k">def</span> <span class="nf">drawLevels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">9.0</span><span class="p">,</span> <span class="mf">11.5</span><span class="p">))</span>
   
        <span class="c1">#self.makeLevels(nFrom, nTo, lFrom, lTo)</span>
        <span class="c1">#print &quot;total population (should be 1.0) = &quot;,np.sum(abs(self.populations))</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">listX</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">listX</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">listX</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">listY</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">listY</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="s2">&quot;b-&quot;</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">populations</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">populations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">1e-3</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">listX</span><span class="p">[</span><span class="n">i</span><span class="p">]],[</span><span class="bp">self</span><span class="o">.</span><span class="n">listY</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="s2">&quot;ro&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">populations</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="c1">#alpha=1./(1-log(2.7*self.populations[i])))  </span>
                
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span></div>
        

<div class="viewcode-block" id="LevelPlot.showPlot"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelPlot.showPlot">[docs]</a>    <span class="k">def</span> <span class="nf">showPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Energy (eV)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">3.5</span><span class="p">)</span>
        
        <span class="c1"># X AXIS</span>
        <span class="n">majorLocator</span>   <span class="o">=</span> <span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">majorLocator</span><span class="p">)</span>
        <span class="n">tickNames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;S&quot;</span><span class="p">,</span><span class="s2">&quot;P&quot;</span><span class="p">,</span><span class="s2">&quot;D&quot;</span><span class="p">,</span><span class="s2">&quot;F&quot;</span><span class="p">]</span>
        <span class="n">tickNum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">())</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">tickNames</span><span class="p">)</span>
        <span class="c1">#ax[1].xaxis.set_major_formatter(majorFormatter)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;pick_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onpick2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="LevelPlot.findState"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelPlot.findState">[docs]</a>    <span class="k">def</span> <span class="nf">findState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="mf">100000000.0</span>
        <span class="n">state</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">listX</span><span class="p">):</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listX</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">x</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listY</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">y</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="n">dx</span><span class="o">+</span><span class="n">dy</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">dist</span><span class="o">&lt;</span><span class="n">distance</span><span class="p">):</span>
                <span class="n">distance</span> <span class="o">=</span> <span class="n">dist</span>
                <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">return</span> <span class="n">state</span></div>

<div class="viewcode-block" id="LevelPlot.findStateNo"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelPlot.findStateNo">[docs]</a>    <span class="k">def</span> <span class="nf">findStateNo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state</span><span class="p">):</span>
        <span class="c1"># returns no of the given state in the basis</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="ow">and</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="ow">and</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">state</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">i</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
            
        <span class="k">print</span> <span class="s2">&quot;Error: requested state &quot;</span>
        <span class="k">print</span> <span class="n">state</span>
        <span class="k">print</span> <span class="s2">&quot;could not be found!&quot;</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span></div>

<div class="viewcode-block" id="LevelPlot.findLine"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelPlot.findLine">[docs]</a>    <span class="k">def</span> <span class="nf">findLine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="mf">1.e19</span>
        <span class="n">line</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectraLine</span><span class="p">):</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectraX</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">x</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectraY</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">y</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="n">dx</span><span class="o">+</span><span class="n">dy</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">dist</span><span class="o">&lt;</span><span class="n">distance</span><span class="p">):</span>
                <span class="n">distance</span> <span class="o">=</span> <span class="n">dist</span>
                <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectraLine</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">return</span> <span class="n">line</span></div>

<div class="viewcode-block" id="LevelPlot.onpick2"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelPlot.onpick2">[docs]</a>    <span class="k">def</span> <span class="nf">onpick2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">artist</span><span class="p">,</span> <span class="n">Line2D</span><span class="p">):</span>
            <span class="n">thisline</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">artist</span>
            <span class="n">xdata</span> <span class="o">=</span> <span class="n">thisline</span><span class="o">.</span><span class="n">get_xdata</span><span class="p">()</span>
            <span class="n">ydata</span> <span class="o">=</span> <span class="n">thisline</span><span class="o">.</span><span class="n">get_ydata</span><span class="p">()</span>

            <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findState</span><span class="p">((</span><span class="n">xdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">xdata</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">ydata</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state2</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state1</span> <span class="o">=</span> <span class="n">state</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">printStateString</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">state</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot; -&gt; &quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state2</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state2</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">title</span> <span class="o">=</span> <span class="n">printStateString</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">state1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">state1</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot; -&gt; &quot;</span><span class="o">+</span><span class="n">printStateString</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">state</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot; &quot;</span>
                    <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">+</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">%.2f</span><span class="s2"> nm (</span><span class="si">%.3f</span><span class="s2"> GHz)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getTransitionWavelength</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">state1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">state1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">state</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getTransitionFrequency</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">state1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">state1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">state</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="mf">1e-9</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state1</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                   
                <span class="bp">self</span><span class="o">.</span><span class="n">state2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

<div class="viewcode-block" id="LevelPlot.onpick3"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelPlot.onpick3">[docs]</a>    <span class="k">def</span> <span class="nf">onpick3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">artist</span><span class="p">,</span> <span class="n">Line2D</span><span class="p">):</span>
            <span class="n">thisline</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">artist</span>
            <span class="n">xdata</span> <span class="o">=</span> <span class="n">thisline</span><span class="o">.</span><span class="n">get_xdata</span><span class="p">()</span>
            <span class="n">ydata</span> <span class="o">=</span> <span class="n">thisline</span><span class="o">.</span><span class="n">get_ydata</span><span class="p">()</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">ind</span>
            <span class="k">print</span> <span class="n">ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findLine</span><span class="p">(</span><span class="n">xdata</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ydata</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="Hydrogen"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.Hydrogen">[docs]</a><span class="k">class</span> <span class="nc">Hydrogen</span><span class="p">(</span><span class="n">AlkaliAtom</span><span class="p">):</span>
    <span class="n">ionisationEnergy</span> <span class="o">=</span> <span class="mf">13.6</span>  <span class="c1"># eV</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">scaledRydbergConstant</span> <span class="o">=</span> <span class="mf">3.289828299</span><span class="o">*</span><span class="mf">4.135668</span>  <span class="c1"># in eV  # CHECK THIS NUMBER (SCALED RYDBERG CONSTANT FOR HYDROGEN)</span>
    
<div class="viewcode-block" id="Hydrogen.Potential"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.Hydrogen.Potential">[docs]</a>    <span class="k">def</span> <span class="nf">Potential</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
        <span class="c1"># Returns total potential that electron feels = core potential + Spin-Orbit interaction</span>
        <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">/</span><span class="n">r</span></div>
    
<div class="viewcode-block" id="Hydrogen.getQuantumDefect"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.Hydrogen.getQuantumDefect">[docs]</a>    <span class="k">def</span> <span class="nf">getQuantumDefect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">):</span>
        <span class="n">defect</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">return</span> <span class="n">defect</span> </div></div>

<div class="viewcode-block" id="NumerovBack"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.NumerovBack">[docs]</a><span class="k">def</span> <span class="nf">NumerovBack</span><span class="p">(</span><span class="n">innerLimit</span><span class="p">,</span><span class="n">outerLimit</span><span class="p">,</span><span class="n">kfun</span><span class="p">,</span><span class="n">step</span><span class="p">,</span><span class="n">init1</span><span class="p">,</span><span class="n">init2</span><span class="p">):</span>
    <span class="c1">#cdef double innerLimit,outerLimit,step,init1,init2</span>
    
    <span class="c1"># init1 = solution(outerLimit+step)    init2 = solution(outerLimit+2*step)</span>
    <span class="c1"># algorithm calculates solution function with step STEP towards the inner limit as d^2 solution/d r^2 = kfun(r)* solution(r) </span>
    <span class="n">br</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">outerLimit</span><span class="o">-</span><span class="n">innerLimit</span><span class="p">)</span><span class="o">/</span><span class="n">step</span><span class="p">)</span>
    <span class="c1">#print br</span>
    <span class="n">sol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">br</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">))</span>
    <span class="n">rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">br</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">))</span>
    
    <span class="n">br</span> <span class="o">=</span> <span class="n">br</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">outerLimit</span>
    <span class="n">sol</span><span class="p">[</span><span class="n">br</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="mf">5.0</span><span class="o">/</span><span class="mf">12.0</span><span class="o">*</span><span class="n">step</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">kfun</span><span class="p">(</span><span class="n">r</span><span class="p">))</span><span class="o">*</span><span class="n">init1</span><span class="o">-</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="mf">1.</span><span class="o">/</span><span class="mf">12.0</span><span class="o">*</span><span class="n">step</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">kfun</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="n">step</span><span class="p">))</span><span class="o">*</span><span class="n">init2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="mf">12.0</span><span class="o">*</span><span class="n">step</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">kfun</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="n">step</span><span class="p">))</span>
    <span class="n">rad</span><span class="p">[</span><span class="n">br</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span>
    
    <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">-</span><span class="n">step</span>
    <span class="n">br</span> <span class="o">=</span> <span class="n">br</span><span class="o">-</span><span class="mi">1</span>
    
    <span class="n">sol</span><span class="p">[</span><span class="n">br</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="mf">5.0</span><span class="o">/</span><span class="mf">12.0</span><span class="o">*</span><span class="n">step</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">kfun</span><span class="p">(</span><span class="n">r</span><span class="p">))</span><span class="o">*</span><span class="n">sol</span><span class="p">[</span><span class="n">br</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="mf">1.</span><span class="o">/</span><span class="mf">12.0</span><span class="o">*</span><span class="n">step</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">kfun</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="n">step</span><span class="p">))</span><span class="o">*</span><span class="n">init1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="mf">12.0</span><span class="o">*</span><span class="n">step</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">kfun</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="n">step</span><span class="p">))</span>
    <span class="n">rad</span><span class="p">[</span><span class="n">br</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span>
    
    <span class="c1"># check if the function starts diverging  before the innerLimit -&gt; in that case break integration earlier</span>
    
    <span class="n">maxValue</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="c1">#checkPoint = br/5</span>
    
    <span class="c1"># HACK CHECK POINT (better then fixed checked point since it works for all n</span>
    <span class="n">checkPoint</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">fromLastMax</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">while</span> <span class="n">br</span><span class="o">&gt;</span><span class="n">checkPoint</span><span class="p">:</span>
        <span class="n">br</span> <span class="o">=</span> <span class="n">br</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">-</span><span class="n">step</span>
        <span class="n">sol</span><span class="p">[</span><span class="n">br</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="mf">5.0</span><span class="o">/</span><span class="mf">12.0</span><span class="o">*</span><span class="n">step</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">kfun</span><span class="p">(</span><span class="n">r</span><span class="p">))</span><span class="o">*</span><span class="n">sol</span><span class="p">[</span><span class="n">br</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="mf">1.</span><span class="o">/</span><span class="mf">12.0</span><span class="o">*</span><span class="n">step</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">kfun</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="n">step</span><span class="p">))</span><span class="o">*</span><span class="n">sol</span><span class="p">[</span><span class="n">br</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="mf">1.</span><span class="o">/</span><span class="mf">12.0</span><span class="o">*</span><span class="n">step</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">kfun</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="n">step</span><span class="p">))</span>
        <span class="n">rad</span><span class="p">[</span><span class="n">br</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">sol</span><span class="p">[</span><span class="n">br</span><span class="p">])</span><span class="o">&gt;</span><span class="n">maxValue</span><span class="p">:</span>
            <span class="n">maxValue</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">sol</span><span class="p">[</span><span class="n">br</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fromLastMax</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">fromLastMax</span><span class="o">&gt;</span><span class="mi">50</span><span class="p">:</span>
                <span class="n">checkPoint</span> <span class="o">=</span> <span class="n">br</span>
    <span class="c1"># now proceed with caution - checking if the divergence starts - if it does, cut earlier</span>
    
    <span class="n">divergencePoint</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#print &quot;maxValue = &quot;,maxValue</span>
       
    <span class="k">while</span> <span class="p">(</span><span class="n">br</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="ow">and</span><span class="p">(</span><span class="n">divergencePoint</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">br</span> <span class="o">=</span> <span class="n">br</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">-</span><span class="n">step</span>
        <span class="n">sol</span><span class="p">[</span><span class="n">br</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="mf">5.0</span><span class="o">/</span><span class="mf">12.0</span><span class="o">*</span><span class="n">step</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">kfun</span><span class="p">(</span><span class="n">r</span><span class="p">))</span><span class="o">*</span><span class="n">sol</span><span class="p">[</span><span class="n">br</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="mf">1.</span><span class="o">/</span><span class="mf">12.0</span><span class="o">*</span><span class="n">step</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">kfun</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="n">step</span><span class="p">))</span><span class="o">*</span><span class="n">sol</span><span class="p">[</span><span class="n">br</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="mf">1.</span><span class="o">/</span><span class="mf">12.0</span><span class="o">*</span><span class="n">step</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">kfun</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="n">step</span><span class="p">))</span>
        <span class="n">rad</span><span class="p">[</span><span class="n">br</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">divergencePoint</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="ow">and</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">sol</span><span class="p">[</span><span class="n">br</span><span class="p">])</span><span class="o">&gt;</span><span class="n">maxValue</span><span class="p">):</span>
            <span class="n">divergencePoint</span> <span class="o">=</span> <span class="n">br</span>
            <span class="k">while</span><span class="p">(</span> <span class="nb">abs</span><span class="p">(</span><span class="n">sol</span><span class="p">[</span><span class="n">divergencePoint</span><span class="p">])</span><span class="o">&gt;</span><span class="nb">abs</span><span class="p">(</span><span class="n">sol</span><span class="p">[</span><span class="n">divergencePoint</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span> <span class="ow">and</span> <span class="p">(</span><span class="n">divergencePoint</span><span class="o">&lt;</span><span class="n">checkPoint</span><span class="p">):</span>
                <span class="n">divergencePoint</span> <span class="o">+=</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">divergencePoint</span><span class="o">&gt;</span><span class="n">checkPoint</span><span class="p">:</span>
                <span class="k">print</span> <span class="s2">&quot;Numerov error&quot;</span>
                <span class="nb">exit</span><span class="p">()</span>
            <span class="c1">#print &quot;NumerovBack Warning: divergence occured before reaching inner radius (expected for calculating radial matrix elements for l&gt;4)&quot;</span>
    <span class="c1">#print &quot;e&quot;</span>
    <span class="k">return</span> <span class="n">rad</span><span class="p">,</span><span class="n">sol</span><span class="p">,</span><span class="n">divergencePoint</span></div>

<div class="viewcode-block" id="c6term"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.c6term">[docs]</a><span class="k">def</span> <span class="nf">c6term</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">atom</span><span class="p">):</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">getDipoleMatrixElement</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">)</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">getDipoleMatrixElement</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">)</span>
    <span class="n">d1d2</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">epsilon_0</span><span class="p">)</span><span class="o">*</span><span class="n">d1</span><span class="o">*</span><span class="n">d2</span><span class="o">*</span><span class="n">elemCharge</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">physical_constants</span><span class="p">[</span><span class="s2">&quot;Bohr radius&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">d1d2</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">elemCharge</span><span class="o">*</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">)</span><span class="o">+</span><span class="n">atom</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">atom</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">)))</span></div>

<div class="viewcode-block" id="c3term"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.c3term">[docs]</a><span class="k">def</span> <span class="nf">c3term</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">atom</span><span class="p">):</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">getDipoleMatrixElement</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">)</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">getDipoleMatrixElement</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">)</span>
    <span class="n">d1d2</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">epsilon_0</span><span class="p">)</span><span class="o">*</span><span class="n">d1</span><span class="o">*</span><span class="n">d2</span><span class="o">*</span><span class="n">elemCharge</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">physical_constants</span><span class="p">[</span><span class="s2">&quot;Bohr radius&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">d1d2</span></div>

<div class="viewcode-block" id="atomLightAtomCoupling"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.atomLightAtomCoupling">[docs]</a><span class="k">def</span> <span class="nf">atomLightAtomCoupling</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">nn</span><span class="p">,</span><span class="n">ll</span><span class="p">,</span><span class="n">jj</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">atom</span><span class="p">):</span>
    <span class="c1"># determine coupling</span>
    <span class="n">dl</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">l</span><span class="o">-</span><span class="n">l1</span><span class="p">)</span>
    <span class="n">dj</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">j1</span><span class="p">)</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">dl</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">dj</span><span class="o">&lt;</span><span class="mf">1.1</span><span class="p">):</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># dipole coupling</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">dl</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">dl</span><span class="o">==</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">dl</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">j1</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">2.1</span><span class="p">):</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># quadrupole coupling</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="n">dl</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ll</span><span class="o">-</span><span class="n">l2</span><span class="p">)</span>
    <span class="n">dj</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">jj</span><span class="o">-</span><span class="n">j2</span><span class="p">)</span>
    <span class="n">c2</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">dl</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">dj</span><span class="o">&lt;</span><span class="mf">1.1</span><span class="p">):</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># dipole coupling</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">dl</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">dl</span><span class="o">==</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">dl</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">j1</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">2.1</span><span class="p">):</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># quadrupole coupling                                  </span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    

    <span class="n">radial1</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">getRadialCoupling</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">)</span>
    <span class="n">radial2</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">getRadialCoupling</span><span class="p">(</span><span class="n">nn</span><span class="p">,</span><span class="n">ll</span><span class="p">,</span><span class="n">jj</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">)</span>
    
    <span class="c1">#print &quot;coupl.&quot;</span>
    <span class="k">print</span> <span class="n">c1</span>
    <span class="k">print</span> <span class="n">c2</span>
    <span class="c1">#exit()</span>
    
    <span class="c1">## TO-DO: check exponent of the Boht radius (from where it comes?!)</span>
    
    <span class="n">coupling</span> <span class="o">=</span> <span class="n">elemCharge</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">epsilon_0</span><span class="p">)</span><span class="o">*</span><span class="n">radial1</span><span class="o">*</span><span class="n">radial2</span><span class="o">*</span><span class="p">(</span><span class="n">physical_constants</span><span class="p">[</span><span class="s2">&quot;Bohr radius&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="p">(</span><span class="n">c1</span><span class="o">+</span><span class="n">c2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">coupling</span></div>
    
    

<div class="viewcode-block" id="printState"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.printState">[docs]</a><span class="k">def</span> <span class="nf">printState</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">):</span>
    <span class="n">let</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">l</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">let</span> <span class="o">=</span> <span class="s2">&quot;S&quot;</span>
    <span class="k">elif</span> <span class="n">l</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">let</span> <span class="o">=</span> <span class="s2">&quot;P&quot;</span>
    <span class="k">elif</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">let</span> <span class="o">=</span> <span class="s2">&quot;D&quot;</span>
    <span class="k">elif</span> <span class="n">l</span><span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">let</span> <span class="o">=</span> <span class="s2">&quot;F&quot;</span>
    <span class="k">elif</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">let</span> <span class="o">=</span> <span class="s2">&quot;G&quot;</span>
    <span class="k">elif</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">let</span> <span class="o">=</span> <span class="s2">&quot;H&quot;</span>
    <span class="k">elif</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="n">let</span> <span class="o">=</span> <span class="s2">&quot;I&quot;</span>
    <span class="k">elif</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
        <span class="n">let</span> <span class="o">=</span> <span class="s2">&quot;K&quot;</span>
    <span class="k">elif</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
        <span class="n">let</span> <span class="o">=</span> <span class="s2">&quot;L&quot;</span>
    <span class="k">elif</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
        <span class="n">let</span> <span class="o">=</span> <span class="s2">&quot;M&quot;</span>
    <span class="k">elif</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">let</span> <span class="o">=</span> <span class="s2">&quot;N&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">let</span> <span class="o">=</span> <span class="s2">&quot;?&quot;</span>
        
    <span class="k">print</span> <span class="n">n</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">let</span><span class="p">,(</span><span class="s2">&quot; </span><span class="si">%.0d</span><span class="s2">/2&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span></div>

<div class="viewcode-block" id="printStateString"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.printStateString">[docs]</a><span class="k">def</span> <span class="nf">printStateString</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">):</span>
    <span class="n">let</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">l</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">let</span> <span class="o">=</span> <span class="s2">&quot;S&quot;</span>
    <span class="k">elif</span> <span class="n">l</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">let</span> <span class="o">=</span> <span class="s2">&quot;P&quot;</span>
    <span class="k">elif</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">let</span> <span class="o">=</span> <span class="s2">&quot;D&quot;</span>
    <span class="k">elif</span> <span class="n">l</span><span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">let</span> <span class="o">=</span> <span class="s2">&quot;F&quot;</span>
    <span class="k">elif</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">let</span> <span class="o">=</span> <span class="s2">&quot;G&quot;</span>
    <span class="k">elif</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">let</span> <span class="o">=</span> <span class="s2">&quot;H&quot;</span>
    <span class="k">elif</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="n">let</span> <span class="o">=</span> <span class="s2">&quot;I&quot;</span>
    <span class="k">elif</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
        <span class="n">let</span> <span class="o">=</span> <span class="s2">&quot;K&quot;</span>
    <span class="k">elif</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
        <span class="n">let</span> <span class="o">=</span> <span class="s2">&quot;L&quot;</span>
    <span class="k">elif</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
        <span class="n">let</span> <span class="o">=</span> <span class="s2">&quot;M&quot;</span>
    <span class="k">elif</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">let</span> <span class="o">=</span> <span class="s2">&quot;N&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">let</span> <span class="o">=</span> <span class="s2">&quot;?&quot;</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="n">let</span><span class="o">+</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">%.0d</span><span class="s2">/2&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span></div>


<span class="c1"># ================== ELEMENTS FOR FUTURE CLASS</span>
<span class="c1"># angular and radial matrices</span>



<div class="viewcode-block" id="getAngularMatrix"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.getAngularMatrix">[docs]</a><span class="k">def</span> <span class="nf">getAngularMatrix</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">atom</span><span class="p">):</span>
    <span class="n">am</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="nb">round</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">j1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">j2</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">0</span><span class="p">),</span><span class="nb">round</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)))</span>
    <span class="n">m1</span> <span class="o">=</span> <span class="o">-</span><span class="n">j1</span>
    <span class="k">while</span> <span class="nb">round</span><span class="p">(</span><span class="n">j1</span><span class="o">-</span><span class="n">m1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="o">-</span><span class="n">j2</span>
        <span class="k">while</span> <span class="nb">round</span><span class="p">(</span><span class="n">j2</span><span class="o">-</span><span class="n">m2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="c1"># we have chosen the first index</span>
            <span class="n">index1</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">m1</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">j2</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">+</span><span class="n">m2</span><span class="o">+</span><span class="p">(</span><span class="n">j1</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">j2</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">+</span><span class="n">j2</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1">#print &quot;index1 = &quot;,index1</span>
            <span class="n">m</span> <span class="o">=</span> <span class="o">-</span><span class="n">j</span>
            <span class="k">while</span> <span class="nb">round</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">m</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                <span class="c1">#print m</span>
                <span class="n">mm</span> <span class="o">=</span> <span class="o">-</span><span class="n">j</span>
                <span class="k">while</span> <span class="nb">round</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">mm</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="c1">#print &quot;mm = &quot;,mm</span>
                    <span class="c1"># we have chosen the second index</span>
                    <span class="n">index2</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">mm</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">+</span><span class="n">j</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
                    <span class="c1">#print &quot;index 2 = &quot;,index2</span>
                    
                    <span class="c1"># angular matrix element from Walker, Saffman, PRA 77, 032723 (2008)</span>
                    <span class="n">elem</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="n">CG</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">CG</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">6.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">l</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span>
                    <span class="n">elem</span> <span class="o">=</span> <span class="n">elem</span><span class="o">*</span><span class="n">Wigner6j</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">l1</span><span class="p">)</span><span class="o">*</span><span class="n">Wigner6j</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">l2</span><span class="p">)</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="n">sumPol</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># sum over polarisations</span>
                    <span class="k">while</span> <span class="n">p</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">sumPol</span> <span class="o">=</span> <span class="n">sumPol</span> <span class="o">+</span> <span class="n">CG</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">CG</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">m1</span><span class="p">)</span><span class="o">*</span><span class="n">CG</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">mm</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="n">p</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">m2</span><span class="p">)</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">+</span><span class="mi">1</span>
                    <span class="n">am</span><span class="p">[</span><span class="n">index1</span><span class="p">,</span><span class="n">index2</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem</span><span class="o">*</span><span class="n">sumPol</span>
                    <span class="n">mm</span> <span class="o">=</span> <span class="n">mm</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">m2</span> <span class="o">=</span> <span class="n">m2</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="n">m1</span><span class="o">+</span><span class="mi">1</span>
    
    <span class="c1">#am  = np.matrix(am)</span>
    <span class="k">return</span> <span class="n">am</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">am</span><span class="p">)</span></div>
    <span class="c1">#return am.T*am</span>
    <span class="c1">#return 0</span>

<div class="viewcode-block" id="constructVector"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.constructVector">[docs]</a><span class="k">def</span> <span class="nf">constructVector</span><span class="p">(</span><span class="n">j1</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">):</span>
    <span class="c1"># returns state vector</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="nb">round</span><span class="p">((</span><span class="mf">2.0</span><span class="o">*</span><span class="n">j1</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">j2</span><span class="o">+</span><span class="mf">1.0</span><span class="p">),</span><span class="mi">0</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">br</span> <span class="o">=</span> <span class="n">m1</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">j2</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">+</span><span class="n">m2</span><span class="o">+</span><span class="n">j1</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">j2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">j2</span>
    <span class="n">a</span><span class="p">[</span><span class="n">br</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">return</span> <span class="n">a</span></div>

<div class="viewcode-block" id="singleAtomState"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.singleAtomState">[docs]</a><span class="k">def</span> <span class="nf">singleAtomState</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">m</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="nb">round</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mf">1.0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">1</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex64</span><span class="p">)</span>
    <span class="n">a</span><span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">m</span><span class="p">,</span><span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">a</span></div>

<div class="viewcode-block" id="compositeState"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.compositeState">[docs]</a><span class="k">def</span> <span class="nf">compositeState</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span><span class="n">s2</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">s1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">s2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex64</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">br1</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">br1</span><span class="o">&lt;</span><span class="n">s1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">br2</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">br2</span><span class="o">&lt;</span><span class="n">s2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="c1">#print br1,&quot; &quot;,br2</span>
            <span class="n">a</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">s1</span><span class="p">[</span><span class="n">br1</span><span class="p">]</span><span class="o">*</span><span class="n">s2</span><span class="p">[</span><span class="n">br2</span><span class="p">]</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">br2</span> <span class="o">=</span> <span class="n">br2</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">br1</span> <span class="o">=</span> <span class="n">br1</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">a</span></div>

<div class="viewcode-block" id="getMatrixInSubspaceOfM"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.getMatrixInSubspaceOfM">[docs]</a><span class="k">def</span> <span class="nf">getMatrixInSubspaceOfM</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">mat</span><span class="p">):</span>
    <span class="c1"># returns matrix mat in subspace where M = given value</span>
    <span class="c1"># second returned argument is list of basis </span>
    
    <span class="c1"># find basis in the space where Mz = M</span>
    <span class="c1"># Operator Mz is defined as (Mz = m1z + m2z)</span>
    <span class="n">m1</span> <span class="o">=</span> <span class="n">j1</span>
    <span class="n">m2</span> <span class="o">=</span> <span class="n">j2</span>
    <span class="c1">#print &quot;M=&quot;,M</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">m1</span><span class="o">+</span><span class="n">m2</span><span class="o">&gt;</span><span class="n">M</span> <span class="ow">and</span> <span class="nb">round</span><span class="p">(</span><span class="n">m1</span><span class="o">+</span><span class="n">j1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="n">m1</span><span class="o">-</span><span class="mi">1</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">m1</span><span class="o">+</span><span class="n">m2</span><span class="o">&gt;</span><span class="n">M</span> <span class="ow">and</span> <span class="nb">round</span><span class="p">(</span><span class="n">m2</span><span class="o">+</span><span class="n">j2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="n">m2</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># basis vectors in basis whith M well defined</span>
    <span class="k">while</span> <span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">m1</span><span class="o">-</span><span class="n">j1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">round</span><span class="p">(</span><span class="n">m2</span><span class="o">+</span><span class="n">j2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="c1">#print m1,&quot; &quot;,m2</span>
        <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">constructVector</span><span class="p">(</span><span class="n">j1</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">))</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="n">m1</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="n">m2</span><span class="o">-</span><span class="mi">1</span>
    
    <span class="n">basisSize</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
    <span class="n">am</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">basisSize</span><span class="p">,</span><span class="n">basisSize</span><span class="p">))</span>
    <span class="c1">#print am</span>
    <span class="n">br1</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">br1</span> <span class="o">&lt;</span> <span class="n">basisSize</span><span class="p">:</span>
        <span class="n">br2</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">br2</span> <span class="o">&lt;</span> <span class="n">basisSize</span><span class="p">:</span>
            <span class="n">am</span><span class="p">[</span><span class="n">br1</span><span class="p">,</span><span class="n">br2</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">br1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="n">br2</span><span class="p">])</span>
            <span class="n">br2</span> <span class="o">=</span> <span class="n">br2</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">br1</span> <span class="o">=</span> <span class="n">br1</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">am</span><span class="p">,</span><span class="n">arr</span></div>

<div class="viewcode-block" id="wignerDmatrix"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.wignerDmatrix">[docs]</a><span class="k">def</span> <span class="nf">wignerDmatrix</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">theta</span><span class="p">,</span><span class="n">phi</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
    <span class="c1"># angkes are givine in radians</span>
    <span class="c1"># z-y-z rotation</span>
    <span class="n">m</span> <span class="o">=</span> <span class="o">-</span> <span class="n">j</span>
    <span class="n">mat</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="nb">round</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mf">1.</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mf">1.</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex64</span><span class="p">)</span>
    <span class="k">while</span> <span class="nb">round</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">mm</span> <span class="o">=</span> <span class="o">-</span><span class="n">j</span>
        <span class="k">while</span> <span class="nb">round</span><span class="p">(</span><span class="n">mm</span><span class="o">-</span><span class="n">j</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">index1</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">index2</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">mm</span> <span class="o">+</span> <span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">mat</span><span class="p">[</span><span class="n">index1</span><span class="p">,</span><span class="n">index2</span><span class="p">]</span> <span class="o">=</span> <span class="n">wignerD</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">mm</span><span class="p">)(</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span><span class="n">gamma</span><span class="p">)</span>
            <span class="n">mm</span> <span class="o">=</span> <span class="n">mm</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">mat</span></div>

<div class="viewcode-block" id="getZeros"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.getZeros">[docs]</a><span class="k">def</span> <span class="nf">getZeros</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">searchRange</span><span class="p">):</span>
    <span class="n">zer</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">searchRange</span><span class="p">:</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">new</span><span class="o">*</span><span class="n">prev</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">zer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="n">new</span>
    <span class="k">return</span> <span class="n">zer</span></div>

<div class="viewcode-block" id="getAngularDependance"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.getAngularDependance">[docs]</a><span class="k">def</span> <span class="nf">getAngularDependance</span><span class="p">(</span><span class="n">angleTheta</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">mj</span><span class="p">,</span><span class="n">distance</span><span class="p">,</span><span class="n">angChannel</span><span class="p">,</span><span class="n">m</span><span class="p">):</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">singleAtomState</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">mj</span><span class="p">)</span>
    
    <span class="n">levelShift</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="n">angleTheta</span><span class="p">:</span>
        <span class="k">print</span> <span class="s2">&quot;Theta = &quot;</span><span class="p">,</span><span class="n">theta</span>
        <span class="n">phi</span> <span class="o">=</span>  <span class="mf">0.</span>
        <span class="c1">#theta = 0.#pi/2.</span>
        
        <span class="n">x</span> <span class="o">=</span> <span class="n">distance</span>  <span class="c1"># atom distances in mu m</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
    
        <span class="n">yState</span> <span class="o">=</span> <span class="p">[]</span>
    
        
        <span class="c1"># CALCULATING ANGULAR PART</span>
        <span class="n">angFactor</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="mi">1</span> 
        
        
        <span class="k">while</span> <span class="n">dim</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="c1">#print dim</span>
            <span class="n">dMatrix</span> <span class="o">=</span> <span class="n">wignerDmatrix</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span><span class="n">theta</span> <span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">stateN</span> <span class="o">=</span> <span class="n">dMatrix</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
            <span class="c1"># composite state of two atoms</span>
            <span class="n">stateCom</span> <span class="o">=</span> <span class="n">compositeState</span><span class="p">(</span><span class="n">stateN</span><span class="p">,</span> <span class="n">stateN</span><span class="p">)</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">angChannel</span><span class="p">[</span><span class="n">dim</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">interaction</span> <span class="o">=</span> <span class="n">conjugate</span><span class="p">(</span><span class="n">stateCom</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">stateCom</span><span class="p">))</span>
            <span class="n">interaction</span> <span class="o">=</span> <span class="n">real</span><span class="p">(</span><span class="n">interaction</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            
            <span class="n">angFactor</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interaction</span><span class="p">)</span>
    
            <span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span><span class="o">+</span><span class="mi">1</span>
        
        <span class="c1"># MAKING THE EIGENMATRIX AND FINDING EIGENVALUES AT DIFFERENT DISTANCES</span>
        
        <span class="n">rval</span> <span class="o">=</span> <span class="n">distance</span>
        <span class="c1">#print rval</span>
        <span class="c1"># calculate interaction matrix</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">dim</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            
            <span class="n">mat</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">mat</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">angFactor</span><span class="p">[</span><span class="n">dim</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">rval</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">mat</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">mat</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">dim</span><span class="p">]</span><span class="o">*</span><span class="n">angFactor</span><span class="p">[</span><span class="n">dim</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">rval</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span><span class="o">+</span><span class="mi">1</span>
        <span class="c1">#print &quot;matrix ok&quot;</span>
        <span class="n">dim</span><span class="o">=</span><span class="mi">0</span>
        <span class="c1">#print mat</span>
        <span class="c1">#ev = eigvals(mat)</span>
        <span class="n">ev</span><span class="p">,</span><span class="n">egvector</span> <span class="o">=</span> <span class="n">eig</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
        <span class="c1">#print ev</span>
        <span class="c1">#print ev[dim]</span>
        <span class="n">minimumShift</span> <span class="o">=</span> <span class="mf">1e15</span>
        <span class="k">while</span> <span class="n">dim</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ev</span><span class="p">[</span><span class="n">dim</span><span class="p">])</span><span class="o">&lt;=</span><span class="nb">abs</span><span class="p">(</span><span class="n">minimumShift</span><span class="p">):</span>
                <span class="n">minimumShift</span> <span class="o">=</span> <span class="n">ev</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">print</span> <span class="n">minimumShift</span>
        <span class="n">levelShift</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">minimumShift</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">levelShift</span><span class="p">)</span></div>



<div class="viewcode-block" id="LevelDiagramInteractions"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelDiagramInteractions">[docs]</a><span class="k">class</span> <span class="nc">LevelDiagramInteractions</span><span class="p">:</span>
    <span class="n">atom</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">l</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">j</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">nn</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">jj</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">m1</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">m2</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="c1"># finding coupling to energy levels</span>
    <span class="n">radialMatrix</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">channel</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">angChannel</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">states</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># states in the corresponding range of energies</span>
    <span class="n">matrixElement</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># variuos parts of interaction matrix in pair-state basis</span>
    <span class="n">matDiagonal</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">matR3</span> <span class="o">=</span> <span class="p">[]</span>   <span class="c1"># part that scales as 1/R^3 with distance (dipole-dipole interactions)</span>
    <span class="n">matR4</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># part that scales as 1/R^4 with distance (dipole-quadrupole interactions)</span>
    <span class="n">matR5</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># part that scales as 1/R^5 with distance (quadrupole-quadrupole interactions)</span>
    <span class="n">originalPairStateIndex</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="c1"># finding perturbed energy levels</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>    <span class="c1"># detuning scale</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>    <span class="c1"># energy levels</span>
    <span class="n">yState</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># pointers towards figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="mi">0</span>
    
    
    <span class="c1">#sam = saved angular matrix metadata</span>
    <span class="n">angularMatrixFile</span> <span class="o">=</span> <span class="s2">&quot;angularMatrix.npy&quot;</span>
    <span class="n">angularMatrixFile_meta</span> <span class="o">=</span> <span class="s2">&quot;angularMatrix_meta.npy&quot;</span>
    <span class="n">sam</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">savedAngularMatrix_matrix</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># for normalization of the maximum coupling later</span>
    <span class="n">maxCoupling</span> <span class="o">=</span> <span class="mf">0.</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">atom</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">nn</span><span class="p">,</span><span class="n">ll</span><span class="p">,</span><span class="n">jj</span><span class="p">,</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">):</span>
        <span class="c1"># alkali atom type, principal quantum number, orbital angular momenum, total angular momentum</span>
        <span class="c1"># projections of the angular momentum on z axis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="n">atom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">=</span> <span class="n">l</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">=</span> <span class="n">j</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nn</span> <span class="o">=</span> <span class="n">nn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ll</span> <span class="o">=</span> <span class="n">ll</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jj</span> <span class="o">=</span> <span class="n">jj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m1</span> <span class="o">=</span> <span class="n">m1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m2</span> <span class="o">=</span> <span class="n">m2</span>
        
        
        <span class="c1">#return 0</span>
        <span class="c1"># load previously calculated angular matrix elements</span>
        <span class="c1">#success = True</span>
        <span class="c1">#if (self.angularMatrixFile != &quot;&quot;) and os.path.isfile(self.angularMatrixFile):</span>
        <span class="c1">#    try:</span>
        <span class="c1">#        self.savedAngularMatrix_matrix = pickle.load(self.angularMatrixFile)</span>
        <span class="c1">#        </span>
        <span class="c1">#    except pickle.PickleError,e:</span>
        <span class="c1">#        success = False</span>
        <span class="c1">#        print &quot;Error reading angularMatrix data File &quot;+self.angularMatrixFile</span>
        <span class="c1">#        print e</span>
        <span class="c1">#        </span>
        <span class="c1">#if (self.angularMatrixFile_meta != &quot;&quot;) and os.path.isfile(self.angularMatrixFile_meta):</span>
        <span class="c1">#    try:</span>
        <span class="c1">#        self.sam = pickle.load(self.angularMatrixFile_meta)</span>
        <span class="c1">#        </span>
        <span class="c1">#    except pickle.PickleError,e:</span>
        <span class="c1">#        success = False</span>
        <span class="c1">#        print &quot;Error reading angularMatrix metadata (description) File &quot;+self.angularMatrixFile_meta</span>
        <span class="c1">#        print e</span>
        <span class="c1">#if not success:</span>
        <span class="c1">#    self.savedAngularMatrix_matrix = []</span>
        <span class="c1">#    self.sam = []</span>
    
    <span class="k">def</span> <span class="nf">__getAngularMatrix_M</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">atom</span><span class="p">):</span>
        <span class="n">am</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="nb">round</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">j1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">j2</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">0</span><span class="p">),</span><span class="nb">round</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)))</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="o">-</span><span class="n">j1</span>
        <span class="k">while</span> <span class="nb">round</span><span class="p">(</span><span class="n">j1</span><span class="o">-</span><span class="n">m1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">m2</span> <span class="o">=</span> <span class="o">-</span><span class="n">j2</span>
            <span class="k">while</span> <span class="nb">round</span><span class="p">(</span><span class="n">j2</span><span class="o">-</span><span class="n">m2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                <span class="c1"># we have chosen the first index</span>
                <span class="n">index1</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">m1</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">j2</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">+</span><span class="n">m2</span><span class="o">+</span><span class="p">(</span><span class="n">j1</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">j2</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">+</span><span class="n">j2</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
                <span class="c1">#print &quot;index1 = &quot;,index1</span>
                <span class="n">m</span> <span class="o">=</span> <span class="o">-</span><span class="n">j</span>
                <span class="k">while</span> <span class="nb">round</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">m</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="c1">#print m</span>
                    <span class="n">mm</span> <span class="o">=</span> <span class="o">-</span><span class="n">j</span>
                    <span class="k">while</span> <span class="nb">round</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">mm</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                        <span class="c1">#print &quot;mm = &quot;,mm</span>
                        <span class="c1"># we have chosen the second index</span>
                        <span class="n">index2</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">mm</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">+</span><span class="n">j</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
                        <span class="c1">#print &quot;index 2 = &quot;,index2</span>
                        
                        <span class="c1"># angular matrix element from Walker, Saffman, PRA 77, 032723 (2008)</span>
                        <span class="n">elem</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="n">CG</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">CG</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">6.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">l</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span>
                        <span class="n">elem</span> <span class="o">=</span> <span class="n">elem</span><span class="o">*</span><span class="n">Wigner6j</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">l1</span><span class="p">)</span><span class="o">*</span><span class="n">Wigner6j</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">l2</span><span class="p">)</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                        <span class="n">sumPol</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># sum over polarisations</span>
                        <span class="k">while</span> <span class="n">p</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">sumPol</span> <span class="o">=</span> <span class="n">sumPol</span> <span class="o">+</span> <span class="n">CG</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">CG</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">m1</span><span class="p">)</span><span class="o">*</span><span class="n">CG</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">mm</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="n">p</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">m2</span><span class="p">)</span>
                            <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">+</span><span class="mi">1</span>
                        <span class="n">am</span><span class="p">[</span><span class="n">index1</span><span class="p">,</span><span class="n">index2</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem</span><span class="o">*</span><span class="n">sumPol</span>
                        <span class="n">mm</span> <span class="o">=</span> <span class="n">mm</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">m2</span> <span class="o">=</span> <span class="n">m2</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">m1</span> <span class="o">=</span> <span class="n">m1</span><span class="o">+</span><span class="mi">1</span>
        
        <span class="c1">#am  = np.matrix(am)</span>
        <span class="k">return</span> <span class="n">am</span>
    
    

    
    <span class="k">def</span> <span class="nf">__getAngularMatrix_M2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">nn</span><span class="p">,</span><span class="n">ll</span><span class="p">,</span><span class="n">jj</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">atom</span><span class="p">):</span>
        <span class="c1"># determine coupling</span>
        <span class="n">dl</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">l</span><span class="o">-</span><span class="n">l1</span><span class="p">)</span>
        <span class="n">dj</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">j1</span><span class="p">)</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">dl</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">dj</span><span class="o">&lt;</span><span class="mf">1.1</span><span class="p">):</span>
            <span class="n">c1</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># dipole coupling</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">dl</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">dl</span><span class="o">==</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">dl</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">c1</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># quadrupole coupling</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;error in __getAngularMatrix_M2&quot;</span>
            <span class="nb">exit</span><span class="p">()</span>
        <span class="n">dl</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ll</span><span class="o">-</span><span class="n">l2</span><span class="p">)</span>
        <span class="n">dj</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">jj</span><span class="o">-</span><span class="n">j2</span><span class="p">)</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">dl</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">dj</span><span class="o">&lt;</span><span class="mf">1.1</span><span class="p">):</span>
            <span class="n">c2</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># dipole coupling</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">dl</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">dl</span><span class="o">==</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">dl</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">c2</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># quadrupole coupling</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;error in __getAngularMatrix_M2&quot;</span>
            <span class="nb">exit</span><span class="p">()</span>                  
        
        <span class="c1">#print c1</span>
        <span class="c1">#print c2</span>
        
        <span class="c1"># did we already calculated this matrix?</span>
        <span class="n">br</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">br</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sam</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sam</span><span class="p">[</span><span class="n">br</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sam</span><span class="p">[</span><span class="n">br</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">j</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sam</span><span class="p">[</span><span class="n">br</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">ll</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sam</span><span class="p">[</span><span class="n">br</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">jj</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span> <span class="ow">and</span>\
                                     <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sam</span><span class="p">[</span><span class="n">br</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span><span class="o">-</span><span class="n">l1</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sam</span><span class="p">[</span><span class="n">br</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span><span class="o">-</span><span class="n">j1</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sam</span><span class="p">[</span><span class="n">br</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span><span class="o">-</span><span class="n">l2</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sam</span><span class="p">[</span><span class="n">br</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span><span class="o">-</span><span class="n">j2</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span><span class="p">):</span>
            <span class="n">br</span> <span class="o">+=</span><span class="mi">1</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">br</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sam</span><span class="p">)):</span>
            <span class="c1">#print &quot;cache hit&quot;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">savedAngularMatrix_matrix</span><span class="p">[</span><span class="n">br</span><span class="p">]</span>
            
        
        <span class="n">fcoef</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">l1</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">m</span><span class="p">:</span> <span class="n">factorial</span><span class="p">(</span><span class="n">l1</span><span class="o">+</span><span class="n">l2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="n">l1</span><span class="o">+</span><span class="n">m</span><span class="p">)</span><span class="o">*</span><span class="n">factorial</span><span class="p">(</span><span class="n">l1</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">*</span><span class="n">factorial</span><span class="p">(</span><span class="n">l2</span><span class="o">+</span><span class="n">m</span><span class="p">)</span><span class="o">*</span><span class="n">factorial</span><span class="p">(</span><span class="n">l2</span><span class="o">-</span><span class="n">m</span><span class="p">))</span><span class="o">**</span><span class="mf">0.5</span>

        
        <span class="n">am</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="nb">round</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">j1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">j2</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">0</span><span class="p">),</span><span class="nb">round</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">jj</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">0</span><span class="p">)))</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="o">-</span><span class="n">j1</span>
        <span class="k">while</span> <span class="nb">round</span><span class="p">(</span><span class="n">j1</span><span class="o">-</span><span class="n">m1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">m2</span> <span class="o">=</span> <span class="o">-</span><span class="n">j2</span>
            <span class="k">while</span> <span class="nb">round</span><span class="p">(</span><span class="n">j2</span><span class="o">-</span><span class="n">m2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                <span class="c1"># we have chosen the first index</span>
                <span class="n">index1</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">m1</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">j2</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">+</span><span class="n">m2</span><span class="o">+</span><span class="p">(</span><span class="n">j1</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">j2</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">+</span><span class="n">j2</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
                <span class="c1">#print &quot;index1 = &quot;,index1</span>
                <span class="n">m</span> <span class="o">=</span> <span class="o">-</span><span class="n">j</span>
                <span class="k">while</span> <span class="nb">round</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">m</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="c1">#print m</span>
                    <span class="n">mm</span> <span class="o">=</span> <span class="o">-</span><span class="n">jj</span>
                    <span class="k">while</span> <span class="nb">round</span><span class="p">(</span><span class="n">jj</span><span class="o">-</span><span class="n">mm</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                        <span class="c1">#print &quot;mm = &quot;,mm</span>
                        <span class="c1"># we have chosen the second index</span>
                        <span class="n">index2</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">jj</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">+</span><span class="n">mm</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">jj</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">+</span><span class="n">jj</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span><span class="c1">#round(m*(2.0*j+1)+mm+(j*(2.0*j+1.0)+j),0)</span>
                        <span class="c1">#print &quot;index 2 = &quot;,index2</span>
                        
                        
                        <span class="c1"># angular matrix element from Sa??mannshausen, Heiner, Merkt, Fr??d??ric, Deiglmayr, Johannes</span>
                        <span class="c1"># PRA 92: 032505 (2015)</span>
                        <span class="n">elem</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">jj</span><span class="o">+</span><span class="mf">1.0</span><span class="o">+</span><span class="n">l1</span><span class="o">+</span><span class="n">l2</span><span class="p">)</span><span class="o">*</span><span class="n">CG</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">c1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">CG</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">elem</span> <span class="o">=</span> <span class="n">elem</span><span class="o">*</span><span class="n">sqrt</span><span class="p">((</span><span class="mf">2.0</span><span class="o">*</span><span class="n">l</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">ll</span><span class="o">+</span><span class="mf">1.0</span><span class="p">))</span><span class="o">*</span><span class="n">sqrt</span><span class="p">((</span><span class="mf">2.0</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">jj</span><span class="o">+</span><span class="mf">1.0</span><span class="p">))</span>
                        <span class="n">elem</span> <span class="o">=</span> <span class="n">elem</span><span class="o">*</span><span class="n">Wigner6j</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">l1</span><span class="p">)</span><span class="o">*</span><span class="n">Wigner6j</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">jj</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="n">l2</span><span class="p">)</span>

                        <span class="c1">#elem = elem*Wigner6j(l, 0.5, j, j1, 1.0, l1)*Wigner6j(ll,0.5,jj,j2,1,l2)</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">)</span>
                        <span class="n">sumPol</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># sum over polarisations</span>
                        <span class="k">while</span> <span class="n">p</span><span class="o">&lt;=</span><span class="nb">min</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">):</span>
                            <span class="c1">#print j,&quot; &quot;,m,&quot; &quot;,c1,&quot; &quot;,p,&quot; &quot;,j1,&quot; &quot;,m1</span>
                            <span class="c1">#print jj,&quot; &quot;,mm,&quot; &quot;,c2,&quot; &quot;,-p,&quot; &quot;,j2,&quot; &quot;,m2</span>
                            <span class="n">sumPol</span> <span class="o">=</span> <span class="n">sumPol</span> <span class="o">+</span> <span class="n">fcoef</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">CG</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">c1</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">m1</span><span class="p">)</span><span class="o">*</span><span class="n">CG</span><span class="p">(</span><span class="n">jj</span><span class="p">,</span><span class="n">mm</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="o">-</span><span class="n">p</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">m2</span><span class="p">)</span>
                            <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">+</span><span class="mi">1</span>
                        <span class="n">am</span><span class="p">[</span><span class="n">index1</span><span class="p">,</span><span class="n">index2</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem</span><span class="o">*</span><span class="n">sumPol</span>
                        <span class="n">mm</span> <span class="o">=</span> <span class="n">mm</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">m2</span> <span class="o">=</span> <span class="n">m2</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">m1</span> <span class="o">=</span> <span class="n">m1</span><span class="o">+</span><span class="mi">1</span>
        
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">sam</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ll</span><span class="p">,</span><span class="n">jj</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">savedAngularMatrix_matrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">am</span><span class="p">))</span>
        <span class="c1">#am  = np.matrix(am)</span>
        <span class="k">return</span> <span class="n">am</span>
    
<div class="viewcode-block" id="LevelDiagramInteractions.updateAngularMatrixElementsFile"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelDiagramInteractions.updateAngularMatrixElementsFile">[docs]</a>    <span class="k">def</span> <span class="nf">updateAngularMatrixElementsFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># save dipole elements</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sam</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">angularMatrixFile_meta</span><span class="p">)</span> 
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Error while updating angularMatrix data meta (description) File &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">angularMatrixFile_meta</span>
            <span class="k">print</span> <span class="n">e</span>
        <span class="c1"># save quadrupole elements</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">savedAngularMatrix_matrix</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">angularMatrixFile</span><span class="p">)</span> 
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Error while updating angularMatrix data File &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">angularMatrixFile</span>
            <span class="k">print</span> <span class="n">e</span></div>
    
    <span class="k">def</span> <span class="nf">__makeRawMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">limit</span><span class="p">,</span><span class="n">atom</span><span class="p">):</span>
        <span class="c1"># limit = limit in Hz on energy defect </span>
        <span class="c1"># k defines range of n&#39; = [n-k, n+k]</span>
        <span class="n">dimension</span> <span class="o">=</span> <span class="mi">1</span>
        
        <span class="n">n1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">n1</span><span class="o">&lt;=</span><span class="n">n</span><span class="o">+</span><span class="n">k</span><span class="p">:</span>
            <span class="n">n2</span> <span class="o">=</span> <span class="n">n</span><span class="o">-</span><span class="n">k</span>
            <span class="k">while</span> <span class="n">n2</span><span class="o">&lt;=</span><span class="n">n</span><span class="o">+</span><span class="n">k</span><span class="p">:</span>   <span class="c1">#(1 february 2016) used to be n1:  with comment#n+k:   # that spins are same will be calculated in the angular matrix part; that&#39;s why we are calculating only 1/2 of the full matrix  </span>
                <span class="n">l1</span> <span class="o">=</span> <span class="n">l</span><span class="o">-</span><span class="mi">1</span>
                <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">l1</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">while</span> <span class="n">l1</span> <span class="o">&lt;=</span> <span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">l2</span> <span class="o">=</span> <span class="n">l</span><span class="o">-</span><span class="mi">1</span>
                    <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">l2</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">while</span> <span class="n">l2</span> <span class="o">&lt;=</span> <span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">j1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">l1</span><span class="o">*</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> 
                        <span class="k">if</span> <span class="n">l1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">j1</span> <span class="o">=</span> <span class="mf">0.5</span>
                        <span class="k">while</span> <span class="n">j1</span> <span class="o">&lt;=</span> <span class="nb">min</span><span class="p">(</span><span class="n">l1</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mf">1.0</span><span class="p">):</span>
                            <span class="n">j2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">l2</span><span class="o">*</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">l2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">j2</span> <span class="o">=</span> <span class="mf">0.5</span>
                            <span class="k">while</span> <span class="n">j2</span> <span class="o">&lt;=</span> <span class="nb">min</span><span class="p">(</span><span class="n">l2</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mf">1.0</span><span class="p">):</span>
                                <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">energyDefect</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">))</span><span class="o">/</span><span class="n">h</span><span class="o">&lt;</span><span class="n">limit</span><span class="p">):</span>
                                    <span class="n">printState</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">)</span> 
                                    <span class="n">printState</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">)</span>
                                    <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">energyDefect</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">)</span><span class="o">/</span><span class="n">h</span><span class="o">*</span><span class="mf">1.0e-9</span><span class="p">,</span> <span class="s2">&quot; GHz&quot;</span>
                                    

                                    <span class="n">dimension</span> <span class="o">=</span> <span class="n">dimension</span> <span class="o">+</span><span class="mi">1</span>
                                <span class="n">j2</span> <span class="o">=</span> <span class="n">j2</span><span class="o">+</span><span class="mf">1.0</span>
                            <span class="n">j1</span> <span class="o">=</span> <span class="n">j1</span><span class="o">+</span><span class="mf">1.0</span>
                        <span class="n">l2</span> <span class="o">=</span> <span class="n">l2</span><span class="o">+</span><span class="mi">2</span>
                    
                    <span class="n">l1</span> <span class="o">=</span> <span class="n">l1</span><span class="o">+</span><span class="mi">2</span>
                    
                <span class="n">n2</span> <span class="o">=</span> <span class="n">n2</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">n1</span> <span class="o">=</span> <span class="n">n1</span><span class="o">+</span><span class="mi">1</span>    
        
        
        <span class="k">print</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Matrix dimension</span><span class="se">\t</span><span class="s2">=</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">dimension</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">dimension</span><span class="p">,</span><span class="n">dimension</span><span class="p">))</span>
        <span class="n">dimension</span> <span class="o">=</span> <span class="mi">1</span>
        
        <span class="c1"># which states/channels contribute significantly in the second order pertubation?</span>
        <span class="n">states</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># Calculations</span>
        <span class="n">n1</span> <span class="o">=</span> <span class="n">n</span><span class="o">-</span><span class="n">k</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">n1</span><span class="o">&lt;=</span><span class="n">n</span><span class="o">+</span><span class="n">k</span><span class="p">:</span>
            <span class="n">n2</span> <span class="o">=</span> <span class="n">n</span><span class="o">-</span><span class="n">k</span>
            <span class="k">while</span> <span class="n">n2</span><span class="o">&lt;=</span><span class="n">n</span><span class="o">+</span><span class="n">k</span><span class="p">:</span>   <span class="c1">#(1 february 2016) used to be n1:  with comment#n+k:   # that spins are same will be calculated in the angular matrix part; that&#39;s why we are calculating only 1/2 of the full matrix  # that spins are same will be calculated in the angular matrix part; that&#39;s why we are calculating only 1/2 of the full matrix  </span>
                <span class="n">l1</span> <span class="o">=</span> <span class="n">l</span><span class="o">-</span><span class="mi">1</span>
                <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">l1</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">while</span> <span class="n">l1</span> <span class="o">&lt;=</span> <span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">l2</span> <span class="o">=</span> <span class="n">l</span><span class="o">-</span><span class="mi">1</span>
                    <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">l2</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">while</span> <span class="n">l2</span> <span class="o">&lt;=</span> <span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">j1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">l1</span><span class="o">*</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> 
                        <span class="k">if</span> <span class="n">l1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">j1</span> <span class="o">=</span> <span class="mf">0.5</span>
                        <span class="k">while</span> <span class="n">j1</span> <span class="o">&lt;=</span> <span class="nb">min</span><span class="p">(</span><span class="n">l1</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mf">1.0</span><span class="p">):</span>
                            <span class="n">j2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">l2</span><span class="o">*</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">l2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">j2</span> <span class="o">=</span> <span class="mf">0.5</span>
                            <span class="k">while</span> <span class="n">j2</span> <span class="o">&lt;=</span> <span class="nb">min</span><span class="p">(</span><span class="n">l2</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mf">1.0</span><span class="p">):</span>
                                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">energyDefect</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">))</span><span class="o">/</span><span class="n">h</span><span class="o">&lt;</span><span class="n">limit</span><span class="p">:</span>
                                    <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">])</span>
                                    <span class="k">print</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> Calculating dipole element for overlap of initial state with:&quot;</span>
                                    <span class="n">printState</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">)</span> 
                                    <span class="n">printState</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">)</span>
                                    <span class="n">ed</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">energyDefect</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">)</span><span class="o">/</span><span class="n">h</span><span class="o">*</span><span class="mf">1.0e-9</span>
                                    <span class="k">print</span> <span class="n">ed</span><span class="p">,</span> <span class="s2">&quot; GHz&quot;</span>
            
                                    <span class="n">m</span><span class="p">[</span><span class="n">dimension</span><span class="p">,</span><span class="n">dimension</span><span class="p">]</span> <span class="o">=</span> <span class="n">ed</span>
                                    <span class="n">c3</span> <span class="o">=</span> <span class="n">c3term</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">atom</span><span class="p">)</span> <span class="o">/</span><span class="n">h</span><span class="o">*</span><span class="mf">1.0e9</span>
                                    <span class="n">m</span><span class="p">[</span><span class="n">dimension</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">c3</span>
                                    <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">dimension</span><span class="p">]</span> <span class="o">=</span> <span class="n">c3</span>
                                    <span class="n">temp</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">+</span> <span class="n">c3</span>
                                    <span class="k">print</span> <span class="s2">&quot;c3</span><span class="se">\t</span><span class="s2">=</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">c3</span><span class="p">,</span><span class="s2">&quot;/R^3 GHz/ (mu m)^3&quot;</span>
                                    <span class="k">print</span> <span class="s2">&quot;running sum(c3)</span><span class="se">\t</span><span class="s2">=</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="s2">&quot;/R^3 GHz/ (mu m)^3&quot;</span>
                                   
                                    <span class="c1"># OLD CALCULATION THAT USED BY MISTAKE C6 INSTEAD OF C3</span>
                                    <span class="c1">#c6 = c6term(n,l,j,n1,l1,j1,n2,l2,j2,atom) /h*1.0e27</span>
                                    <span class="c1">#m[dimension,0] = c6</span>
                                    <span class="c1">#m[0, dimension] = c6</span>
                                    <span class="c1">#temp = temp + c6</span>
                                    <span class="c1">#print &quot;c6\t=\t&quot;,c6,&quot;/R^6 GHz/ (mu m)^6&quot;</span>
                                    <span class="c1">#print &quot;runnin sum(c6)\t=\t&quot;, temp, &quot;/R^6 GHz/ (mu m)^6&quot;</span>
                                    
                                    <span class="n">dimension</span> <span class="o">=</span> <span class="n">dimension</span> <span class="o">+</span><span class="mi">1</span>
                                <span class="c1">#else:</span>
                                    <span class="c1">#print &quot;not&quot;</span>
                                    <span class="c1">#printState(n1,l1,j1) </span>
                                    <span class="c1">#print abs(energyDefect(n,l,j,n1,l1,j1,n2,l2,j2,atom))/h*1.0e-9</span>
                                    <span class="c1">#printState(n2,l2,j2)</span>
                                <span class="n">j2</span> <span class="o">=</span> <span class="n">j2</span><span class="o">+</span><span class="mf">1.0</span>
                            <span class="n">j1</span> <span class="o">=</span> <span class="n">j1</span><span class="o">+</span><span class="mf">1.0</span>
                        <span class="n">l2</span> <span class="o">=</span> <span class="n">l2</span><span class="o">+</span><span class="mi">2</span>
                    
                    <span class="n">l1</span> <span class="o">=</span> <span class="n">l1</span><span class="o">+</span><span class="mi">2</span>
                    
                <span class="n">n2</span> <span class="o">=</span> <span class="n">n2</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">n1</span> <span class="o">=</span> <span class="n">n1</span><span class="o">+</span><span class="mi">1</span> 
    
        <span class="k">return</span> <span class="n">m</span><span class="p">,</span><span class="n">states</span>
    
    <span class="k">def</span> <span class="nf">__isCoupled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">nn</span><span class="p">,</span><span class="n">ll</span><span class="p">,</span><span class="n">jj</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">limit</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">energyDefect2</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">nn</span><span class="p">,</span><span class="n">ll</span><span class="p">,</span><span class="n">jj</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">))</span><span class="o">/</span><span class="n">h</span><span class="o">&lt;</span><span class="n">limit</span><span class="p">)</span> <span class="ow">and</span>\
                <span class="ow">not</span> <span class="p">(</span><span class="n">n</span><span class="o">==</span><span class="n">n1</span> <span class="ow">and</span> <span class="n">nn</span><span class="o">==</span><span class="n">n2</span> <span class="ow">and</span> <span class="n">l</span><span class="o">==</span><span class="n">l1</span> <span class="ow">and</span> <span class="n">ll</span><span class="o">==</span><span class="n">l2</span> <span class="ow">and</span> <span class="n">j</span><span class="o">==</span><span class="n">j1</span> <span class="ow">and</span> <span class="n">jj</span><span class="o">==</span><span class="n">j2</span><span class="p">)</span> \
                <span class="ow">and</span> <span class="ow">not</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">l1</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">!=</span><span class="mi">1</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">j1</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">l2</span><span class="o">-</span><span class="n">ll</span><span class="p">)</span><span class="o">!=</span><span class="mi">1</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">jj</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">j2</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span><span class="p">)):</span>
                            <span class="c1"># determine coupling</span>
                <span class="n">dl</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">l</span><span class="o">-</span><span class="n">l1</span><span class="p">)</span>
                <span class="n">dj</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">j1</span><span class="p">)</span>
                <span class="n">c1</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">dl</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">dj</span><span class="o">&lt;</span><span class="mf">1.1</span><span class="p">):</span>
                    <span class="n">c1</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># dipole coupling</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">dl</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">dl</span><span class="o">==</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">dl</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="ow">and</span> <span class="p">(</span><span class="n">dj</span><span class="o">&lt;</span><span class="mf">2.1</span><span class="p">):</span>
                    <span class="n">c1</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># quadrupole coupling</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">False</span>
                <span class="n">dl</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ll</span><span class="o">-</span><span class="n">l2</span><span class="p">)</span>
                <span class="n">dj</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">jj</span><span class="o">-</span><span class="n">j2</span><span class="p">)</span>
                <span class="n">c2</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">dl</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">dj</span><span class="o">&lt;</span><span class="mf">1.1</span><span class="p">):</span>
                    <span class="n">c2</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># dipole coupling</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">dl</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">dl</span><span class="o">==</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">dl</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">dj</span><span class="o">&lt;</span><span class="mf">2.1</span><span class="p">):</span>
                    <span class="n">c2</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># quadrupole coupling</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">False</span>                                    
                <span class="k">return</span> <span class="n">c1</span><span class="o">+</span><span class="n">c2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    
    <span class="k">def</span> <span class="nf">__makeRawMatrix2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">nn</span><span class="p">,</span><span class="n">ll</span><span class="p">,</span><span class="n">jj</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">lrange</span><span class="p">,</span><span class="n">limit</span><span class="p">):</span>
        <span class="c1"># limit = limit in Hz on energy defect </span>
        <span class="c1"># k defines range of n&#39; = [n-k, n+k]</span>
        <span class="n">dimension</span> <span class="o">=</span> <span class="mi">0</span>

        
        <span class="c1"># which states/channels contribute significantly in the second order pertubation?</span>
        <span class="n">states</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># original pairstate index</span>
        <span class="n">opi</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="c1"># hack when we are including only dd interactions we need to include initial state by hand</span>
        <span class="c1">#states.append([n,l,j,nn,ll,jj])</span>
        <span class="c1">#opi=dimension</span>
        <span class="c1">#dimension = dimension+1</span>

        
        
        <span class="n">n1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">n1</span><span class="o">&lt;=</span><span class="n">n</span><span class="o">+</span><span class="n">k</span><span class="p">:</span>
            <span class="n">n2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nn</span><span class="o">-</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">n2</span><span class="o">&lt;=</span><span class="n">nn</span><span class="o">+</span><span class="n">k</span><span class="p">:</span>   <span class="c1">#(1 february 2016) used to be n1:  with comment#n+k:   # that spins are same will be calculated in the angular matrix part; that&#39;s why we are calculating only 1/2 of the full matrix  </span>
                <span class="n">l1</span> <span class="o">=</span> <span class="n">l</span><span class="o">-</span><span class="mi">1</span>
                <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">l1</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="n">l1</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">lrange</span><span class="p">):</span>
                    <span class="n">l2</span> <span class="o">=</span> <span class="n">ll</span><span class="o">-</span><span class="mi">1</span>
                    <span class="k">if</span> <span class="n">ll</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">l2</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">while</span> <span class="n">l2</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">lrange</span><span class="p">):</span>
                        <span class="n">j1</span> <span class="o">=</span> <span class="n">l1</span><span class="o">-</span><span class="mf">0.5</span><span class="c1">#max(l1*1.0-0.5,j-2.0) </span>
                        <span class="k">if</span> <span class="n">l1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">j1</span> <span class="o">=</span> <span class="mf">0.5</span>
                        <span class="k">while</span> <span class="n">j1</span> <span class="o">&lt;=</span> <span class="n">l1</span><span class="o">+</span><span class="mf">0.5</span><span class="o">+</span><span class="mf">0.1</span><span class="p">:</span><span class="c1">#min(l1+0.5,j+2.0)+0.1:</span>
                            <span class="n">j2</span> <span class="o">=</span> <span class="n">l2</span><span class="o">-</span><span class="mf">0.5</span><span class="c1">#max(l2*1.0 - 0.5,j-2.0)</span>
                            <span class="k">if</span> <span class="n">l2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">j2</span> <span class="o">=</span> <span class="mf">0.5</span>
                            
                            <span class="k">while</span> <span class="n">j2</span> <span class="o">&lt;=</span> <span class="n">l2</span><span class="o">+</span><span class="mf">0.5</span><span class="o">+</span><span class="mf">0.1</span><span class="p">:</span><span class="c1">#min(l2+0.5,j+2.0)+0.1:</span>
                                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">energyDefect2</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">nn</span><span class="p">,</span><span class="n">ll</span><span class="p">,</span><span class="n">jj</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">))</span><span class="o">/</span><span class="n">h</span><span class="o">&lt;</span><span class="n">limit</span>  <span class="p">:</span> <span class="c1">#and(abs(l-l1)&lt;1.1)and(abs(ll-l2)&lt;1.1)and (abs(j-j1)&lt;1.1) and (abs(jj-j2)&lt;1.1) and (abs(l-l1)&gt;0) and (abs(ll-l2)&gt;0)</span>
                                    <span class="n">printState</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">)</span> 
                                    <span class="n">printState</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">)</span>
                                    <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">])</span>
                                    <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">energyDefect2</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">nn</span><span class="p">,</span><span class="n">ll</span><span class="p">,</span><span class="n">jj</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">)</span><span class="o">/</span><span class="n">h</span><span class="o">*</span><span class="mf">1.0e-9</span><span class="p">,</span> <span class="s2">&quot; GHz&quot;</span>
                                    
                                    <span class="k">if</span> <span class="p">(</span><span class="n">n</span><span class="o">==</span><span class="n">n1</span> <span class="ow">and</span> <span class="n">nn</span><span class="o">==</span><span class="n">n2</span> <span class="ow">and</span> <span class="n">l</span><span class="o">==</span><span class="n">l1</span> <span class="ow">and</span> <span class="n">ll</span><span class="o">==</span><span class="n">l2</span> <span class="ow">and</span> <span class="n">j</span><span class="o">==</span><span class="n">j1</span> <span class="ow">and</span> <span class="n">jj</span><span class="o">==</span><span class="n">j2</span><span class="p">):</span>
                                        <span class="n">opi</span> <span class="o">=</span> <span class="n">dimension</span>
                                    
                                    <span class="n">dimension</span> <span class="o">=</span> <span class="n">dimension</span> <span class="o">+</span><span class="mi">1</span>
                                <span class="n">j2</span> <span class="o">=</span> <span class="n">j2</span><span class="o">+</span><span class="mf">1.0</span>
                            <span class="n">j1</span> <span class="o">=</span> <span class="n">j1</span><span class="o">+</span><span class="mf">1.0</span>
                        <span class="n">l2</span> <span class="o">=</span> <span class="n">l2</span><span class="o">+</span><span class="mi">1</span>
                    
                    <span class="n">l1</span> <span class="o">=</span> <span class="n">l1</span><span class="o">+</span><span class="mi">1</span>
                    
                <span class="n">n2</span> <span class="o">=</span> <span class="n">n2</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">n1</span> <span class="o">=</span> <span class="n">n1</span><span class="o">+</span><span class="mi">1</span>    
        

        
        <span class="k">print</span> <span class="n">opi</span>
        <span class="k">print</span> <span class="n">states</span><span class="p">[</span><span class="n">opi</span><span class="p">]</span>
        
        
        <span class="k">print</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Matrix dimension</span><span class="se">\t</span><span class="s2">=</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">dimension</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">dimension</span><span class="p">,</span><span class="n">dimension</span><span class="p">))</span>
        <span class="n">exponentMatrix</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">dimension</span><span class="p">,</span><span class="n">dimension</span><span class="p">))</span>
        <span class="c1"># Calculations</span>
        <span class="n">i</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">dimension</span><span class="p">:</span>
            
            <span class="k">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">State&quot;</span>
            <span class="n">ed</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">energyDefect2</span><span class="p">(</span><span class="n">states</span><span class="p">[</span><span class="n">opi</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">opi</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">opi</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">opi</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">opi</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">opi</span><span class="p">][</span><span class="mi">5</span><span class="p">],</span>\
                    <span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">5</span><span class="p">])</span><span class="o">/</span><span class="n">h</span><span class="o">*</span><span class="mf">1.0e-9</span>
            <span class="n">printState</span><span class="p">(</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span> 
            <span class="n">printState</span><span class="p">(</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">5</span><span class="p">])</span>
            <span class="k">print</span> <span class="n">ed</span><span class="p">,</span> <span class="s2">&quot; GHz&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;===== coupled to ===== &quot;</span>
    
            <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ed</span>
            
            <span class="n">j</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span>
            <span class="k">while</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">dimension</span><span class="p">:</span>
                
                
                <span class="n">coupled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__isCoupled</span><span class="p">(</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>\
                                            <span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">5</span><span class="p">],</span>\
                                            <span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>\
                                             <span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">5</span><span class="p">],</span> <span class="n">limit</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">coupled</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> Calculating coupling (up to quadrupole) element for overlap of initial state with:&quot;</span>
                    
                    <span class="k">print</span> <span class="s2">&quot;&lt;-&gt;&quot;</span>
                    <span class="n">printState</span><span class="p">(</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span> 
                    <span class="n">printState</span><span class="p">(</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">5</span><span class="p">])</span>
                    
                    <span class="n">couplingStregth</span> <span class="o">=</span> <span class="n">atomLightAtomCoupling</span><span class="p">(</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>\
                                            <span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">5</span><span class="p">],</span>\
                                            <span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>\
                                             <span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">5</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">)</span><span class="o">/</span><span class="n">h</span><span class="o">*</span><span class="mf">1.0e-9</span> <span class="c1"># /h*1.0e9</span>
                    <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">couplingStregth</span> <span class="c1">#c3</span>
                    <span class="n">m</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">couplingStregth</span> <span class="c1">#c3</span>
                    <span class="n">exponentMatrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span>  <span class="n">coupled</span>
                    <span class="n">exponentMatrix</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>  <span class="n">coupled</span>
                    <span class="n">exponent</span> <span class="o">=</span> <span class="n">coupled</span><span class="o">+</span><span class="mi">1</span>
                    <span class="k">print</span> <span class="s2">&quot;coupling </span><span class="se">\t</span><span class="s2">=</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">couplingStregth</span><span class="o">*</span><span class="p">(</span><span class="mf">1e6</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">exponent</span><span class="p">),</span><span class="s2">&quot;/R^&quot;</span><span class="p">,</span><span class="n">exponent</span><span class="p">,</span><span class="s2">&quot; GHz/ (mu m)^&quot;</span><span class="p">,</span><span class="n">exponent</span>
                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        
                    
        <span class="c1"># coupling = [1,1] dipole-dipole, [2,1]  quadrupole dipole, [2,2] quadrupole quadrupole</span>
        <span class="k">return</span> <span class="n">m</span><span class="p">,</span><span class="n">states</span><span class="p">,</span><span class="n">exponentMatrix</span>
    

    
<div class="viewcode-block" id="LevelDiagramInteractions.findLevelDiagram"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelDiagramInteractions.findLevelDiagram">[docs]</a>    <span class="k">def</span> <span class="nf">findLevelDiagram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rPointsForCalculation</span><span class="p">,</span><span class="n">theta</span><span class="p">,</span><span class="n">phi</span><span class="p">,</span><span class="n">nRange</span><span class="p">,</span><span class="n">lrange</span><span class="p">,</span><span class="n">energyDelta</span><span class="p">):</span>
        <span class="c1"># rPointsForCalculation calculation range in mu m</span>
        
         
        <span class="bp">self</span><span class="o">.</span><span class="n">radialMatrix</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="p">,</span> <span class="n">exponentMatrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__makeRawMatrix2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">jj</span><span class="p">,</span><span class="n">nRange</span><span class="p">,</span><span class="n">lrange</span><span class="p">,</span><span class="n">energyDelta</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">updateDipoleMatrixElementsFile</span><span class="p">()</span>
        
        <span class="c1"># generate all the states (with mj principal quantum number)</span>
        
        <span class="c1"># opi = original pairstate index</span>
        <span class="n">opi</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="n">i</span><span class="o">=</span><span class="mi">0</span>
        <span class="c1"># hacked valiue (START</span>
        <span class="c1">#i=1</span>
        <span class="c1">#self.states.append([self.n,self.l,self.j,self.m1,self.nn,self.ll,self.jj,self.m2])</span>
        <span class="c1">#self.matrixElement.append(0)</span>
        <span class="c1"># hacked value (END)</span>
        <span class="k">while</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="p">):</span>
            <span class="n">stateCoupled</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            
            <span class="n">m1c</span> <span class="o">=</span> <span class="n">stateCoupled</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            
            <span class="k">while</span> <span class="p">(</span><span class="n">m1c</span><span class="o">+</span><span class="n">stateCoupled</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;-</span><span class="mf">0.1</span><span class="p">):</span>
                <span class="n">m2c</span> <span class="o">=</span> <span class="n">stateCoupled</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                <span class="k">while</span> <span class="p">(</span><span class="n">m2c</span><span class="o">+</span><span class="n">stateCoupled</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">&gt;-</span><span class="mf">0.1</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">stateCoupled</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">stateCoupled</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">stateCoupled</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">m1c</span><span class="p">,</span><span class="n">stateCoupled</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">stateCoupled</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">stateCoupled</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="n">m2c</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">matrixElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>   
                    
                    <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">stateCoupled</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span> <span class="ow">and</span> \
                        <span class="nb">abs</span><span class="p">(</span><span class="n">stateCoupled</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span> <span class="ow">and</span> \
                        <span class="nb">abs</span><span class="p">(</span><span class="n">stateCoupled</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span> <span class="ow">and</span> \
                        <span class="nb">abs</span><span class="p">(</span><span class="n">m1c</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">m1</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span> <span class="ow">and</span> \
                        <span class="nb">abs</span><span class="p">(</span><span class="n">stateCoupled</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span> <span class="ow">and</span> \
                        <span class="nb">abs</span><span class="p">(</span><span class="n">stateCoupled</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ll</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span> <span class="ow">and</span> \
                        <span class="nb">abs</span><span class="p">(</span><span class="n">stateCoupled</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">jj</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span> <span class="ow">and</span> \
                        <span class="nb">abs</span><span class="p">(</span><span class="n">m2c</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">m2</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span><span class="p">):</span>
                        <span class="n">opi</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
                    
                    <span class="n">m2c</span> <span class="o">=</span> <span class="n">m2c</span> <span class="o">-</span><span class="mi">1</span>
                <span class="n">m1c</span> <span class="o">=</span> <span class="n">m1c</span> <span class="o">-</span><span class="mi">1</span>
                
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>

        
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span>
        <span class="k">print</span> <span class="s2">&quot;Original state = &quot;</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">opi</span><span class="p">]</span>
        
        <span class="c1"># SETTING THE ORIENTATIN OF THE TWO ATOMS</span>
        
        
        <span class="n">dMatrix</span> <span class="o">=</span> <span class="n">wignerDmatrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span><span class="n">theta</span> <span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        
        <span class="c1"># WHAT IS SPATIAL DOMAIN OF CALCULATIONS?</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">rPointsForCalculation</span>  <span class="c1"># atom distances in mu m</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># how much original state is contained in this eigenvector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yState</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="n">dimension</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
        
        <span class="c1"># construct matrix for each distance</span>
        <span class="c1"># MAKING THE EIGENMATRIX AND FINDING EIGENVALUES AT DIFFERENT DISTANCES</span>
        <span class="k">print</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">matrix (dimension &quot;</span><span class="p">,</span><span class="n">dimension</span><span class="p">,</span><span class="s2">&quot;)</span><span class="se">\n</span><span class="s2">&quot;</span>
        
        
        <span class="c1"># MAKIG MATRIX WITHOUT ACCOUNTING FOR THE DISTANCE</span>

        <span class="n">matDiagonal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dimension</span><span class="p">,</span><span class="n">dimension</span><span class="p">))</span>
        <span class="c1"># dipole-dipole R3</span>
        <span class="n">matR3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dimension</span><span class="p">,</span><span class="n">dimension</span><span class="p">))</span>
        <span class="c1"># dipole-quadrupoe R4</span>
        <span class="n">matR4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dimension</span><span class="p">,</span><span class="n">dimension</span><span class="p">))</span>
        <span class="c1"># quadrupole-quadrupole R5</span>
        <span class="n">matR5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dimension</span><span class="p">,</span><span class="n">dimension</span><span class="p">))</span>
        
        <span class="c1"># solves problems with exactly degenerate states</span>
        <span class="n">degeneracyOffset</span> <span class="o">=</span> <span class="mf">0.000001</span>
                
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">)):</span>
            <span class="k">print</span> <span class="s2">&quot;state = &quot;</span><span class="p">,</span><span class="n">i</span>
            <span class="n">statePart1</span> <span class="o">=</span> <span class="n">singleAtomState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">statePart2</span> <span class="o">=</span> <span class="n">singleAtomState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">6</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">7</span><span class="p">])</span>
            <span class="c1"># rotate individual states</span>
            <span class="n">dMatrix</span> <span class="o">=</span> <span class="n">wignerDmatrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">phi</span><span class="p">,</span><span class="n">theta</span> <span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">statePart1</span> <span class="o">=</span> <span class="n">dMatrix</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">statePart1</span><span class="p">)</span>
            
            <span class="n">dMatrix</span> <span class="o">=</span> <span class="n">wignerDmatrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">6</span><span class="p">],</span> <span class="n">phi</span><span class="p">,</span><span class="n">theta</span> <span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">statePart2</span> <span class="o">=</span> <span class="n">dMatrix</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">statePart2</span><span class="p">)</span>
            <span class="n">stateCom</span> <span class="o">=</span> <span class="n">compositeState</span><span class="p">(</span><span class="n">statePart1</span><span class="p">,</span> <span class="n">statePart2</span><span class="p">)</span>
            
            <span class="n">matDiagonal</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radialMatrix</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">matrixElement</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="bp">self</span><span class="o">.</span><span class="n">matrixElement</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span><span class="o">+</span><span class="n">degeneracyOffset</span>
            <span class="n">degeneracyOffset</span> <span class="o">+=</span> <span class="mf">0.000001</span>
                
            
            <span class="n">j</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">j</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">)):</span>
                <span class="c1">#print &quot; &quot;,j</span>
                <span class="n">coupled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__isCoupled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>\
                                               <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">5</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">6</span><span class="p">],</span>\
                                               <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>\
                                               <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">5</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">6</span><span class="p">],</span>\
                                                <span class="n">energyDelta</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">coupled</span><span class="p">:</span>
                    <span class="c1">#print &quot;i &quot;,i,&quot; j &quot;,j</span>
                    <span class="c1"># calculate angular part</span>
                    <span class="n">statePart1</span> <span class="o">=</span> <span class="n">singleAtomState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
                    <span class="n">statePart2</span> <span class="o">=</span> <span class="n">singleAtomState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">6</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">7</span><span class="p">])</span>
                    <span class="c1"># rotate individual states</span>
                    <span class="n">dMatrix</span> <span class="o">=</span> <span class="n">wignerDmatrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">phi</span><span class="p">,</span><span class="n">theta</span> <span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">statePart1</span> <span class="o">=</span> <span class="n">dMatrix</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">statePart1</span><span class="p">)</span>
                    <span class="n">dMatrix</span> <span class="o">=</span> <span class="n">wignerDmatrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">6</span><span class="p">],</span> <span class="n">phi</span><span class="p">,</span><span class="n">theta</span> <span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">statePart2</span> <span class="o">=</span> <span class="n">dMatrix</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">statePart2</span><span class="p">)</span>
                    <span class="c1"># composite state of two atoms</span>
                    <span class="n">stateCom2</span> <span class="o">=</span> <span class="n">compositeState</span><span class="p">(</span><span class="n">statePart1</span><span class="p">,</span> <span class="n">statePart2</span><span class="p">)</span>
                    
                    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getAngularMatrix_M2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>\
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">5</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">6</span><span class="p">],</span>\
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>\
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">5</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">6</span><span class="p">],</span>\
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">)</span>
                    
                    <span class="n">angularFactor</span> <span class="o">=</span> <span class="n">conjugate</span><span class="p">(</span><span class="n">stateCom2</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">stateCom</span><span class="p">))</span>
                    <span class="n">angularFactor</span> <span class="o">=</span> <span class="n">real</span><span class="p">(</span><span class="n">angularFactor</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
                    
                    <span class="c1">#print &quot;af = &quot;,angularFactor</span>
                    <span class="c1">#print stateCom</span>
                    <span class="c1">#print stateCom2</span>
                    
                    <span class="k">if</span> <span class="n">coupled</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                        <span class="c1"># dipole-dipole coupling</span>
                        <span class="n">radialPart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radialMatrix</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">matrixElement</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="bp">self</span><span class="o">.</span><span class="n">matrixElement</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>
                        <span class="n">matR3</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">angularFactor</span><span class="o">*</span><span class="n">radialPart</span> 
                                  
                        <span class="n">radialPart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radialMatrix</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">matrixElement</span><span class="p">[</span><span class="n">j</span><span class="p">]][</span><span class="bp">self</span><span class="o">.</span><span class="n">matrixElement</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                        <span class="n">matR3</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">angularFactor</span><span class="o">*</span><span class="n">radialPart</span>
                        <span class="c1">#print matR3[i,j]</span>
                    <span class="k">elif</span> <span class="n">coupled</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                        <span class="c1">#print &quot;quadrupole -dipole &quot;,i,&quot; &quot;,j</span>
                        <span class="c1"># dipole-quadrupole coupling</span>
                        <span class="n">radialPart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radialMatrix</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">matrixElement</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="bp">self</span><span class="o">.</span><span class="n">matrixElement</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>
                        <span class="n">matR4</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">angularFactor</span><span class="o">*</span><span class="n">radialPart</span>
                                   
                        <span class="n">radialPart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radialMatrix</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">matrixElement</span><span class="p">[</span><span class="n">j</span><span class="p">]][</span><span class="bp">self</span><span class="o">.</span><span class="n">matrixElement</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                        <span class="n">matR4</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">angularFactor</span><span class="o">*</span><span class="n">radialPart</span>
                        <span class="c1">#print matR3[i,j]</span>
                    <span class="k">elif</span> <span class="n">coupled</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
                        <span class="c1"># quadrupole-quadrupole coupliung</span>
                        <span class="n">radialPart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radialMatrix</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">matrixElement</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="bp">self</span><span class="o">.</span><span class="n">matrixElement</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>
                        <span class="n">matR5</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">angularFactor</span><span class="o">*</span><span class="n">radialPart</span>
                                   
                        <span class="n">radialPart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radialMatrix</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">matrixElement</span><span class="p">[</span><span class="n">j</span><span class="p">]][</span><span class="bp">self</span><span class="o">.</span><span class="n">matrixElement</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                        <span class="n">matR5</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">angularFactor</span><span class="o">*</span><span class="n">radialPart</span>
                        <span class="c1">#print matR3[i,j]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">print</span> <span class="s2">&quot;error&quot;</span>
                        <span class="nb">exit</span><span class="p">()</span>
                        
                    
                <span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
        
        <span class="c1">#self.updateAngularMatrixElementsFile()</span>
        
        <span class="k">print</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Diagonal matrix START (energy offsets)&quot;</span>
        <span class="k">print</span> <span class="n">csr_matrix</span><span class="p">(</span><span class="n">matDiagonal</span><span class="p">)</span>
        <span class="k">print</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Diagonal matrix END (energy offsets)</span><span class="se">\n</span><span class="s2">&quot;</span> 
        
        <span class="k">print</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">R3 matrix&quot;</span>
        <span class="k">print</span> <span class="n">csr_matrix</span><span class="p">(</span><span class="n">matR3</span><span class="p">)</span>
        
        <span class="c1">#mat2 = lil_matrix(np.load(&quot;test_matrix.npy&quot;))</span>
        <span class="c1">#print mat2[0,3]</span>
        <span class="c1">#i =0</span>
        <span class="c1">#while i&lt;dimension:</span>
        <span class="c1">#    j=0</span>
        <span class="c1">#    while j&lt;dimension:</span>
        <span class="c1">#        if i!=j:</span>
        <span class="c1">#            if abs(mat2[i,j]-matR3[i,j]*1e18)&gt;0.0001:</span>
        <span class="c1">#                print i,&quot; &quot;,j</span>
        <span class="c1">#                print matR3[i,j]*1e18</span>
        <span class="c1">#                print mat2[i,j]</span>
        <span class="c1">#                </span>
        <span class="c1">#                print self.states[i]</span>
        <span class="c1">#                print self.states[j]</span>
        <span class="c1">#                    </span>
        <span class="c1">#                </span>
        <span class="c1">#        else:</span>
        <span class="c1">#            if abs(mat2[i,j]-matDiagonal[i,j])&gt;0.0001:</span>
        <span class="c1">#                print i,&quot; &quot;,j</span>
        <span class="c1">#                print mat2[i,j]</span>
        <span class="c1">#                print matDiagonal[i,j]</span>
        <span class="c1">#        j +=1</span>
        <span class="c1">#    i+=1</span>
        <span class="c1">#print &quot;COMPARISON OK&quot;</span>
        <span class="c1">#exit()</span>
        
        <span class="k">print</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">R4 matrix&quot;</span>
        <span class="k">print</span> <span class="n">csr_matrix</span><span class="p">(</span><span class="n">matR4</span><span class="p">)</span>
        <span class="c1">#matR4 = np.zeros((dimension,dimension))</span>
        
        <span class="k">print</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">R5 matrix&quot;</span>
        <span class="k">print</span> <span class="n">csr_matrix</span><span class="p">(</span><span class="n">matR5</span><span class="p">)</span>
        <span class="c1"># hack - swich off quadrupole-quadrupole interactions</span>
        <span class="c1">#matR5 = np.zeros((dimension,dimension))</span>
        
        <span class="c1"># save this to class instance variables, so that they can be retrieve at a later time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matDiagonal</span> <span class="o">=</span> <span class="n">matDiagonal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matR3</span> <span class="o">=</span> <span class="n">matR3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matR4</span> <span class="o">=</span> <span class="n">matR4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matR5</span> <span class="o">=</span> <span class="n">matR5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">originalPairStateIndex</span> <span class="o">=</span> <span class="n">opi</span>
        
        <span class="c1">#print mat</span>
        
        <span class="k">return</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="LevelDiagramInteractions.findEigenvectors"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelDiagramInteractions.findEigenvectors">[docs]</a>    <span class="k">def</span> <span class="nf">findEigenvectors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rangeR</span><span class="p">,</span><span class="n">noOfEigenvectors</span><span class="p">,</span><span class="n">drivingFromState</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">progresOutput</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">rangeR</span>
        <span class="n">dimension</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
                    
        <span class="n">coupling</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxCoupling</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">drivingFromState</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">print</span> <span class="s2">&quot;Finding coupling strengths&quot;</span>
            <span class="c1"># get first what was the state we are calculating coupling with</span>
            <span class="n">state1</span> <span class="o">=</span> <span class="n">drivingFromState</span>
            <span class="n">n1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">state1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">l1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">state1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">j1</span> <span class="o">=</span> <span class="n">state1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">m1</span> <span class="o">=</span> <span class="n">state1</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">drivingFromState</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            
            <span class="n">i</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">while</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">dimension</span><span class="p">:</span>
                <span class="n">thisCoupling</span> <span class="o">=</span> <span class="mf">0.</span>
                <span class="c1">#if progresOutput:</span>
                <span class="c1">#    sys.stdout.write(&quot;\r%d%%&quot; %  (i/float(dimension)*100.))</span>
                <span class="c1">#    sys.stdout.flush()</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">l1</span><span class="p">))</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> \
                   <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">originalPairStateIndex</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span><span class="o">&lt;</span><span class="mf">0.1</span> <span class="ow">and</span> \
                   <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">originalPairStateIndex</span><span class="p">][</span><span class="mi">5</span><span class="p">])</span><span class="o">&lt;</span><span class="mf">0.1</span> <span class="ow">and</span> \
                   <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">originalPairStateIndex</span><span class="p">][</span><span class="mi">6</span><span class="p">])</span><span class="o">&lt;</span><span class="mf">0.1</span> <span class="ow">and</span> \
                   <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">originalPairStateIndex</span><span class="p">][</span><span class="mi">7</span><span class="p">])</span><span class="o">&lt;</span><span class="mf">0.1</span> <span class="p">:</span>
                    <span class="n">state2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">n2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">state2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">l2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">state2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">j2</span> <span class="o">=</span> <span class="n">state2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">m2</span> <span class="o">=</span> <span class="n">state2</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                    <span class="k">print</span> <span class="n">n1</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">m1</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">m2</span><span class="p">,</span><span class="s2">&quot; q=&quot;</span><span class="p">,</span><span class="n">q</span>
                    <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">reducedDipoleME</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getReducedMatrixElement_JBasis_U</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">)</span> 
                    <span class="n">thisCoupling</span> <span class="o">+=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">j1</span><span class="o">-</span><span class="n">m1</span><span class="p">))</span><span class="o">*</span><span class="n">Wigner3j</span><span class="p">(</span><span class="n">j1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="o">-</span><span class="n">m1</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">m2</span><span class="p">)</span><span class="o">*</span><span class="n">reducedDipoleME</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span><span class="o">-</span><span class="n">l1</span><span class="p">))</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> \
                    <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">originalPairStateIndex</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">&lt;</span><span class="mf">0.1</span> <span class="ow">and</span>\
                    <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">originalPairStateIndex</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">&lt;</span><span class="mf">0.1</span> <span class="ow">and</span> \
                    <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">originalPairStateIndex</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span><span class="o">&lt;</span><span class="mf">0.1</span> <span class="ow">and</span> \
                    <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">originalPairStateIndex</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span><span class="o">&lt;</span><span class="mf">0.1</span> <span class="p">:</span>
                    <span class="n">state2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">n2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">state2</span><span class="p">[</span><span class="mi">0</span><span class="o">+</span><span class="mi">4</span><span class="p">])</span>
                    <span class="n">l2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">state2</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="mi">4</span><span class="p">])</span>
                    <span class="n">j2</span> <span class="o">=</span> <span class="n">state2</span><span class="p">[</span><span class="mi">2</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span>
                    <span class="n">m2</span> <span class="o">=</span> <span class="n">state2</span><span class="p">[</span><span class="mi">3</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span>
                    <span class="k">print</span> <span class="n">n1</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">m1</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">m2</span><span class="p">,</span><span class="s2">&quot; q=&quot;</span><span class="p">,</span><span class="n">q</span>
                    <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">reducedDipoleME</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getReducedMatrixElement_JBasis_U</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">)</span> 
                    <span class="n">thisCoupling</span> <span class="o">+=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">j1</span><span class="o">-</span><span class="n">m1</span><span class="p">))</span><span class="o">*</span><span class="n">Wigner3j</span><span class="p">(</span><span class="n">j1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="o">-</span><span class="n">m1</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">m2</span><span class="p">)</span><span class="o">*</span><span class="n">reducedDipoleME</span>
                
                <span class="k">if</span> <span class="n">thisCoupling</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxCoupling</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">maxCoupling</span> <span class="o">=</span> <span class="n">thisCoupling</span>
                <span class="k">if</span> <span class="n">thisCoupling</span> <span class="o">&gt;</span><span class="mf">0.000001</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s2">&quot;original pairstate index = &quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">originalPairStateIndex</span> 
                    <span class="k">print</span> <span class="s2">&quot;this pairstate index = &quot;</span><span class="p">,</span><span class="n">i</span>
                    <span class="k">print</span> <span class="s2">&quot;state itself &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">print</span> <span class="s2">&quot;coupling = &quot;</span><span class="p">,</span><span class="n">thisCoupling</span>
                    
                <span class="n">coupling</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisCoupling</span><span class="p">)</span>
                <span class="c1">#print &quot;c = &quot;,thisCoupling</span>
                <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">updateDipoleMatrixElementsFile</span><span class="p">()</span>
            <span class="k">print</span> <span class="s2">&quot;Coupling strengths calculated for each pair-state&quot;</span>
        
        <span class="k">print</span> <span class="n">coupling</span>   

        <span class="n">rvalIndex</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">for</span> <span class="n">rval</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">progresOutput</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="si">%d%%</span><span class="s2">&quot;</span> <span class="o">%</span>  <span class="p">(</span><span class="n">rvalIndex</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="mf">100.</span><span class="p">))</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">rvalIndex</span> <span class="o">+=</span> <span class="mf">1.</span>
            
            <span class="c1"># calculate interaction matrix</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dimension</span><span class="p">,</span><span class="n">dimension</span><span class="p">))</span>

            
            <span class="n">r3</span> <span class="o">=</span> <span class="p">(</span><span class="n">rval</span><span class="o">*</span><span class="mf">1.e-6</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span>
            <span class="n">r4</span> <span class="o">=</span> <span class="p">(</span><span class="n">rval</span><span class="o">*</span><span class="mf">1.e-6</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span>
            <span class="n">r5</span> <span class="o">=</span> <span class="p">(</span><span class="n">rval</span><span class="o">*</span><span class="mf">1.e-6</span><span class="p">)</span><span class="o">**</span><span class="mi">5</span>
            
            <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matDiagonal</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">matR3</span><span class="o">/</span><span class="n">r3</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">matR4</span><span class="o">/</span><span class="n">r4</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">matR5</span><span class="o">/</span><span class="n">r5</span>
            <span class="c1">#print m</span>
            <span class="n">m</span><span class="o">=</span> <span class="n">csr_matrix</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="c1">#print m</span>
        
            <span class="n">dim</span><span class="o">=</span><span class="mi">0</span>
        
            <span class="c1">#m = m.tocsr() # converte sparce matrix to comma separated rows format</span>
            <span class="c1"># uses ARPACK algorithm to find only X eigenvectors</span>
            <span class="n">ev</span><span class="p">,</span> <span class="n">egvector</span> <span class="o">=</span> <span class="n">eigsh</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">noOfEigenvectors</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;LM&#39;</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span><span class="mf">1E-6</span><span class="p">)</span>
        
            <span class="k">if</span> <span class="p">(</span><span class="n">drivingFromState</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">):</span>
                <span class="k">while</span> <span class="n">dim</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">ev</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">dim</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">ev</span><span class="p">[</span><span class="n">dim</span><span class="p">]])</span>
                        <span class="c1">#sumCoupledStates = 0</span>
                        <span class="c1">#i=0</span>
                        <span class="c1">#while i &lt;dimension:</span>
                        <span class="c1">#    if (self.states[i][1]==self.states[self.originalPairStateIndex][1]):</span>
                        <span class="c1">#        sumCoupledStates += egvector[i,dim]**2</span>
                        <span class="c1">#    i += 1</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">yState</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">egvector</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">originalPairStateIndex</span><span class="p">,</span><span class="n">dim</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">])</span>
                        <span class="c1">#self.yState.append([sumCoupledStates])  </span>
                    <span class="k">else</span><span class="p">:</span>    
                        <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ev</span><span class="p">[</span><span class="n">dim</span><span class="p">])</span>
                        <span class="c1">#sumCoupledStates = 0</span>
                        <span class="c1">#i=0</span>
                        <span class="c1">#while i&lt;dimension:</span>
                        <span class="c1">#    if (self.states[i][1]==self.states[self.originalPairStateIndex][1]):</span>
                        <span class="c1">#        sumCoupledStates += egvector[i,dim]**2</span>
                        <span class="c1">#    i += 1</span>
                        <span class="c1">#self.yState[dim].append(sumCoupledStates)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">yState</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">egvector</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">originalPairStateIndex</span><span class="p">,</span><span class="n">dim</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                        
                    <span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="s2">&quot;s&quot;</span>
                <span class="k">while</span> <span class="n">dim</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">ev</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">dim</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">ev</span><span class="p">[</span><span class="n">dim</span><span class="p">]])</span>
                        <span class="n">sumCoupledStates</span> <span class="o">=</span> <span class="mf">0.</span>
                        <span class="n">i</span><span class="o">=</span><span class="mi">0</span>
                        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span><span class="n">dimension</span><span class="p">:</span>
                            <span class="n">sumCoupledStates</span> <span class="o">+=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">coupling</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">maxCoupling</span><span class="p">)</span><span class="o">*</span><span class="n">egvector</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">dim</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
                            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">yState</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">sumCoupledStates</span><span class="p">])</span>  
                        <span class="c1">#if sumCoupledStates&gt;0.00001:</span>
                        <span class="c1">#    print sumCoupledStates</span>
                    <span class="k">else</span><span class="p">:</span>    
                        <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ev</span><span class="p">[</span><span class="n">dim</span><span class="p">])</span>
                        <span class="n">sumCoupledStates</span> <span class="o">=</span> <span class="mf">0.</span>
                        <span class="n">i</span><span class="o">=</span><span class="mi">0</span>
                        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span><span class="n">dimension</span><span class="p">:</span>
                            <span class="n">sumCoupledStates</span> <span class="o">+=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">coupling</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">maxCoupling</span><span class="p">)</span> <span class="o">*</span><span class="n">egvector</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">dim</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
                            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">yState</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sumCoupledStates</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">sumCoupledStates</span><span class="o">&gt;</span><span class="mf">0.00001</span><span class="p">:</span>
                            <span class="k">print</span> <span class="n">sumCoupledStates</span>
                    <span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span> <span class="o">+</span> <span class="mi">1</span></div>
                    
        <span class="c1"># end of FOR loop over inter-atomic dinstaces        </span>

<div class="viewcode-block" id="LevelDiagramInteractions.saveMatrixCalculation"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelDiagramInteractions.saveMatrixCalculation">[docs]</a>    <span class="k">def</span> <span class="nf">saveMatrixCalculation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rootFileName</span><span class="o">=</span><span class="s2">&quot;savedCalculation&quot;</span><span class="p">):</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">rootFileName</span><span class="o">+</span><span class="s2">&quot;_states&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">rootFileName</span><span class="o">+</span><span class="s2">&quot;_matDiagonal&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">matDiagonal</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">rootFileName</span><span class="o">+</span><span class="s2">&quot;_matR3&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">matR3</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">rootFileName</span><span class="o">+</span><span class="s2">&quot;_matR4&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">matR4</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">rootFileName</span><span class="o">+</span><span class="s2">&quot;_matR5&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">matR5</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">rootFileName</span><span class="o">+</span><span class="s2">&quot;_originalPairStateIndex&quot;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">originalPairStateIndex</span><span class="p">]))</span></div>
        
<div class="viewcode-block" id="LevelDiagramInteractions.loadMatrixCalculation"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelDiagramInteractions.loadMatrixCalculation">[docs]</a>    <span class="k">def</span> <span class="nf">loadMatrixCalculation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rootFileName</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">rootFileName</span><span class="o">+</span><span class="s2">&quot;_states.npy&quot;</span><span class="p">)</span>
        <span class="k">print</span> <span class="s2">&quot;Loaded no of states = &quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matDiagonal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">rootFileName</span><span class="o">+</span><span class="s2">&quot;_matDiagonal.npy&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matR3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">rootFileName</span><span class="o">+</span><span class="s2">&quot;_matR3.npy&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matR4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">rootFileName</span><span class="o">+</span><span class="s2">&quot;_matR4.npy&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matR5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">rootFileName</span><span class="o">+</span><span class="s2">&quot;_matR5.npy&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">originalPairStateIndex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">rootFileName</span><span class="o">+</span><span class="s2">&quot;_originalPairStateIndex.npy&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="LevelDiagramInteractions.plotLevelDiagrams"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelDiagramInteractions.plotLevelDiagrams">[docs]</a>    <span class="k">def</span> <span class="nf">plotLevelDiagrams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LinearSegmentedColormap</span>
        
        <span class="c1">#c = colors.ColorConverter().to_rgb</span>
        <span class="n">rvb</span> <span class="o">=</span> <span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s1">&#39;mymap&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;0.9&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">])</span><span class="c1">#make_colormap([0.9,c(&#39;red&#39;)])</span>
        
        
        <span class="k">print</span> <span class="s2">&quot; Now we are plotting...&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">9.0</span><span class="p">,</span> <span class="mf">11.5</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yState</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yState</span><span class="p">)</span>
        
        
        <span class="n">colorfulX</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">colorfulY</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">colorfulState</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">grayX</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">grayY</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="n">br</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">br</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">):</span>
            <span class="k">print</span> <span class="n">br</span>
            <span class="n">i</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">while</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">br</span><span class="p">]):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">yState</span><span class="p">[</span><span class="n">br</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.01</span><span class="p">:</span>
                    <span class="n">colorfulX</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">colorfulY</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">br</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">colorfulState</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yState</span><span class="p">[</span><span class="n">br</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                    <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">yState</span><span class="p">[</span><span class="n">br</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">grayX</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">grayY</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">br</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1">##semilogx(x,y[br],&quot;.&quot;,color=ystate[br])</span>
            <span class="c1">#loglog(x,abs(y[br]),&quot;b.&quot;)</span>
            <span class="n">br</span> <span class="o">=</span> <span class="n">br</span><span class="o">+</span><span class="mi">1</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">grayX</span><span class="p">,</span><span class="n">grayY</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;0.9&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">colorfulX</span><span class="p">,</span><span class="n">colorfulY</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">colorfulState</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">rvb</span><span class="p">)</span><span class="c1">#mpl.cm.Blues)</span>
            
        
        <span class="n">br</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">br</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">br2</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">sumStates</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">while</span> <span class="n">br2</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">):</span>
                <span class="n">sumStates</span> <span class="o">=</span> <span class="n">sumStates</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">yState</span><span class="p">[</span><span class="n">br2</span><span class="p">][</span><span class="n">br</span><span class="p">]</span>
                <span class="n">br2</span> <span class="o">=</span> <span class="n">br2</span><span class="o">+</span><span class="mi">1</span>
            <span class="c1">#print &quot;sumStates = &quot;, sumStates,&quot; at &quot;,x[br]</span>
            <span class="n">br</span> <span class="o">=</span> <span class="n">br</span><span class="o">+</span><span class="mi">1</span>
        
        <span class="c1">#ylim(-6.1,6.1)</span>
        <span class="c1">#xlim(1,10)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">r&quot;R ($\mu$m)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">r&quot;$\Delta E$ (GHz)&quot;</span><span class="p">)</span></div>
        <span class="c1">#self.ax.set_xscale(&quot;log&quot;, nonposy=&#39;clip&#39;)</span>
        <span class="c1">#yscale(&quot;log&quot;, nonposy=&#39;clip&#39;)</span>
    
<div class="viewcode-block" id="LevelDiagramInteractions.showLevelDiagrams"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelDiagramInteractions.showLevelDiagrams">[docs]</a>    <span class="k">def</span> <span class="nf">showLevelDiagrams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="LevelDiagramInteractions.getC6fromLevelDiagram"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelDiagramInteractions.getC6fromLevelDiagram">[docs]</a>    <span class="k">def</span> <span class="nf">getC6fromLevelDiagram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fromRIndex</span><span class="p">,</span><span class="n">toRIndex</span><span class="p">,</span><span class="n">showPlot</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="n">initialStateDetuning</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">initialStateDetuningX</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">detuningFrom</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>
        <span class="n">detuningTo</span> <span class="o">=</span> <span class="mf">3.</span>
        <span class="n">br</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">br</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">br2</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">br2</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yState</span><span class="p">[</span><span class="n">br2</span><span class="p">][</span><span class="n">br</span><span class="p">])</span><span class="o">&gt;</span><span class="mf">0.5</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">br2</span><span class="p">][</span><span class="n">br</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">detuningTo</span><span class="p">)</span><span class="ow">and</span> <span class="p">(</span><span class="n">detuningFrom</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">br2</span><span class="p">][</span><span class="n">br</span><span class="p">]):</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="o">+</span><span class="mi">1</span>
                    <span class="n">initialStateDetuning</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">br2</span><span class="p">][</span><span class="n">br</span><span class="p">]))</span>
                    <span class="n">initialStateDetuningX</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">br</span><span class="p">])</span>
                <span class="n">br2</span> <span class="o">=</span> <span class="n">br2</span><span class="o">+</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">index</span><span class="o">&gt;</span><span class="mf">1.</span><span class="p">:</span>
                <span class="k">print</span> <span class="s2">&quot;Error: &quot;</span><span class="p">,</span><span class="n">index</span><span class="p">,</span><span class="s2">&quot; points indentified as initial state at&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">br</span><span class="p">],</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">br</span>
                <span class="nb">exit</span><span class="p">()</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">index</span> <span class="o">&lt;</span><span class="mi">0</span><span class="p">):</span>
                <span class="k">print</span> <span class="s2">&quot;Error: no points indentified as inital state!&quot;</span>
                <span class="nb">exit</span><span class="p">()</span>
            <span class="n">br</span> <span class="o">=</span> <span class="n">br</span><span class="o">+</span><span class="mi">1</span>
        
        
        
        <span class="n">initialStateDetuning</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">initialStateDetuning</span><span class="p">)</span><span class="c1">##*1e9</span>
        <span class="n">initialStateDetuningX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">initialStateDetuningX</span><span class="p">)</span>
        
        <span class="k">def</span> <span class="nf">c6fit</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">c6</span><span class="p">,</span><span class="n">offset</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">c6</span><span class="o">/</span><span class="n">r</span><span class="o">**</span><span class="mi">6</span><span class="o">+</span><span class="n">offset</span>
        
        <span class="k">def</span> <span class="nf">c3fit</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">c3</span><span class="p">,</span><span class="n">offset</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">c3</span><span class="o">/</span><span class="n">r</span><span class="o">**</span><span class="mi">3</span><span class="o">+</span><span class="n">offset</span>
        
        <span class="n">startFitIndex</span> <span class="o">=</span> <span class="mi">30</span> 
        <span class="n">stopFitIndex</span> <span class="o">=</span> <span class="mi">70</span>
        <span class="n">popt</span><span class="p">,</span><span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">c6fit</span><span class="p">,</span><span class="n">initialStateDetuningX</span><span class="p">[</span><span class="n">startFitIndex</span><span class="p">:</span><span class="n">stopFitIndex</span><span class="p">],</span><span class="n">initialStateDetuning</span><span class="p">[</span><span class="n">startFitIndex</span><span class="p">:</span><span class="n">stopFitIndex</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">print</span> <span class="s2">&quot;c6 = &quot;</span><span class="p">,</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s2">&quot; GHz /R^6 (mu m)^6&quot;</span>
        <span class="k">print</span> <span class="s2">&quot;offset = &quot;</span><span class="p">,</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="n">y_fit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">y_theory</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">initialStateDetuningX</span><span class="p">[</span><span class="n">startFitIndex</span><span class="p">:</span><span class="n">stopFitIndex</span><span class="p">]:</span>
            <span class="n">y_fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c6fit</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="c1">#y_theory.append(theoryFun(val))</span>
        
        <span class="k">if</span> <span class="n">showPlot</span><span class="p">:</span>
            <span class="n">loglog</span><span class="p">(</span><span class="n">initialStateDetuningX</span><span class="p">,</span><span class="n">initialStateDetuning</span><span class="p">,</span><span class="s2">&quot;b-&quot;</span><span class="p">)</span>
            <span class="n">loglog</span><span class="p">(</span><span class="n">initialStateDetuningX</span><span class="p">[</span><span class="n">startFitIndex</span><span class="p">:</span><span class="n">stopFitIndex</span><span class="p">],</span><span class="n">y_fit</span><span class="p">,</span><span class="s2">&quot;r--&quot;</span><span class="p">)</span>
            <span class="c1">#loglog(initialStateDetuningX[150:250],y_theory,&quot;k:&quot;)</span>
            <span class="c1">#xlim(0.9,10)</span>
            <span class="c1">#ylim(1e2,1e12)</span>
            <span class="n">grid</span><span class="p">()</span>
            <span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;0.5&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            
            <span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>
    
<div class="viewcode-block" id="LevelDiagramInteractions.getC3fromLevelDiagram"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelDiagramInteractions.getC3fromLevelDiagram">[docs]</a>    <span class="k">def</span> <span class="nf">getC3fromLevelDiagram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fromRIndex</span><span class="p">,</span><span class="n">toRIndex</span><span class="p">,</span><span class="n">showPlot</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="n">initialStateDetuning</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">initialStateDetuningX</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">detuningFrom</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">detuningTo</span> <span class="o">=</span> <span class="mf">3.</span>
        <span class="n">br</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">br</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">br2</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">br2</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yState</span><span class="p">[</span><span class="n">br2</span><span class="p">][</span><span class="n">br</span><span class="p">])</span><span class="o">&gt;</span><span class="mf">0.1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">br2</span><span class="p">][</span><span class="n">br</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">detuningTo</span><span class="p">)</span><span class="ow">and</span> <span class="p">(</span><span class="n">detuningFrom</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">br2</span><span class="p">][</span><span class="n">br</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">index</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="n">index</span><span class="o">!=</span><span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">br2</span><span class="p">][</span><span class="n">br</span><span class="p">]</span><span class="o">&gt;</span><span class="n">initialStateDetuning</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])):</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="o">+</span><span class="mi">1</span>
                    <span class="k">if</span> <span class="n">index</span> <span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">initialStateDetuning</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">br2</span><span class="p">][</span><span class="n">br</span><span class="p">]))</span>
                        <span class="n">initialStateDetuningX</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">br</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">initialStateDetuning</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">br2</span><span class="p">][</span><span class="n">br</span><span class="p">]))</span>
                        <span class="n">initialStateDetuningX</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">br</span><span class="p">])</span>
                <span class="n">br2</span> <span class="o">=</span> <span class="n">br2</span><span class="o">+</span><span class="mi">1</span>
            <span class="c1">#    print &quot;Error: &quot;,index,&quot; points indentified as initial state at&quot;,self.x[br],&quot; &quot;,br</span>
            <span class="c1">#if index&gt;1.:</span>
            <span class="c1">#    exit()</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">==</span><span class="mi">0</span><span class="p">):</span>
                <span class="k">print</span> <span class="s2">&quot;Error: no points indentified as inital state!&quot;</span>
                <span class="nb">exit</span><span class="p">()</span>
            <span class="n">br</span> <span class="o">=</span> <span class="n">br</span><span class="o">+</span><span class="mi">1</span>
        
        
        
        <span class="n">initialStateDetuning</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">initialStateDetuning</span><span class="p">)</span><span class="c1">##*1e9</span>
        <span class="n">initialStateDetuningX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">initialStateDetuningX</span><span class="p">)</span>
        
        <span class="k">def</span> <span class="nf">c6fit</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">c6</span><span class="p">,</span><span class="n">offset</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">c6</span><span class="o">/</span><span class="n">r</span><span class="o">**</span><span class="mi">6</span><span class="o">+</span><span class="n">offset</span>
        
        <span class="k">def</span> <span class="nf">c3fit</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">c3</span><span class="p">,</span><span class="n">offset</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">c3</span><span class="o">/</span><span class="n">r</span><span class="o">**</span><span class="mi">3</span><span class="o">+</span><span class="n">offset</span>
        
        <span class="k">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">initialStateDetuningX</span><span class="p">)</span>
        <span class="n">startFitIndex</span> <span class="o">=</span> <span class="mi">30</span> 
        <span class="n">stopFitIndex</span> <span class="o">=</span> <span class="mi">70</span>
        <span class="n">popt</span><span class="p">,</span><span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">c3fit</span><span class="p">,</span><span class="n">initialStateDetuningX</span><span class="p">[</span><span class="n">startFitIndex</span><span class="p">:</span><span class="n">stopFitIndex</span><span class="p">],</span><span class="n">initialStateDetuning</span><span class="p">[</span><span class="n">startFitIndex</span><span class="p">:</span><span class="n">stopFitIndex</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">print</span> <span class="s2">&quot;c3 = &quot;</span><span class="p">,</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s2">&quot; GHz /R^3 (mu m)^3&quot;</span>
        <span class="k">print</span> <span class="s2">&quot;offset = &quot;</span><span class="p">,</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="n">y_fit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">y_theory</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">initialStateDetuningX</span><span class="p">[</span><span class="n">startFitIndex</span><span class="p">:</span><span class="n">stopFitIndex</span><span class="p">]:</span>
            <span class="n">y_fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c3fit</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="c1">#y_theory.append(theoryFun(val))</span>
        
        <span class="k">if</span> <span class="n">showPlot</span><span class="p">:</span>
            <span class="n">loglog</span><span class="p">(</span><span class="n">initialStateDetuningX</span><span class="p">,</span><span class="n">initialStateDetuning</span><span class="p">,</span><span class="s2">&quot;b-&quot;</span><span class="p">)</span>
            <span class="n">loglog</span><span class="p">(</span><span class="n">initialStateDetuningX</span><span class="p">[</span><span class="n">startFitIndex</span><span class="p">:</span><span class="n">stopFitIndex</span><span class="p">],</span><span class="n">y_fit</span><span class="p">,</span><span class="s2">&quot;r--&quot;</span><span class="p">)</span>
            <span class="c1">#loglog(initialStateDetuningX[150:250],y_theory,&quot;k:&quot;)</span>
            <span class="c1">#xlim(0.9,10)</span>
            <span class="c1">#ylim(1e2,1e12)</span>
            <span class="n">grid</span><span class="p">()</span>
            <span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;0.5&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            
            <span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div></div>
    
<div class="viewcode-block" id="LevelDiagramStarkShifts"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelDiagramStarkShifts">[docs]</a><span class="k">class</span> <span class="nc">LevelDiagramStarkShifts</span><span class="p">:</span>
    <span class="n">atom</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="n">basisStates</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mat1</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mat2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">indexOfCoupledState</span> <span class="o">=</span> <span class="p">[]</span>
    
    
    <span class="c1"># finding energy levels</span>
    <span class="n">eFieldList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># eigenValues</span>
    <span class="n">yState</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#contribution of initial state there</span>
    
    <span class="c1"># pointers towards figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">atom</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="n">atom</span>
    
<div class="viewcode-block" id="LevelDiagramStarkShifts.eFieldCouplingDivE"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelDiagramStarkShifts.eFieldCouplingDivE">[docs]</a>    <span class="k">def</span> <span class="nf">eFieldCouplingDivE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">mj1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">mj2</span><span class="p">):</span>
        <span class="c1"># eFied coupling devided with E (witout actuall multiplication to getE)</span>
        <span class="c1"># delta(mj1,mj2&#39;) delta(l1,l2+-1)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">mj1</span><span class="o">-</span><span class="n">mj2</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">l1</span><span class="o">-</span><span class="n">l2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.1</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">l1</span><span class="o">-</span><span class="n">l2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.1</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>
        
        <span class="c1"># matrix element</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getDipoleMatrixElement</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">)</span><span class="o">*</span> <span class="n">physical_constants</span><span class="p">[</span><span class="s2">&quot;Bohr radius&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">elemCharge</span>
        <span class="c1">#print &quot;matrix element = &quot;,result</span>
        <span class="c1"># calulates sum (See PRA 20:2251 (1979), eq.(10))</span>
        <span class="n">sumPart</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">ml</span> <span class="o">=</span> <span class="n">mj1</span> <span class="o">+</span> <span class="mf">0.5</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ml</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="o">&lt;</span><span class="n">l1</span><span class="p">)</span><span class="ow">and</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ml</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="o">&lt;</span><span class="n">l2</span><span class="p">):</span>
            <span class="c1">#print l1,&quot; &quot;,ml,&quot; &quot;,0.5,&quot; &quot;,mj1-ml,&quot; &quot;,j1,&quot; &quot;,mj1</span>
            <span class="c1">#print l2,&quot; &quot;,ml,&quot; &quot;,0.5,&quot; &quot;,mj1-ml,&quot; &quot;,j2,&quot; &quot;,mj2</span>
            <span class="n">angularPart</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">l1</span><span class="o">-</span><span class="n">l2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span><span class="p">):</span>
                <span class="n">angularPart</span> <span class="o">=</span> <span class="p">((</span><span class="n">l1</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">ml</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="mf">2.</span><span class="o">*</span><span class="n">l1</span><span class="o">+</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">l1</span><span class="o">-</span><span class="mf">1.</span><span class="p">)))</span><span class="o">**</span><span class="mf">0.5</span>
            <span class="k">elif</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">l1</span><span class="o">-</span><span class="n">l2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span><span class="p">):</span>
                <span class="n">angularPart</span> <span class="o">=</span> <span class="p">((</span><span class="n">l2</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">ml</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="mf">2.</span><span class="o">*</span><span class="n">l2</span><span class="o">+</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">l2</span><span class="o">-</span><span class="mf">1.</span><span class="p">)))</span><span class="o">**</span><span class="mf">0.5</span>
            <span class="c1">#print &quot;angular part = &quot;,angularPart</span>
            <span class="n">sumPart</span> <span class="o">+=</span> <span class="n">CG</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span><span class="n">ml</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">mj1</span><span class="o">-</span><span class="n">ml</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">mj1</span><span class="p">)</span><span class="o">*</span><span class="n">CG</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span><span class="n">ml</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">mj1</span><span class="o">-</span><span class="n">ml</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">mj2</span><span class="p">)</span><span class="o">*</span><span class="n">angularPart</span>
        <span class="c1">#print &quot;sumPart 1 = &quot;,sumPart</span>
        
        <span class="n">ml</span> <span class="o">=</span> <span class="n">mj1</span> <span class="o">-</span> <span class="mf">0.5</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ml</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="o">&lt;</span><span class="n">l1</span><span class="p">)</span><span class="ow">and</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ml</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="o">&lt;</span><span class="n">l2</span><span class="p">):</span>
            <span class="c1">#print l2,&quot; &quot;,ml,&quot; &quot;,0.5,&quot; &quot;,mj1-ml,&quot; &quot;,j2,&quot; &quot;,mj2</span>
            <span class="c1">#print l1,&quot; &quot;,ml,&quot; &quot;,0.5,&quot; &quot;,mj1-ml,&quot; &quot;,j1,&quot; &quot;,mj1</span>
            <span class="n">angularPart</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">l1</span><span class="o">-</span><span class="n">l2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span><span class="p">):</span>
                <span class="n">angularPart</span> <span class="o">=</span> <span class="p">((</span><span class="n">l1</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">ml</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="mf">2.</span><span class="o">*</span><span class="n">l1</span><span class="o">+</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">l1</span><span class="o">-</span><span class="mf">1.</span><span class="p">)))</span><span class="o">**</span><span class="mf">0.5</span>
            <span class="k">elif</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">l1</span><span class="o">-</span><span class="n">l2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span><span class="p">):</span>
                <span class="n">angularPart</span> <span class="o">=</span> <span class="p">((</span><span class="n">l2</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">ml</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="mf">2.</span><span class="o">*</span><span class="n">l2</span><span class="o">+</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">l2</span><span class="o">-</span><span class="mf">1.</span><span class="p">)))</span><span class="o">**</span><span class="mf">0.5</span>
            <span class="c1">#print &quot;angular part = &quot;,angularPart</span>
            <span class="n">sumPart</span> <span class="o">+=</span> <span class="n">CG</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span><span class="n">ml</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">mj1</span><span class="o">-</span><span class="n">ml</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">mj1</span><span class="p">)</span><span class="o">*</span><span class="n">CG</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span><span class="n">ml</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">mj1</span><span class="o">-</span><span class="n">ml</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">mj2</span><span class="p">)</span><span class="o">*</span><span class="n">angularPart</span>
        <span class="c1">#print &quot;sumPart 1+2 = &quot;,sumPart</span>
        
        <span class="k">return</span> <span class="n">result</span><span class="o">*</span><span class="n">sumPart</span></div>
    
<div class="viewcode-block" id="LevelDiagramStarkShifts.eFieldCoupling"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelDiagramStarkShifts.eFieldCoupling">[docs]</a>    <span class="k">def</span> <span class="nf">eFieldCoupling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">mj1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">mj2</span><span class="p">,</span><span class="n">eField</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">eFieldCouplingDivE</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">mj1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">mj2</span><span class="p">)</span><span class="o">*</span><span class="n">eField</span></div>
    
    
<div class="viewcode-block" id="LevelDiagramStarkShifts.defineBasis"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelDiagramStarkShifts.defineBasis">[docs]</a>    <span class="k">def</span> <span class="nf">defineBasis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">mj</span><span class="p">,</span><span class="n">nMin</span><span class="p">,</span><span class="n">nMax</span><span class="p">,</span><span class="n">maxL</span><span class="p">,</span><span class="n">progressOutput</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span><span class="n">debugOutput</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">states</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="n">tn</span> <span class="o">=</span> <span class="n">nMin</span>
        <span class="k">while</span> <span class="n">tn</span><span class="o">&lt;</span><span class="n">nMax</span><span class="p">:</span>
            <span class="n">tl</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">tl</span><span class="o">&lt;=</span> <span class="nb">min</span><span class="p">(</span><span class="n">maxL</span><span class="p">,</span><span class="n">tn</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">mj</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="o">&lt;=</span><span class="nb">float</span><span class="p">(</span><span class="n">tl</span><span class="p">)</span><span class="o">+</span><span class="mf">0.5</span><span class="p">):</span> 
                    <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">tn</span><span class="p">,</span><span class="n">tl</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">tl</span><span class="p">)</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span><span class="n">mj</span><span class="p">])</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">tl</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="ow">and</span>  <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">mj</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="o">&lt;=</span><span class="nb">float</span><span class="p">(</span><span class="n">tl</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span><span class="p">):</span>
                    <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">tn</span><span class="p">,</span><span class="n">tl</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">tl</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="n">mj</span><span class="p">])</span>
                <span class="n">tl</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">tn</span> <span class="o">+=</span><span class="mi">1</span>
        <span class="n">dimension</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">states</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">progressOutput</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Found &quot;</span><span class="p">,</span><span class="n">dimension</span><span class="p">,</span><span class="s2">&quot; states.&quot;</span> 
            <span class="k">if</span> <span class="n">debugOutput</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">states</span>
        
        <span class="n">indexOfCoupledState</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">states</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">n</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">j</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">mj</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span><span class="p">):</span>
                <span class="n">indexOfCoupledState</span> <span class="o">=</span> <span class="n">index</span>
            <span class="n">index</span> <span class="o">+=</span><span class="mi">1</span> 
        <span class="k">if</span> <span class="n">debugOutput</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Index of initial state&quot;</span>
            <span class="k">print</span> <span class="n">indexOfCoupledState</span>
            <span class="k">print</span> <span class="s2">&quot;Initial state = &quot;</span>
            <span class="k">print</span> <span class="n">states</span><span class="p">[</span><span class="n">indexOfCoupledState</span><span class="p">]</span>
        
        
        <span class="n">mat1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dimension</span><span class="p">,</span><span class="n">dimension</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
        <span class="n">mat2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dimension</span><span class="p">,</span><span class="n">dimension</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
        <span class="n">ii</span><span class="o">=</span><span class="mi">0</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">basisStates</span> <span class="o">=</span> <span class="n">states</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indexOfCoupledState</span> <span class="o">=</span> <span class="n">indexOfCoupledState</span>
        
        <span class="k">if</span> <span class="n">progressOutput</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Generating matrix...&quot;</span>
        <span class="n">progress</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">while</span> <span class="n">ii</span><span class="o">&lt;</span><span class="n">dimension</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">progressOutput</span><span class="p">:</span>
                <span class="n">progress</span> <span class="o">+=</span> <span class="p">((</span><span class="n">dimension</span><span class="o">-</span><span class="n">ii</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="si">%d%%</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">progress</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">dimension</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="c1">#print &quot;%.2f &quot; % (float(ii)/float(dimension))</span>
            <span class="c1"># add diagonal element</span>
            <span class="n">mat1</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">states</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="n">elemCharge</span><span class="o">/</span><span class="n">h</span><span class="o">*</span><span class="mf">1e-9</span>
            <span class="c1"># add off-diagonal element</span>
            <span class="n">jj</span><span class="o">=</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span>
            <span class="k">while</span> <span class="n">jj</span><span class="o">&lt;</span><span class="n">dimension</span><span class="p">:</span>
                <span class="c1">#print &quot;coupling &quot;,ii,&quot; &quot;,jj</span>
                <span class="n">coupling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eFieldCouplingDivE</span><span class="p">(</span><span class="n">states</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="n">mj</span><span class="p">,</span><span class="n">states</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="n">mj</span><span class="p">)</span><span class="o">*</span><span class="mf">1.e-9</span><span class="o">/</span><span class="n">h</span>
                <span class="n">mat2</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">coupling</span>
                <span class="n">mat2</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">coupling</span>
                <span class="n">jj</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">ii</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">updateDipoleMatrixElementsFile</span><span class="p">()</span>    
        
        <span class="k">if</span> <span class="n">progressOutput</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">debugOutput</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">mat1</span><span class="o">+</span><span class="n">mat2</span>
            <span class="k">print</span> <span class="n">mat2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">mat1</span> <span class="o">=</span> <span class="n">mat1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat2</span> <span class="o">=</span> <span class="n">mat2</span>
        <span class="k">return</span> <span class="mi">0</span></div>
    
<div class="viewcode-block" id="LevelDiagramStarkShifts.findStates_diagonalizeMatrix"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelDiagramStarkShifts.findStates_diagonalizeMatrix">[docs]</a>    <span class="k">def</span> <span class="nf">findStates_diagonalizeMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">eFieldList</span><span class="p">,</span><span class="n">progressOutput</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">debugOutput</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">mat1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat1</span>
        <span class="n">mat2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat2</span>
        <span class="n">indexOfCoupledState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexOfCoupledState</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eFieldList</span> <span class="o">=</span> <span class="n">eFieldList</span>
        <span class="c1">#eFieldList = np.linspace(00.,maxfield,600) # rangle in V/m</span>
        <span class="n">y</span> <span class="o">=</span><span class="p">[]</span>
        <span class="n">yState</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="n">progressOutput</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Finding eigenvectors...&quot;</span>
        <span class="n">progress</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">for</span> <span class="n">eField</span> <span class="ow">in</span> <span class="n">eFieldList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">progressOutput</span><span class="p">:</span>
                <span class="n">progress</span> <span class="o">+=</span> <span class="mf">1.</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="si">%d%%</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">progress</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">eFieldList</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            
            <span class="n">m</span> <span class="o">=</span> <span class="n">mat1</span><span class="o">+</span><span class="n">mat2</span><span class="o">*</span><span class="n">eField</span>
            <span class="c1">#ev, egvector = eigsh(mat, 10, sigma=0, which=&#39;LM&#39;,tol=1E-6) </span>
            <span class="n">ev</span><span class="p">,</span><span class="n">egvector</span> <span class="o">=</span> <span class="n">eigh</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            
            <span class="n">dim</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">dim</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">ev</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">dim</span><span class="p">:</span>
                    <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">ev</span><span class="p">[</span><span class="n">dim</span><span class="p">]])</span>
                    <span class="n">yState</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">egvector</span><span class="p">[</span><span class="n">indexOfCoupledState</span><span class="p">,</span><span class="n">dim</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>    
                    <span class="n">y</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ev</span><span class="p">[</span><span class="n">dim</span><span class="p">])</span>
                    <span class="n">yState</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">egvector</span><span class="p">[</span><span class="n">indexOfCoupledState</span><span class="p">,</span><span class="n">dim</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span> <span class="o">+</span> <span class="mi">1</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yState</span> <span class="o">=</span> <span class="n">yState</span>
        
        <span class="k">return</span> <span class="mi">0</span></div>

    
<div class="viewcode-block" id="LevelDiagramStarkShifts.plotLevelDiagram"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelDiagramStarkShifts.plotLevelDiagram">[docs]</a>    <span class="k">def</span> <span class="nf">plotLevelDiagram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">progressOutput</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">debugOutput</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">colormap</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">):</span>    
        <span class="k">if</span> <span class="n">progressOutput</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;plotting...&quot;</span>
        
        <span class="n">eFieldList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eFieldList</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">yState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yState</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">9.0</span><span class="p">,</span> <span class="mf">11.5</span><span class="p">))</span>
        <span class="c1">#print y</span>
        <span class="c1">#y=np.array(y)</span>
        
        <span class="n">br</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">units</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
            <span class="c1">## in cm^-1</span>
        
            <span class="k">while</span> <span class="n">br</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
                <span class="c1">#print br</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">eFieldList</span><span class="o">/</span><span class="mi">100</span><span class="p">,</span><span class="n">y</span><span class="p">[</span><span class="n">br</span><span class="p">]</span><span class="o">*</span><span class="mf">0.03336</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span> <span class="c1">#linewidth=0</span>
    
                <span class="c1">#scatter(eFieldList/100.,np.array(y[br])*0.03336,c=yState[br],cmap=colormap,linewidth=0,s=2) # in cm^-1</span>
                <span class="c1">#scatter(eFieldList/100.,np.array(y[br])*0.03336*1.e-2*c*1.e-9/(2.*pi),c=yState[br],cmap=colormap,linewidth=0,s=2) # in GHz</span>
    
                <span class="c1">#semilogx(x,y[br],&quot;.&quot;,color=ystate[br])</span>
                <span class="c1">#loglog(x,abs(y[br]),&quot;b.&quot;)</span>
                <span class="n">br</span> <span class="o">=</span> <span class="n">br</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">## in GHz</span>
            <span class="k">while</span> <span class="n">br</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
                <span class="c1">#print br</span>
                <span class="c1">#scatter(eFieldList/100,y[br]*0.03336,s=1,linewidth=0,color=&quot;k&quot;)</span>
    
                <span class="c1">#scatter(eFieldList/100.,np.array(y[br])*0.03336,c=yState[br],cmap=colormap,linewidth=0,s=2) # in cm^-1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">eFieldList</span><span class="o">/</span><span class="mf">100.</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">br</span><span class="p">]),</span><span class="n">c</span><span class="o">=</span><span class="n">yState</span><span class="p">[</span><span class="n">br</span><span class="p">],</span><span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># in GHz  #linewidth=0,</span>
    
                <span class="c1">#semilogx(x,y[br],&quot;.&quot;,color=ystate[br])</span>
                <span class="c1">#loglog(x,abs(y[br]),&quot;b.&quot;)</span>
                <span class="n">br</span> <span class="o">=</span> <span class="n">br</span><span class="o">+</span><span class="mi">1</span>   
        <span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;E field (V/cm)&quot;</span><span class="p">)</span>

        <span class="n">originalState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basisStates</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indexOfCoupledState</span><span class="p">]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">originalState</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">originalState</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">originalState</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">units</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
            <span class="c1">## in cm^{-1}</span>
            <span class="n">uppery</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">elemCharge</span><span class="o">/</span><span class="n">h</span><span class="o">*</span><span class="mf">1e-9</span><span class="o">*</span><span class="mf">0.03336</span><span class="o">+</span><span class="mi">50</span>
            <span class="n">lowery</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">elemCharge</span><span class="o">/</span><span class="n">h</span><span class="o">*</span><span class="mf">1e-9</span><span class="o">*</span><span class="mf">0.03336</span><span class="o">-</span><span class="mi">50</span>
            <span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Energy/$h c$ (cm$^{-1}$)&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">## in GHz</span>
            <span class="n">uppery</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">elemCharge</span><span class="o">/</span><span class="n">h</span><span class="o">*</span><span class="mf">1e-9</span><span class="o">+</span><span class="mi">5</span>
            <span class="n">lowery</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">elemCharge</span><span class="o">/</span><span class="n">h</span><span class="o">*</span><span class="mf">1e-9</span><span class="o">-</span><span class="mi">5</span>
            <span class="n">ylabel</span><span class="p">(</span><span class="s2">r&quot;Energy/$h$ (GHz)&quot;</span><span class="p">)</span>
            
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">lowery</span><span class="p">,</span><span class="n">uppery</span><span class="p">)</span>
        <span class="c1">##</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">eFieldList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">100.</span><span class="p">,</span><span class="n">eFieldList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="LevelDiagramStarkShifts.savePlot"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelDiagramStarkShifts.savePlot">[docs]</a>    <span class="k">def</span> <span class="nf">savePlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;StarkMap.pdf&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="LevelDiagramStarkShifts.showPlot"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelDiagramStarkShifts.showPlot">[docs]</a>    <span class="k">def</span> <span class="nf">showPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        
        <span class="k">return</span> <span class="mi">0</span></div>
    
<div class="viewcode-block" id="LevelDiagramStarkShifts.calculatePolarizability"><a class="viewcode-back" href="../index.html#wavefunction_ver5_3.LevelDiagramStarkShifts.calculatePolarizability">[docs]</a>    <span class="k">def</span> <span class="nf">calculatePolarizability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">showPlot</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">debugOutput</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">maxField</span><span class="o">=</span><span class="mf">1.e10</span><span class="p">):</span>
        <span class="c1"># function returns polarizability in units of  MHz cm^2 / V^2 </span>
        <span class="c1"># maxField is maximum field (in V/m) to be used for fitting the polarizability. By default, it will use eigenvalues calculated in the whole range. </span>
          
        <span class="n">eFieldList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eFieldList</span>
        <span class="n">yState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yState</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="c1"># calculate Polarizability</span>
        <span class="k">if</span> <span class="n">debugOutput</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;finding original state&quot;</span>
            
        <span class="n">startFitIndex</span> <span class="o">=</span> <span class="mi">0</span> 
        <span class="n">stopFitIndex</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">stopFitIndex</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">eFieldList</span><span class="p">)</span> <span class="ow">and</span> <span class="n">eFieldList</span><span class="p">[</span><span class="n">stopFitIndex</span><span class="p">]</span><span class="o">&lt;</span><span class="n">maxField</span><span class="p">:</span>
            <span class="n">stopFitIndex</span> <span class="o">+=</span> <span class="mi">1</span> 
            
        <span class="n">xOriginalState</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">yOriginalState</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ii</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">while</span> <span class="n">ii</span><span class="o">&lt;</span><span class="n">stopFitIndex</span><span class="p">:</span>
            <span class="n">xOriginalState</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eFieldList</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="n">maxPortion</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="n">yval</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="n">jj</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">while</span> <span class="n">jj</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">yState</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">&gt;</span><span class="n">maxPortion</span><span class="p">:</span>
                    <span class="n">maxPortion</span> <span class="o">=</span> <span class="n">yState</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span>
                    <span class="n">yval</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span>
                <span class="n">jj</span> <span class="o">+=</span><span class="mi">1</span>
            <span class="n">yOriginalState</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yval</span><span class="p">)</span>
            <span class="n">ii</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">xOriginalState</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xOriginalState</span><span class="p">)</span><span class="o">/</span><span class="mf">100.</span> <span class="c1"># in V/cm</span>
        <span class="n">yOriginalState</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yOriginalState</span><span class="p">)</span>   <span class="c1"># in GHz</span>
        <span class="k">if</span> <span class="n">debugOutput</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;found &quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">xOriginalState</span><span class="p">)</span>     
        <span class="k">if</span> <span class="n">showPlot</span><span class="p">:</span>
            <span class="n">scatter</span><span class="p">(</span><span class="n">xOriginalState</span><span class="p">,</span><span class="n">yOriginalState</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>  <span class="c1">#linewidth=0,</span>
        
            <span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;E field (V/cm)&quot;</span><span class="p">)</span>
        
            <span class="n">originalState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basisStates</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indexOfCoupledState</span><span class="p">]</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">originalState</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">originalState</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">originalState</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        
            <span class="c1">## in GHz</span>
            <span class="n">uppery</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">elemCharge</span><span class="o">/</span><span class="n">h</span><span class="o">*</span><span class="mf">1e-9</span><span class="o">+</span><span class="mi">5</span>
            <span class="n">lowery</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">elemCharge</span><span class="o">/</span><span class="n">h</span><span class="o">*</span><span class="mf">1e-9</span><span class="o">-</span><span class="mi">5</span>
        
            <span class="n">ylim</span><span class="p">(</span><span class="n">lowery</span><span class="p">,</span><span class="n">uppery</span><span class="p">)</span>
            <span class="n">ylabel</span><span class="p">(</span><span class="s2">r&quot;Energy/$h$ (GHz)&quot;</span><span class="p">)</span>
            <span class="n">xlim</span><span class="p">(</span><span class="n">eFieldList</span><span class="p">[</span><span class="n">startFitIndex</span><span class="p">]</span><span class="o">/</span><span class="mf">100.</span><span class="p">,</span><span class="n">eFieldList</span><span class="p">[</span><span class="n">stopFitIndex</span><span class="p">]</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span>
        
        
        <span class="k">def</span> <span class="nf">polarizabilityFit</span><span class="p">(</span><span class="n">eField</span><span class="p">,</span><span class="n">offset</span><span class="p">,</span><span class="n">alpha</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">offset</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">alpha</span><span class="o">*</span><span class="n">eField</span><span class="o">**</span><span class="mi">2</span>
        

        <span class="n">popt</span><span class="p">,</span><span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">polarizabilityFit</span><span class="p">,</span><span class="n">xOriginalState</span><span class="p">[</span><span class="n">startFitIndex</span><span class="p">:</span><span class="n">stopFitIndex</span><span class="p">],</span><span class="n">yOriginalState</span><span class="p">[</span><span class="n">startFitIndex</span><span class="p">:</span><span class="n">stopFitIndex</span><span class="p">],[(</span><span class="n">uppery</span><span class="o">+</span><span class="n">lowery</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">print</span> <span class="s2">&quot;Scalar polarizability = &quot;</span><span class="p">,</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mf">1.e3</span><span class="p">,</span><span class="s2">&quot; MHz cm^2 / V^2 &quot;</span>
        <span class="c1">#print &quot;offset = &quot;,popt[1]</span>
        
        <span class="k">if</span> <span class="n">showPlot</span><span class="p">:</span>
        
            <span class="n">y_fit</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">xOriginalState</span><span class="p">[</span><span class="n">startFitIndex</span><span class="p">:</span><span class="n">stopFitIndex</span><span class="p">]:</span>
                <span class="n">y_fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">polarizabilityFit</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="c1">#y_theory.append(theoryFun(val))</span>
            
            
            <span class="n">plot</span><span class="p">(</span><span class="n">xOriginalState</span><span class="p">[</span><span class="n">startFitIndex</span><span class="p">:</span><span class="n">stopFitIndex</span><span class="p">],</span><span class="n">y_fit</span><span class="p">,</span><span class="s2">&quot;r--&quot;</span><span class="p">)</span>
            
            <span class="n">ylim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">yOriginalState</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">yOriginalState</span><span class="p">))</span>
            
            <span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mf">1.e3</span></div></div>
    
    
    
    
    
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Nikola Sibalic.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
    </div>

    

    
  </body>
</html>